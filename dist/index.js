"use strict";var ko=Object.defineProperty;var To=(t,e,n)=>e in t?ko(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var q=(t,e,n)=>To(t,typeof e!="symbol"?e+"":e,n);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("react/jsx-runtime"),k=require("react"),Se={IDLE:"idle",SUBMITTED:"submitted",STREAMING:"streaming",ERROR:"error"},tt={STARTING:"Starting...",PROCESSING:"Processing...",THINKING:"Thinking...",STREAMING:"Streaming response...",FINALIZING:"Finalizing...",COMPLETED:"Completed",ERROR:"Error occurred",IDLE:""},Ue={PROCESSING:"processing",COMPLETED:"completed",ERROR:"error"},$n=t=>t===Se.SUBMITTED||t===Se.STREAMING,Eo=t=>t===Se.IDLE,bo=t=>t===Se.ERROR,_o=t=>t===Ue.PROCESSING,vo=t=>t===Ue.COMPLETED,Ro=t=>t===Ue.ERROR;var $s=(t=>(t.BRAND="BRAND",t.ACCOUNT="ACCOUNT",t.USER="USER",t))($s||{}),Ae=(t=>(t.DISCONNECTED="disconnected",t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t))(Ae||{});const Io={maxReconnectAttempts:1/0,reconnectDelay:1e3,heartbeatInterval:3e4},Mn={NORMAL:1e3,GOING_AWAY:1001};var lt=(t=>(t.CONNECTION_ESTABLISHED="connection_established",t.CONNECTION_LOST="connection_lost",t.CONNECTION_RESTORED="connection_restored",t.CONNECTION_FAILED="connection_failed",t.RECONNECTING="reconnecting",t.CHAT_COMPLETED="chat_completed",t.CHAT_ERROR="chat_error",t))(lt||{}),Ct=(t=>(t.CHAT_MESSAGE="chat_message",t.CONFIGURE_TOOLS="configure_tools",t.UPDATE_TOOLS="update_tools",t.UPDATE_CONTEXT_HELPERS="update_context_helpers",t.TOOL_CALL_RESPONSE="tool_call_response",t.HEARTBEAT_PING="heartbeat_ping",t.HEARTBEAT_PONG="heartbeat_pong",t.STOP_RUN="stop_run",t))(Ct||{}),Ve=(t=>(t.SESSION_ESTABLISHED="session_established",t.TOOLS_CONFIGURED="tools_configured",t.CLIENT_TOOLS_UPDATED="client_tools_updated",t.CONFIGURE_TOOLS="configure_tools",t.CHAT_EVENT="chat_event",t.CHAT_FINISHED="chat_finished",t.CHAT_ERROR="chat_error",t.MESSAGES_PERSISTED="messages_persisted",t.THREAD_CREATED="thread_created",t.TOOL_CALL_REQUEST="tool_call_request",t.HEARTBEAT_PING="heartbeat_ping",t.HEARTBEAT_ACK="heartbeat_ack",t.ERROR="error",t))(Ve||{}),Hn=(t=>(t.PROVIDER_EVENT="provider-event",t.LATITUDE_EVENT="latitude-event",t.CONTENT_DELTA="content-delta",t))(Hn||{}),Pt=(t=>(t.TEXT_DELTA="text-delta",t.REASONING_START="reasoning-start",t.REASONING_DELTA="reasoning-delta",t.REASONING_END="reasoning-end",t.TOOL_CALL="tool-call",t.TOOL_RESULT="tool-result",t))(Pt||{});class Zt{static createConnectionEvent(e,n){return{type:e,timestamp:new Date,data:n}}static createChatEvent(e,n){return{type:e,timestamp:new Date,data:n}}static connectionEstablished(){return this.createConnectionEvent(lt.CONNECTION_ESTABLISHED)}static connectionLost(e){return this.createConnectionEvent(lt.CONNECTION_LOST,{reason:e})}static connectionRestored(){return this.createConnectionEvent(lt.CONNECTION_RESTORED)}static reconnecting(e,n){return this.createConnectionEvent(lt.RECONNECTING,{attempt:e,maxAttempts:n})}static chatCompleted(e){return this.createChatEvent(lt.CHAT_COMPLETED,{conversationId:e})}static chatError(e,n){return this.createChatEvent(lt.CHAT_ERROR,{error:e,errorCode:n})}}class Nt{static createChatMessage(e){return{type:Ct.CHAT_MESSAGE,content:e.content,media:e.media||[],providerResId:e.providerResId}}static createConfigureToolsMessage(e,n){return{type:Ct.CONFIGURE_TOOLS,toolSchemas:e,contextHelpers:n}}static createUpdateToolsMessage(e){return{type:Ct.UPDATE_TOOLS,toolSchemas:e}}static createUpdateContextHelpersMessage(e){return{type:Ct.UPDATE_CONTEXT_HELPERS,contextHelpers:e}}static createToolCallSuccessResponse(e,n){return{type:Ct.TOOL_CALL_RESPONSE,callId:e,result:n}}static createToolCallErrorResponse(e,n){return{type:Ct.TOOL_CALL_RESPONSE,callId:e,error:n}}static createHeartbeatPing(){return{type:Ct.HEARTBEAT_PING,timestamp:new Date().toISOString(),pingTime:Date.now()}}static createHeartbeatPong(e,n){return{type:Ct.HEARTBEAT_PONG,timestamp:new Date().toISOString(),originalTimestamp:e,pingTime:n}}static createStopRunMessage(e){return{type:Ct.STOP_RUN,conversationUuid:e}}static serialize(e){return JSON.stringify(e)}static createAndSerialize(e){return this.serialize(e())}static serializeChatMessage(e){return this.createAndSerialize(()=>this.createChatMessage(e))}static serializeConfigureTools(e,n){return this.createAndSerialize(()=>this.createConfigureToolsMessage(e,n))}static serializeUpdateTools(e){return this.createAndSerialize(()=>this.createUpdateToolsMessage(e))}static serializeUpdateContextHelpers(e){return this.createAndSerialize(()=>this.createUpdateContextHelpersMessage(e))}static serializeToolCallSuccess(e,n){return this.createAndSerialize(()=>this.createToolCallSuccessResponse(e,n))}static serializeToolCallError(e,n){return this.createAndSerialize(()=>this.createToolCallErrorResponse(e,n))}static serializeHeartbeatPing(){return this.createAndSerialize(()=>this.createHeartbeatPing())}static serializeHeartbeatPong(e,n){return this.createAndSerialize(()=>this.createHeartbeatPong(e,n))}static serializeStopRun(e){return this.createAndSerialize(()=>this.createStopRunMessage(e))}}class No{constructor(e,n){q(this,"ws",null);q(this,"config");q(this,"connectionState");q(this,"reconnectTimer",null);q(this,"heartbeatInterval",null);q(this,"visibilityChangeHandler");q(this,"currentTicket",null);q(this,"intentionalDisconnect",!1);q(this,"onOpen");q(this,"onMessage");q(this,"onError");q(this,"onClose");q(this,"onSystemEvent");q(this,"onTicketRefresh");q(this,"onTicketValidate");this.config=e,this.connectionState=n,this.visibilityChangeHandler=this.handleVisibilityChange.bind(this),this.registerVisibilityHandler()}connect(e){return new Promise((n,r)=>{try{this.intentionalDisconnect=!1,e&&(this.currentTicket=e);const i=this.buildWebSocketUrl();if(this.ws=new WebSocket(i),!this.ws){r(new Error("WebSocket not initialized"));return}this.setupEventHandlers(n,r)}catch(i){r(i)}})}buildWebSocketUrl(){let e=this.config.apiUrl.replace(/^https:\/\//,"wss://").replace(/^http:\/\//,"ws://");if(e=e.endsWith("/ws")?e:e+"/ws",this.currentTicket){const n=e.includes("?")?"&":"?";e=`${e}${n}ticket=${this.currentTicket}`}return e}setupEventHandlers(e,n){this.ws&&(this.ws.onopen=()=>this.handleConnectionOpened(e),this.ws.onerror=r=>this.handleConnectionError(r,e,n),this.ws.onmessage=r=>{var i;return(i=this.onMessage)==null?void 0:i.call(this,r)},this.ws.onclose=r=>this.handleConnectionClosed(r))}handleConnectionOpened(e){var n;this.updateConnectionState(!0,!1),this.startHeartbeat(),(n=this.onOpen)==null||n.call(this),e==null||e()}handleConnectionError(e,n,r){var i;if((i=this.onError)==null||i.call(this,e),this.connectionState.setConnected(!1),r){r(e);return}this.intentionalDisconnect||this.scheduleReconnectAfterError()}handleConnectionClosed(e){var n;console.log("[WebSocketManager] Connection closed",{code:e.code,reason:e.reason,intentionalDisconnect:this.intentionalDisconnect}),this.processConnectionClosure(e),(n=this.onClose)==null||n.call(this,e),this.shouldReconnectAfterClose(e.code)?(console.log("[WebSocketManager] Should reconnect, calling attemptReconnect"),this.attemptReconnect()):console.log("[WebSocketManager] Should NOT reconnect")}updateConnectionState(e,n){this.connectionState.setConnected(e),this.connectionState.setReconnecting(n),this.connectionState.resetReconnectAttempts(),this.connectionState.updateReconnectDelay(this.config.reconnectDelay)}processConnectionClosure(e){this.connectionState.setConnected(!1),this.stopHeartbeat()}shouldReconnectAfterClose(e){if(console.log("[WebSocketManager] shouldReconnectAfterClose check",{closeCode:e,intentionalDisconnect:this.intentionalDisconnect,NORMAL:Mn.NORMAL,GOING_AWAY:Mn.GOING_AWAY}),this.intentionalDisconnect)return console.log("[WebSocketManager] Intentional disconnect - no reconnect"),!1;const{NORMAL:n}=Mn,r=e!==n;return console.log("[WebSocketManager] Should reconnect?",r),r}handleVisibilityChange(){document.visibilityState==="visible"&&!this.connectionState.isConnected&&!this.connectionState.isReconnecting&&this.attemptReconnect()}registerVisibilityHandler(){typeof document<"u"&&document.addEventListener("visibilitychange",this.visibilityChangeHandler)}attemptReconnect(){var a,o;if(console.log("[WebSocketManager] attemptReconnect called",{reconnectAttempts:this.connectionState.reconnectAttempts,maxReconnectAttempts:this.config.maxReconnectAttempts,isReconnecting:this.connectionState.isReconnecting,reconnectTimer:this.reconnectTimer}),this.connectionState.reconnectAttempts>=this.config.maxReconnectAttempts){console.log("[WebSocketManager] Max reconnection attempts reached"),(a=this.onSystemEvent)==null||a.call(this,Zt.connectionLost("Max reconnection attempts reached")),this.connectionState.setReconnecting(!1);return}if(this.reconnectTimer!==null){console.log("[WebSocketManager] Reconnection already in progress, skipping");return}this.connectionState.setReconnecting(!0),this.connectionState.incrementReconnectAttempts();const e=this.connectionState.reconnectAttempts,n=this.config.maxReconnectAttempts;console.log("[WebSocketManager] Firing RECONNECTING event",{attempt:e,maxAttempts:n}),(o=this.onSystemEvent)==null||o.call(this,Zt.reconnecting(e,n));const r=this.config.reconnectDelay,i=Math.random()*90+10,s=r+i;this.reconnectTimer=window.setTimeout(()=>{this.reconnectTimer=null,this.connectionState.isConnected||this.reconnect()},s)}async reconnect(){try{console.log("[WebSocketManager] ====== RECONNECT ATTEMPT START ======",{hasCurrentTicket:!!this.currentTicket,reconnectAttempt:this.connectionState.reconnectAttempts}),this.closeConnection();let e=!0;if(this.onTicketValidate&&this.currentTicket){console.log("[WebSocketManager] Validating current ticket before reconnection...");try{await this.onTicketValidate()?(console.log("[WebSocketManager] Current ticket is still valid, proceeding with reconnection"),e=!1):console.log("[WebSocketManager] Current ticket is invalid according to server, need to get fresh ticket")}catch(r){console.error("[WebSocketManager] Failed to validate ticket with server API:",r),console.log("[WebSocketManager] Validation API failed - server might be down, will retry with fresh ticket")}}else this.currentTicket||console.log("[WebSocketManager] No current ticket, need to get fresh ticket");if(e&&this.onTicketRefresh){console.log("[WebSocketManager] Requesting fresh ticket for reconnection...");try{const r=await this.onTicketRefresh();this.currentTicket=r,console.log("[WebSocketManager] Fresh ticket obtained for reconnection")}catch(r){throw console.error("[WebSocketManager] Failed to get fresh ticket:",r),r}}else if(e&&!this.onTicketRefresh)throw console.warn("[WebSocketManager] Need fresh ticket but no ticket refresh callback available"),new Error("Cannot refresh expired ticket - no refresh callback available");console.log("[WebSocketManager] Creating WebSocket connection...");const n=this.buildWebSocketUrl();this.ws=new WebSocket(n),this.setupReconnectHandlers(),console.log("[WebSocketManager] ====== RECONNECT ATTEMPT END (connection initiated) ======")}catch(e){console.log("[WebSocketManager] ====== RECONNECT ATTEMPT FAILED ======",e),this.scheduleReconnectAfterError()}}updateTicket(e){this.currentTicket=e}setupReconnectHandlers(){this.ws&&(this.ws.onopen=()=>this.handleReconnectionOpened(),this.ws.onerror=()=>this.handleReconnectionError(),this.ws.onmessage=e=>{var n;return(n=this.onMessage)==null?void 0:n.call(this,e)},this.ws.onclose=e=>this.handleReconnectionClosed(e))}handleReconnectionOpened(){var e,n;this.updateConnectionState(!0,!1),this.startHeartbeat(),(e=this.onSystemEvent)==null||e.call(this,Zt.connectionRestored()),(n=this.onOpen)==null||n.call(this)}handleReconnectionError(){this.scheduleReconnectAfterError()}scheduleReconnectAfterError(){const e=this.config.reconnectDelay,n=Math.random()*90+10,r=e+n;this.reconnectTimer!==null&&(window.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),setTimeout(()=>this.attemptReconnect(),r)}handleReconnectionClosed(e){this.processConnectionClosure(e),this.shouldReconnectAfterClose(e.code)?this.attemptReconnect():this.connectionState.setReconnecting(!1)}startHeartbeat(){}sendHeartbeat(){const e=Nt.serializeHeartbeatPing();this.send(e)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}send(e){var n;((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN&&this.ws.send(e)}closeConnection(){this.ws&&this.ws.close(Mn.NORMAL)}disconnect(){this.intentionalDisconnect=!0,this.clearTimers(),this.removeEventListeners(),this.closeConnection(),this.connectionState.reset(),this.ws=null}clearTimers(){this.reconnectTimer&&(window.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.stopHeartbeat()}removeEventListeners(){typeof document<"u"&&this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler)}getWebSocketState(){return this.ws?{[WebSocket.CONNECTING]:"CONNECTING",[WebSocket.OPEN]:"OPEN",[WebSocket.CLOSING]:"CLOSING",[WebSocket.CLOSED]:"CLOSED"}[this.ws.readyState]||"UNKNOWN":"null"}setEventHandlers(e){this.onOpen=e.onOpen,this.onMessage=e.onMessage,this.onError=e.onError,this.onClose=e.onClose,this.onSystemEvent=e.onSystemEvent,this.onTicketRefresh=e.onTicketRefresh,this.onTicketValidate=e.onTicketValidate}}class Mo{constructor(){q(this,"state");this.state={isConnected:!1,isReconnecting:!1,reconnectAttempts:0,reconnectDelay:1e3}}update(e){Object.assign(this.state,e)}get isConnected(){return this.state.isConnected}get isReconnecting(){return this.state.isReconnecting}get reconnectAttempts(){return this.state.reconnectAttempts}get reconnectDelay(){return this.state.reconnectDelay}setConnected(e){this.state.isConnected=e}setReconnecting(e){this.state.isReconnecting=e}incrementReconnectAttempts(){this.state.reconnectAttempts++}resetReconnectAttempts(){this.state.reconnectAttempts=0}updateReconnectDelay(e){this.state.reconnectDelay=e}reset(){this.state={isConnected:!1,isReconnecting:!1,reconnectAttempts:0,reconnectDelay:1e3}}getSnapshot(){return{...this.state}}}class Vn{static createServerToolCall(e,n,r={}){return{toolName:e,callId:n,parameters:r}}static createReasoningCall(e,n,r){return{toolName:"reasoning",callId:e,parameters:{phase:n,...r}}}static createLatitudeToolCall(e,n,r={}){return{toolName:e,callId:n,parameters:r}}}class Vs{constructor(e={}){q(this,"handlers",{});this.handlers=e}updateEventHandlers(e){Object.assign(this.handlers,e),this.onHandlersUpdated(e)}onHandlersUpdated(e){}getHandler(e){return this.handlers[e]}}const ae={THINKING_PREFIX:"THINKING:",REASONING_PREFIX:"REASONING:",THOUGHT_PREFIX:"THOUGHT:",COMPLETED_MARKER:"âœ… Completed:",ERROR_MARKER:"âŒ",HANDLING_MARKER:"ðŸ”§ Handling:",UI_TEXT:{AI_IS_THINKING:"AI is thinking",THINKING:"Thinking",THINKING_ELLIPSIS:"Thinking...",PROCESSING:"Processing",THOUGHT:"Thought",DURATION_FOR:"for",DURATION_SECOND:"second",DURATION_SECONDS:"seconds"},MESSAGE_TYPES:{THINKING:"thinking",REASONING:"reasoning",THOUGHT:"thought",COMPLETED:"completed",ERROR:"error",PROCESSING:"processing"},PATTERNS:{DURATION:/for ([\d.]+) \w+/,THOUGHT_CONTENT:/\*\*(.*?)\*\*/g,HANDLING_TOOL:/ðŸ”§ Handling: (.+)/,COMPLETED_OR_ERROR_TOOL:/(?:âœ… Completed|âŒ Error): (.+?)(?:\s-\s|$)/}},Pe={isThinkingMessage:t=>t.startsWith(ae.THINKING_PREFIX)||t.startsWith(ae.REASONING_PREFIX)||t.startsWith(ae.THOUGHT_PREFIX),isCompletedMessage:t=>t.includes(ae.COMPLETED_MARKER),isErrorMessage:t=>t.includes(ae.ERROR_MARKER),isHandlingMessage:t=>t.includes(ae.HANDLING_MARKER),extractDuration:(t,e)=>{const n=t.match(ae.PATTERNS.DURATION);if(!n)return;const r=parseFloat(n[1]);if(e){const s=e("chat.reasoning.duration.for"),a=e(r===1?"chat.reasoning.duration.second":"chat.reasoning.duration.seconds");return` ${s} ${r} ${a}`}const i=r===1?ae.UI_TEXT.DURATION_SECOND:ae.UI_TEXT.DURATION_SECONDS;return` ${ae.UI_TEXT.DURATION_FOR} ${r} ${i}`},cleanReasoningContent:t=>{let e=t.replace(new RegExp(`^${ae.THINKING_PREFIX}\\s*`),"").replace(new RegExp(`^${ae.REASONING_PREFIX}\\s*`),"").replace(new RegExp(`^${ae.THOUGHT_PREFIX}\\s*`),"");return e=e.replace(/\s*for [\d.]+\s+\w+$/,""),e=e.replace(ae.PATTERNS.THOUGHT_CONTENT,""),e.trim()},getMessageType:(t,e)=>e===!1?Pe.isErrorMessage(t)?ae.MESSAGE_TYPES.ERROR:(Pe.isThinkingMessage(t)&&ae.PATTERNS.DURATION.test(t)||Pe.isThinkingMessage(t),ae.MESSAGE_TYPES.THOUGHT):Pe.isCompletedMessage(t)?ae.MESSAGE_TYPES.COMPLETED:Pe.isErrorMessage(t)?ae.MESSAGE_TYPES.ERROR:(Pe.isHandlingMessage(t)||Pe.isThinkingMessage(t)&&!t.includes(ae.UI_TEXT.AI_IS_THINKING),ae.MESSAGE_TYPES.THINKING)};class Ao extends Vs{constructor(n){super({onReasoningUpdate:n});q(this,"reasoningStartTimes",new Map);q(this,"reasoningContent",new Map)}onHandlersUpdated(n){}triggerReasoningUpdate(n,r,i,s,a){const o=this.getHandler("onReasoningUpdate");if(!o)return;const c=Vn.createReasoningCall(i,s,a||{});o(n,r,c)}handleReasoningStart(n){const r=n.id||"reasoning";this.reasoningStartTimes.set(r,Date.now()),this.reasoningContent.set(r,"")}handleReasoningDelta(n){if(!n.text)return;const r=n.id||"reasoning",s=(this.reasoningContent.get(r)||"")+n.text;this.reasoningContent.set(r,s);const a=`${ae.THINKING_PREFIX} ${s}`;this.triggerReasoningUpdate(!0,a,r,"thinking",{text:s})}handleReasoningEnd(n){const r=n.id||"reasoning",i=this.reasoningContent.get(r)||"",s=this.reasoningStartTimes.get(r);let a="";s&&(a=` for ${((Date.now()-s)/1e3).toFixed(0)} seconds`,this.reasoningStartTimes.delete(r));const o=i||ae.UI_TEXT.THOUGHT,c=`${ae.THOUGHT_PREFIX} ${o}${a}`;this.triggerReasoningUpdate(!1,c,r,"end",{duration:a,fullContent:i}),this.reasoningContent.delete(r)}setReasoningUpdateHandler(n){this.updateEventHandlers({onReasoningUpdate:n})}}class Oo extends Vs{constructor(n={},r){super({onReasoningUpdate:r});q(this,"processedToolCalls",new Set);q(this,"clientTools",{});q(this,"sendMessage");this.clientTools=n}async handleToolCallRequest(n){var a,o,c;const{callId:r,toolName:i,parameters:s}=n;if(!this.processedToolCalls.has(r)){this.processedToolCalls.add(r),(a=this.getHandler("onReasoningUpdate"))==null||a(!0,`${ae.HANDLING_MARKER} ${i}`,n);try{const u=await this.executeToolFunction(i,s);this.sendToolResponse(r,u),(o=this.getHandler("onReasoningUpdate"))==null||o(!1,`${ae.COMPLETED_MARKER} ${i}`,n)}catch(u){this.sendToolError(r,u),(c=this.getHandler("onReasoningUpdate"))==null||c(!1,`${ae.ERROR_MARKER} Error: ${i} - ${u}`,n)}}}async executeToolFunction(n,r){const i=this.clientTools[n];if(!i)throw new Error(`Tool not found: ${n}`);return await i(r)}sendToolResponse(n,r){if(!this.sendMessage)return;const i=Nt.serializeToolCallSuccess(n,r);this.sendMessage(i)}sendToolError(n,r){if(!this.sendMessage)return;const i=r instanceof Error?r.message:"Unknown error",s=Nt.serializeToolCallError(n,i);this.sendMessage(s)}handleServerToolCall(n){var i;const r=this.getHandler("onReasoningUpdate");if(r&&((i=n.toolName)!=null&&i.startsWith("lat_"))&&n.toolCallId){const s=Vn.createLatitudeToolCall(n.toolName,n.toolCallId,n.args||{});r(!0,`${ae.HANDLING_MARKER} ${n.toolName}`,s)}}handleServerToolResult(n){var i;const r=this.getHandler("onReasoningUpdate");if(r&&((i=n.toolName)!=null&&i.startsWith("lat_"))&&n.toolCallId){const s=Vn.createLatitudeToolCall(n.toolName,n.toolCallId);r(!1,`${ae.COMPLETED_MARKER} ${n.toolName}`,s)}}clearProcessedToolCalls(){this.processedToolCalls.clear()}updateClientTools(n){this.clientTools={...this.clientTools,...n}}setSendMessageHandler(n){this.sendMessage=n}setReasoningUpdateHandler(n){this.updateEventHandlers({onReasoningUpdate:n})}}class Lo{constructor(e,n={}){q(this,"reasoningHandler");q(this,"toolHandler");q(this,"handlers");q(this,"sendMessage");this.handlers=e,this.reasoningHandler=new Ao(e.onReasoningUpdate),this.toolHandler=new Oo(n,e.onReasoningUpdate)}handleMessage(e){try{const n=JSON.parse(e.data);switch(n.type){case Ve.SESSION_ESTABLISHED:this.handleSessionEstablished();break;case Ve.TOOLS_CONFIGURED:this.handleToolsConfigured();break;case Ve.CLIENT_TOOLS_UPDATED:this.handleClientToolsUpdated();break;case Ve.CONFIGURE_TOOLS:this.handleConfigureToolsRequest();break;case Ve.CHAT_EVENT:this.handleChatEvent(n);break;case Ve.CHAT_FINISHED:this.handleChatFinished(n);break;case Ve.MESSAGES_PERSISTED:this.handleMessagesPersisted(n);break;case Ve.CHAT_ERROR:this.handleChatError(n);break;case Ve.TOOL_CALL_REQUEST:this.handleToolCallRequest(n);break;case Ve.HEARTBEAT_PING:this.handleHeartbeatPing(n);break;case Ve.HEARTBEAT_ACK:break;case Ve.ERROR:this.handleError(n);break;default:break}return n}catch{return null}}handleSessionEstablished(){}handleToolsConfigured(){}handleClientToolsUpdated(){}handleConfigureToolsRequest(){}handleChatEvent(e){var n,r,i;switch(e.event){case Hn.PROVIDER_EVENT:this.handleProviderEvent(e);break;case Hn.LATITUDE_EVENT:this.handleLatitudeEvent(e);break;case Hn.CONTENT_DELTA:(n=e.data)!=null&&n.delta&&((i=(r=this.handlers).onSetMessage)==null||i.call(r,e.data.delta));break}}handleProviderEvent(e){var r,i,s;switch((r=e.data)==null?void 0:r.type){case Pt.TEXT_DELTA:e.data.textDelta&&((s=(i=this.handlers).onSetMessage)==null||s.call(i,e.data.textDelta));break;case Pt.REASONING_START:this.reasoningHandler.handleReasoningStart(e.data);break;case Pt.REASONING_DELTA:this.reasoningHandler.handleReasoningDelta(e.data);break;case Pt.REASONING_END:this.reasoningHandler.handleReasoningEnd(e.data);break;case Pt.TOOL_CALL:this.toolHandler.handleServerToolCall(e.data);break;case Pt.TOOL_RESULT:this.toolHandler.handleServerToolResult(e.data);break}}handleLatitudeEvent(e){var n;if(((n=e.data)==null?void 0:n.type)===Pt.TOOL_RESULT&&this.handlers.onReasoningUpdate){const r=e.data;if(r.toolCallId&&r.toolName){const i=Vn.createServerToolCall(r.toolName,r.toolCallId);this.handlers.onReasoningUpdate(!1,`${ae.COMPLETED_MARKER} ${r.toolName}`,i)}}}handleChatFinished(e){var n,r;(r=(n=this.handlers).onSystemEvent)==null||r.call(n,Zt.chatCompleted(e.uuid))}handleMessagesPersisted(e){var n,r;this.handlers.onMessagesPersisted&&this.handlers.onMessagesPersisted({threadId:(n=e.data)==null?void 0:n.threadId,providerResId:(r=e.data)==null?void 0:r.providerResId})}handleChatError(e){var n,r;(r=(n=this.handlers).onSystemEvent)==null||r.call(n,Zt.chatError(e.error||"Unknown error"))}handleToolCallRequest(e){this.toolHandler.handleToolCallRequest(e)}handleHeartbeatPing(e){if(!this.sendMessage)return;const n=Nt.serializeHeartbeatPong(e.timestamp,e.pingTime);this.sendMessage(n)}handleError(e){var n,r;(r=(n=this.handlers).onSystemEvent)==null||r.call(n,Zt.chatError(e.error||"Unknown WebSocket error"))}updateClientTools(e){this.toolHandler.updateClientTools(e)}clearProcessedToolCalls(){this.toolHandler.clearProcessedToolCalls()}setSendMessageHandler(e){this.sendMessage=e,this.toolHandler.setSendMessageHandler(e)}updateEventHandlers(e){Object.assign(this.handlers,e),this.reasoningHandler.updateEventHandlers(e),this.toolHandler.updateEventHandlers(e)}}async function Po(t,e,n=1e4){const r={"Content-Type":"application/json"};e!=null&&e.userMpAuthToken&&(r["x-oddle-mp-auth-token"]=e.userMpAuthToken),e!=null&&e.chatServerKey&&(r["x-oddle-chat-server-key"]=e.chatServerKey);try{const i=new AbortController,s=setTimeout(()=>i.abort(),n);try{const a=await fetch(`${t}/api/v1/tickets`,{method:"POST",headers:r,signal:i.signal,body:JSON.stringify({entityId:e.entityId,entityType:e.entityType,providerResId:e.providerResId,clientInfo:{userAgent:navigator.userAgent,timestamp:new Date().toISOString(),...e.clientInfo}})});if(clearTimeout(s),!a.ok){const c=await a.json().catch(()=>({}));throw new Error(c.error||`Failed to get WebSocket ticket: ${a.statusText}`)}const o=await a.json();if(!o.success||!o.ticket)throw new Error(o.error||"Invalid ticket response from server");return o}catch(a){throw clearTimeout(s),a instanceof Error&&a.name==="AbortError"?new Error(`Ticket request timed out after ${n}ms`):a}}catch(i){throw console.error("Error requesting WebSocket ticket:",i),i}}function vr(t){if(!t.success||!t.ticket||!t.expiresAt)return!1;const e=new Date(t.expiresAt).getTime();return Date.now()<e-3e4}function ki(t){const e=vr(t),n=new Date(t.expiresAt).getTime(),r=Date.now(),i=Math.max(0,Math.floor((n-r)/1e3));return{isValid:e,expiresIn:i,expired:r>=n}}async function Do(t,e,n,r){try{const i={"Content-Type":"application/json","x-oddle-mp-auth-token":n.userMpAuthToken,"x-oddle-chat-server-key":n.chatServerKey},s={ticket:e,...r};console.log("[TicketAPI] Validating ticket with server:",{url:`${t}/api/v1/tickets/validate`,ticket:e.substring(0,8)+"...",context:r});const a=await fetch(`${t}/api/v1/tickets/validate`,{method:"POST",headers:i,body:JSON.stringify(s)});if(!a.ok)throw new Error(`Ticket validation failed: ${a.status} ${a.statusText}`);const o=await a.json();return console.log("[TicketAPI] Server validation result:",{valid:o.valid,error:o.error,details:o.details}),o.valid||(o.retryable=!1),o}catch(i){console.error("[TicketAPI] Ticket validation error:",i);let s="VALIDATION_ERROR",a="Validation request failed";return i instanceof Error&&(a=i.message,i.message.includes("fetch")?(s="NETWORK_ERROR",a="Network error during ticket validation - server may be temporarily unavailable"):i.message.includes("500")||i.message.includes("502")||i.message.includes("503")?(s="SERVER_ERROR",a="Server error during ticket validation - validation service may be temporarily down"):i.message.includes("timeout")&&(s="TIMEOUT_ERROR",a="Timeout during ticket validation - validation service may be slow or overloaded")),console.log(`[TicketAPI] Validation failed with error type: ${s}`),{valid:!1,error:a,code:s,retryable:!0,details:{reason:"Validation API request failed - will retry with fresh ticket",retryable:!0}}}}function jo(t){var r,i,s;const e=((r=t==null?void 0:t.message)==null?void 0:r.toLowerCase())||"",n=((i=t==null?void 0:t.name)==null?void 0:i.toLowerCase())||"";if(e.includes("connection refused")||e.includes("econnrefused")||e.includes("err_connection_refused")||e.includes("network request failed")||e.includes("failed to connect"))return{isRetryable:!0,reason:"Server unreachable or connection refused",errorType:"network"};if(n==="typeerror"&&e.includes("failed to fetch"))return e.includes("cors")||e.includes("cross-origin")||e.includes("blocked by cors")?{isRetryable:!1,reason:"CORS policy blocking request",errorType:"cors"}:{isRetryable:!0,reason:"Network error - server may be unreachable",errorType:"network"};if(e.includes("cors")||e.includes("cross-origin")||e.includes("blocked by cors"))return{isRetryable:!1,reason:"CORS error detected",errorType:"cors"};if(e.includes("unauthorized")||e.includes("forbidden")||e.includes("authentication")||e.includes("invalid token")||e.includes("expired token")||e.includes("expired authentication")||e.includes("access denied")||e.includes("ticket expired")||e.includes("invalid ticket")||e.includes("ticket revoked")||e.includes("ticket not found")||e.includes("user not found")||e.includes("entity not found")||e.includes("permission denied")||e.includes("invalid credentials"))return{isRetryable:!1,reason:"Authentication/authorization error",errorType:"auth"};if(t!=null&&t.status||t!=null&&t.response&&typeof t.response=="object"){const a=t.status||((s=t.response)==null?void 0:s.status);if(a===401||a===403)return{isRetryable:!1,reason:`HTTP ${a} - authentication/permission denied`,errorType:"auth"};if(a===404)return{isRetryable:!1,reason:"HTTP 404 - endpoint not found",errorType:"permission"};if(a>=400&&a<500)return{isRetryable:!1,reason:`HTTP ${a} - client error`,errorType:"permission"};if(a>=500)return{isRetryable:!0,reason:`HTTP ${a} - server error (temporary)`,errorType:"server"}}return e.includes("network")||e.includes("timeout")||e.includes("connection")||e.includes("offline")||n==="networkerror"?{isRetryable:!0,reason:"Network connectivity issue",errorType:"network"}:e.includes("websocket")||e.includes("ws")||n==="websocketerror"?{isRetryable:!0,reason:"WebSocket connection issue",errorType:"network"}:{isRetryable:!1,reason:"Unknown error type",errorType:"unknown"}}function Jt(t,e){const n=jo(t);return console.error(`[${e}] Error occurred:`,{error:(t==null?void 0:t.message)||t,classification:n,shouldRetry:n.isRetryable}),n}class Fo{constructor(e,n,r={}){q(this,"ticket",null);q(this,"refreshPromise",null);q(this,"validationInterval",null);q(this,"authData");q(this,"apiUrl");q(this,"config");q(this,"ticketObtainedAt",null);q(this,"freshTicketThreshold",6e4);q(this,"lastValidationResult",null);q(this,"validationCacheTTL",3e4);this.authData=e,this.apiUrl=this.convertToHttpUrl(n),this.config={checkInterval:r.checkInterval??6e4,renewalThreshold:r.renewalThreshold??300,maxRetries:r.maxRetries??3,retryBaseDelay:r.retryBaseDelay??1e3,requestTimeout:r.requestTimeout??3e4,onError:r.onError}}convertToHttpUrl(e){return e.replace(/^wss:\/\//,"https://").replace(/^ws:\/\//,"http://")}async getValidTicket(){return this.ticket&&vr(this.ticket)?(console.log("TicketManager: Using existing valid ticket"),this.ticket.ticket):(console.log("TicketManager: No valid ticket, refreshing..."),this.refreshTicket())}async refreshTicket(){if(this.refreshPromise)return console.log("TicketManager: Refresh already in progress, waiting..."),this.refreshPromise;this.refreshPromise=this._doRefresh();try{return await this.refreshPromise}finally{this.refreshPromise=null}}async _doRefresh(){const e=this.config.maxRetries,n=this.config.retryBaseDelay;for(let r=1;r<=e;r++){console.log(`TicketManager: Requesting new ticket (attempt ${r}/${e})...`,{apiUrl:this.apiUrl});try{return this.ticket=await Po(this.apiUrl,this.authData,this.config.requestTimeout),console.log("TicketManager: Ticket received successfully",{hasTicket:!!this.ticket.ticket,expiresAt:this.ticket.expiresAt}),this.ticketObtainedAt=Date.now(),this.lastValidationResult=null,this.ticket.ticket}catch(i){console.log("[TicketManager] Caught error during ticket request:",{error:i instanceof Error?i.message:i,attempt:r,maxRetries:e,hasOnErrorCallback:!!this.config.onError});const s=Jt(i,"TicketManager");if(!s.isRetryable){const o=`Ticket refresh failed (non-retryable - ${s.reason}): ${i instanceof Error?i.message:"Unknown error"}`,c=new Error(o);throw this.config.onError?(this.config.onError(c,{reason:s.reason,errorType:s.errorType}),c):(console.warn("[TicketManager] No onError callback configured, throwing error"),c)}if(r===e)throw new Error(`Ticket refresh failed after ${e} attempts (${s.reason}): ${i instanceof Error?i.message:"Unknown error"}`);const a=n*Math.pow(2,r-1);console.log(`TicketManager: Ticket request failed (${s.reason}), retrying in ${a}ms...`),await new Promise(o=>setTimeout(o,a))}}throw new Error("Ticket refresh failed unexpectedly")}startProactiveRenewal(e){this.stopProactiveRenewal(),console.log("TicketManager: Starting proactive renewal",{checkInterval:this.config.checkInterval,renewalThreshold:this.config.renewalThreshold}),this.validationInterval=window.setInterval(async()=>{await this.checkAndRenew(e)},this.config.checkInterval)}async checkAndRenew(e){if(!this.ticket){console.warn("TicketManager: No ticket to validate");return}try{const r=ki(this.ticket).expiresIn/1e3;r<this.config.renewalThreshold&&(console.log(`TicketManager: Ticket expires in ${r.toFixed(0)}s, renewing...`),await this.refreshTicket(),console.log("TicketManager: Ticket renewed proactively"),e==null||e())}catch(n){const r=Jt(n,"TicketManager:ProactiveRenewal");if(!r.isRetryable&&(console.warn(`TicketManager: Stopping proactive renewal due to non-retryable error: ${r.reason}`),this.stopProactiveRenewal(),this.config.onError)){const i=new Error(`Proactive ticket renewal failed (non-retryable - ${r.reason}): ${n instanceof Error?n.message:"Unknown error"}`);this.config.onError(i,{reason:r.reason,errorType:r.errorType})}}}stopProactiveRenewal(){this.validationInterval&&(clearInterval(this.validationInterval),this.validationInterval=null,console.log("TicketManager: Stopped proactive renewal"))}isValid(){return this.ticket?vr(this.ticket):!1}async validateWithServer(){if(!this.ticket)return{valid:!1,error:"No ticket available to validate",code:"NO_TICKET"};const e=Date.now();if(this.ticketObtainedAt&&e-this.ticketObtainedAt<this.freshTicketThreshold){const n=((e-this.ticketObtainedAt)/1e3).toFixed(1);return console.log(`[TicketManager] Skipping validation - ticket is fresh (${n}s old):`,{ticket:this.ticket.ticket.substring(0,8)+"..."}),{valid:!0,code:"FRESH_TICKET"}}if(this.lastValidationResult&&this.lastValidationResult.ticket===this.ticket.ticket&&e-this.lastValidationResult.timestamp<this.validationCacheTTL){const n=((e-this.lastValidationResult.timestamp)/1e3).toFixed(1);return console.log(`[TicketManager] Using cached validation result (${n}s old):`,{valid:this.lastValidationResult.valid,ticket:this.ticket.ticket.substring(0,8)+"..."}),{valid:this.lastValidationResult.valid,code:this.lastValidationResult.valid?"VALID":"INVALID_CACHED"}}try{console.log("[TicketManager] Validating ticket with server API...");const n=await Do(this.apiUrl,this.ticket.ticket,{userMpAuthToken:this.authData.userMpAuthToken,chatServerKey:this.authData.chatServerKey},{entityId:this.authData.entityId,entityType:this.authData.entityType});return console.log("[TicketManager] Server validation result:",{valid:n.valid,error:n.error,code:n.code,retryable:n.retryable}),(!n.retryable||n.valid)&&(this.lastValidationResult={ticket:this.ticket.ticket,valid:n.valid,timestamp:e},console.log("[TicketManager] Cached validation result for 30 seconds")),n.valid||(n.retryable?console.log("[TicketManager] Validation API failed (connectivity issue) - will get fresh ticket and retry"):(console.log("[TicketManager] Ticket is definitively invalid - clearing and will get fresh ticket"),this.ticket=null)),n}catch(n){return console.error("[TicketManager] Server validation failed unexpectedly:",n),{valid:!1,error:n instanceof Error?n.message:"Server validation failed unexpectedly",code:"VALIDATION_ERROR",details:{reason:"Unexpected error during validation - will retry with fresh ticket",retryable:!0}}}}getExpiresIn(){if(this.ticket)try{return ki(this.ticket).expiresIn}catch(e){console.warn("TicketManager: Error getting ticket info",e);return}}getExpiresAt(){var e;return(e=this.ticket)==null?void 0:e.expiresAt}updateAuthData(e){this.authData={...this.authData,...e},console.log("TicketManager: Auth data updated")}clear(){this.ticket=null,this.ticketObtainedAt=null,this.lastValidationResult=null,this.stopProactiveRenewal(),console.log("TicketManager: Ticket cleared")}getDebugInfo(){return{hasTicket:!!this.ticket,isValid:this.isValid(),expiresAt:this.getExpiresAt(),expiresIn:this.getExpiresIn(),isRefreshing:!!this.refreshPromise}}}async function Ws(t,e,n){const r=new URLSearchParams;r.append("format","client"),e.entityId&&r.append("entityId",e.entityId),e.entityType&&r.append("entityType",e.entityType),console.log("Metadata to append:",e.metadata),e.metadata&&Object.keys(e.metadata).length>0&&r.append("metadata",JSON.stringify(e.metadata));const i=`${t}/api/v1/messages/query?${r.toString()}`,s={"Content-Type":"application/json"};n!=null&&n.userMpAuthToken&&(s["x-oddle-mp-auth-token"]=n.userMpAuthToken),n!=null&&n.chatServerKey&&(s["x-oddle-chat-server-key"]=n.chatServerKey),console.log("Fetching thread messages from:",i);const a=await fetch(i,{method:"GET",headers:s});if(!a.ok)throw new Error(`Failed to fetch thread messages: ${a.statusText}`);const o=await a.json();return{messages:o.messages||[],providerResId:o.providerResId,threadId:o.threadId}}async function Gs(t,e,n,r){const i=`${t}/api/v1/threads/${e}`,s={"Content-Type":"application/json"};r!=null&&r.userMpAuthToken&&(s["x-oddle-mp-auth-token"]=r.userMpAuthToken),r!=null&&r.chatServerKey&&(s["x-oddle-chat-server-key"]=r.chatServerKey);const a=await fetch(i,{method:"PATCH",headers:s,body:JSON.stringify(n)});if(!a.ok){const c=await a.json().catch(()=>({error:"Failed to update thread"}));throw new Error(c.error||"Failed to update thread")}const o=await a.json();if(!o.success)throw new Error(o.error||"Failed to update thread");return o.data}async function qs(t,e,n,r){const i=`${t}/api/v1/threads/${e}`,s={"Content-Type":"application/json"};r!=null&&r.userMpAuthToken&&(s["x-oddle-mp-auth-token"]=r.userMpAuthToken),r!=null&&r.chatServerKey&&(s["x-oddle-chat-server-key"]=r.chatServerKey);const a=await fetch(i,{method:"PATCH",headers:s,body:JSON.stringify(n)});if(!a.ok){const c=await a.json().catch(()=>({error:"Failed to update thread metadata"}));throw new Error(c.error||"Failed to update thread metadata")}const o=await a.json();if(!o.success)throw new Error(o.error||"Failed to update thread metadata");return o.data}class Ho{constructor(){q(this,"config");q(this,"connectionState");q(this,"wsManager");q(this,"messageHandler");q(this,"initResolve");q(this,"initReject");q(this,"toolSchemas",[]);q(this,"contextHelpers",{});q(this,"ticketManager",null);q(this,"authCredentials",{});this.config={...Io},this.connectionState=new Mo,this.wsManager=new No(this.config,this.connectionState),this.messageHandler=new Lo({}),this.setupWebSocketHandlers()}setupWebSocketHandlers(){this.wsManager.setEventHandlers({onMessage:e=>this.handleWebSocketMessage(e),onOpen:()=>this.handleConnectionOpen(),onSystemEvent:e=>{var r,i;(i=(r=this.messageHandler.handlers)==null?void 0:r.onSystemEvent)==null||i.call(r,e)},onTicketRefresh:async()=>{if(!this.ticketManager)throw new Error("TicketManager not available for ticket refresh");return await this.ticketManager.getValidTicket()},onTicketValidate:async()=>{if(!this.ticketManager)return!1;try{return(await this.ticketManager.validateWithServer()).valid}catch{return!1}}}),this.messageHandler.setSendMessageHandler(e=>this.wsManager.send(e))}handleWebSocketMessage(e){var r,i,s,a;const n=this.messageHandler.handleMessage(e);if((n==null?void 0:n.type)==="authentication_error"&&this.handleAuthenticationFailure(n),(n==null?void 0:n.type)===Ve.THREAD_CREATED){(i=(r=this.messageHandler.handlers)==null?void 0:r.onThreadCreated)==null||i.call(r,n.data);return}if((n==null?void 0:n.type)===Ve.TOOLS_CONFIGURED){(s=this.initResolve)==null||s.call(this);return}(n==null?void 0:n.type)===Ve.SESSION_ESTABLISHED&&(this.toolSchemas&&this.toolSchemas.length>0?this.sendToolConfiguration():(a=this.initResolve)==null||a.call(this))}handleConnectionOpen(){}handleAuthenticationFailure(e){var r;const n=e;(n==null?void 0:n.code)==="TICKET_INVALID"||(n==null?void 0:n.code)==="TICKET_EXPIRED"?this.refreshTicketAndReconnect().catch(i=>{var a;Jt(i,"TicketRefresh").isRetryable,(a=this.initReject)==null||a.call(this,i)}):(r=this.initReject)==null||r.call(this,new Error(`Authentication failed: ${n==null?void 0:n.error}`))}sendToolConfiguration(){const e=Nt.serializeConfigureTools(this.toolSchemas,this.contextHelpers);this.wsManager.send(e)}async onInit(e){return this.setupEventHandlers(e),this.setupToolsAndContext(e),this.updateConfig(e),this.authCredentials={userMpAuthToken:e.userMpAuthToken,chatServerKey:e.chatServerKey},this.ticketManager=new Fo({userMpAuthToken:e.userMpAuthToken,chatServerKey:e.chatServerKey,entityId:e.entityId,entityType:e.entityType},this.config.apiUrl,{onError:e.onError}),new Promise(async(n,r)=>{this.initResolve=n,this.initReject=r;try{const i=await this.ticketManager.getValidTicket();await this.wsManager.connect(i)}catch(i){r(i)}})}setupEventHandlers(e){const n={onSetMessage:e.onSetMessage,onSystemEvent:e.onSystemEvent,onReasoningUpdate:e.onReasoningUpdate,onThreadCreated:e.onThreadCreated,onMessagesPersisted:e.onMessagesPersisted};this.messageHandler.updateEventHandlers(n)}setupToolsAndContext(e){this.toolSchemas=e.toolSchemas||[],this.contextHelpers=e.contextHelpers,e.clientTools&&this.messageHandler.updateClientTools(e.clientTools)}updateConfig(e){e.chatServerUrl&&(this.config.apiUrl=e.chatServerUrl)}async onTriggerMessage(e){const n=this.wsManager.getWebSocketState();if(!this.connectionState.isConnected||n!=="OPEN"){const o="Connection lost. Please check your internet connection and try again.";throw new Error(o)}const{message:i,media:s,providerResId:a}=e;try{this.messageHandler.clearProcessedToolCalls();const o=Nt.serializeChatMessage({content:i,media:s,providerResId:a});this.wsManager.send(o)}catch(o){throw this.wsManager.getWebSocketState()!=="OPEN"?new Error("Connection lost during message send. Please try again."):o}}disconnect(){var e,n;(e=this.ticketManager)==null||e.stopProactiveRenewal(),(n=this.ticketManager)==null||n.clear(),this.wsManager.disconnect()}isClientConnected(){return this.connectionState.isConnected}updateContextHelpers(e){this.contextHelpers={...this.contextHelpers,...e};const n=Nt.serializeUpdateContextHelpers(this.contextHelpers);this.wsManager.send(n)}addClientTools(e,n){this.messageHandler.updateClientTools(e),n&&(this.toolSchemas=[...this.toolSchemas,...n]);const r=Nt.serializeUpdateTools(this.toolSchemas);this.wsManager.send(r)}updateClientTools(e){this.messageHandler.updateClientTools(e)}getConnectionStatus(){var e,n;return{connected:this.connectionState.isConnected,reconnectAttempts:this.connectionState.reconnectAttempts,isReconnecting:this.connectionState.isReconnecting,websocketState:this.wsManager.getWebSocketState(),hasValidTicket:((e=this.ticketManager)==null?void 0:e.isValid())??!1,ticketExpiresIn:(n=this.ticketManager)==null?void 0:n.getExpiresIn()}}async refreshTicketAndReconnect(){try{if(!this.ticketManager)throw new Error("TicketManager not initialized");this.wsManager.disconnect();const e=await this.ticketManager.refreshTicket();this.wsManager.updateTicket(e),await this.wsManager.connect()}catch(e){throw e}}isTicketValid(){var e;return((e=this.ticketManager)==null?void 0:e.isValid())??!1}async reconnect(){await this.refreshTicketAndReconnect()}stopRun(e){if(!this.connectionState.isConnected)return;const n=Nt.serializeStopRun(e);this.wsManager.send(n)}async updateEntityId(e,n,r){if(!this.ticketManager)throw new Error("WebSocketChatClient: Cannot update entityId - TicketManager not initialized");try{await Gs(this.config.apiUrl,e,{entityId:n,entityType:r},this.authCredentials);const i={entityId:n,entityType:r};this.ticketManager.updateAuthData(i)}catch(i){throw i}}async updateMetadata(e,n){try{await qs(this.config.apiUrl,e,n,this.authCredentials)}catch(r){throw r}}}function zo({userMpAuthToken:t,chatServerUrl:e,chatServerKey:n,entityId:r,entityType:i,tools:s,contextHelpers:a,onSetMessage:o,onSystemEvent:c,onReasoningUpdate:u,onThreadCreated:l,onMessagesPersisted:d,onError:g}){const[p,x]=k.useState(null),[S,N]=k.useState(Ae.DISCONNECTED),[E,v]=k.useState(0),[M,O]=k.useState(!0),P=k.useRef(null),b=k.useRef(o),z=k.useRef(c),U=k.useRef(u),W=k.useRef(l),Y=k.useRef(d),G=k.useRef(t),H=k.useRef(e),_=k.useRef(n),L=k.useRef(r),F=k.useRef(i),ee=k.useRef(s),se=k.useRef(s);k.useEffect(()=>{JSON.stringify(s)!==JSON.stringify(ee.current)&&(ee.current=s,se.current=s)},[s]);const pe=k.useRef(a),ge=k.useRef(a);k.useEffect(()=>{JSON.stringify(a)!==JSON.stringify(pe.current)&&(pe.current=a,ge.current=a,P.current&&a&&P.current.updateContextHelpers(a))},[a]),k.useEffect(()=>{b.current=o,z.current=c,U.current=u,W.current=l,Y.current=d,G.current=t,H.current=e,_.current=n,L.current=r,F.current=i},[o,c,u,l,d,t,e,n,r,i]);const y=k.useMemo(()=>{const oe=se.current;return oe&&oe.length>0?oe.map(({execute:ne,...te})=>te):[]},[se.current]),Q=k.useMemo(()=>{if(s&&s.length>0){const oe={};return s.forEach(ne=>{oe[ne.name]=ne.execute}),oe}return{}},[s]);k.useEffect(()=>{P.current&&Object.keys(Q).length>0&&P.current.updateClientTools(Q)},[Q]);const B=k.useRef(),C=k.useCallback(async()=>{var oe;try{if(console.log("[useWebSocketConnection] Starting connection attempt..."),!navigator.onLine)throw console.log("[useWebSocketConnection] Connection failed - offline"),N(Ae.DISCONNECTED),O(!1),new Error("No internet connection. Please check your network and try again.");if(console.log("[useWebSocketConnection] Setting state to CONNECTING"),N(Ae.CONNECTING),!G.current)throw new Error("userMpAuthToken is required");if(!H.current)throw new Error("chatServerUrl is required");if(!_.current)throw new Error("chatServerKey is required");const ne=new Ho;P.current=ne,x(ne);const te=ge.current||{};console.log("[useWebSocketConnection] Calling client.onInit()..."),await ne.onInit({userMpAuthToken:G.current,chatServerUrl:H.current,chatServerKey:_.current,entityId:L.current,entityType:(oe=F.current)==null?void 0:oe.toString(),toolSchemas:y,clientTools:Q,contextHelpers:te,onSetMessage:b.current,onSystemEvent:z.current,onReasoningUpdate:U.current,onThreadCreated:W.current,onMessagesPersisted:Y.current,onError:g}),console.log("[useWebSocketConnection] client.onInit() completed successfully, setting state to CONNECTED"),N(Ae.CONNECTED),O(!1)}catch(ne){console.error("[useWebSocketConnection] Connection failed:",ne);const te=Jt(ne,"WebSocketConnection");console.log("[useWebSocketConnection] Setting state to DISCONNECTED, isRetryable:",te.isRetryable),N(Ae.DISCONNECTED),te.isRetryable?(console.log("[useWebSocketConnection] Scheduling retry in 2 seconds..."),setTimeout(()=>{var xe;(P.current===null||!P.current.getConnectionStatus().connected)&&(console.log("[useWebSocketConnection] Executing retry..."),(xe=B.current)==null||xe.call(B))},2e3)):(console.log("[useWebSocketConnection] Non-retryable error, not retrying"),O(!1))}},[y,Q,g]),ie=k.useCallback(()=>{P.current&&(P.current.disconnect(),P.current=null),x(null),N(Ae.DISCONNECTED)},[]);B.current=C;const K=k.useRef(!1);return k.useEffect(()=>(K.current||(K.current=!0,C()),()=>{ie()}),[]),k.useEffect(()=>{const oe=setInterval(()=>{if(P.current){const ne=P.current.getConnectionStatus();if(console.log("[useWebSocketConnection] Status check:",{currentConnectionState:S,isInitialConnection:M,clientStatus:{connected:ne.connected,isReconnecting:ne.isReconnecting,reconnectAttempts:ne.reconnectAttempts,websocketState:ne.websocketState,hasValidTicket:ne.hasValidTicket}}),M&&S===Ae.CONNECTING){console.log("[useWebSocketConnection] Skipping state update - initial connection in progress");return}ne.connected&&S!==Ae.CONNECTED?(console.log("[useWebSocketConnection] State change: CONNECTING/RECONNECTING -> CONNECTED"),N(Ae.CONNECTED)):ne.isReconnecting&&S!==Ae.RECONNECTING?(console.log("[useWebSocketConnection] State change: -> RECONNECTING"),N(Ae.RECONNECTING)):!ne.connected&&!ne.isReconnecting&&S!==Ae.DISCONNECTED&&(console.log("[useWebSocketConnection] State change: -> DISCONNECTED"),N(Ae.DISCONNECTED)),v(ne.reconnectAttempts)}},1e3);return()=>clearInterval(oe)},[S,M]),{chatClient:p,connectionState:S,reconnectAttempts:E,isInitialConnection:M,connectChatClient:C,disconnectChatClient:ie}}/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:Ks,setPrototypeOf:Ti,isFrozen:Uo,getPrototypeOf:Bo,getOwnPropertyDescriptor:$o}=Object;let{freeze:Ze,seal:ut,create:Rr}=Object,{apply:Ir,construct:Nr}=typeof Reflect<"u"&&Reflect;Ze||(Ze=function(e){return e});ut||(ut=function(e){return e});Ir||(Ir=function(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return e.apply(n,i)});Nr||(Nr=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return new e(...r)});const An=Ye(Array.prototype.forEach),Vo=Ye(Array.prototype.lastIndexOf),Ei=Ye(Array.prototype.pop),an=Ye(Array.prototype.push),Wo=Ye(Array.prototype.splice),zn=Ye(String.prototype.toLowerCase),ir=Ye(String.prototype.toString),sr=Ye(String.prototype.match),on=Ye(String.prototype.replace),Go=Ye(String.prototype.indexOf),qo=Ye(String.prototype.trim),pt=Ye(Object.prototype.hasOwnProperty),Ke=Ye(RegExp.prototype.test),ln=Ko(TypeError);function Ye(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return Ir(t,e,r)}}function Ko(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return Nr(t,n)}}function fe(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:zn;Ti&&Ti(t,null);let r=e.length;for(;r--;){let i=e[r];if(typeof i=="string"){const s=n(i);s!==i&&(Uo(e)||(e[r]=s),i=s)}t[i]=!0}return t}function Zo(t){for(let e=0;e<t.length;e++)pt(t,e)||(t[e]=null);return t}function It(t){const e=Rr(null);for(const[n,r]of Ks(t))pt(t,n)&&(Array.isArray(r)?e[n]=Zo(r):r&&typeof r=="object"&&r.constructor===Object?e[n]=It(r):e[n]=r);return e}function cn(t,e){for(;t!==null;){const r=$o(t,e);if(r){if(r.get)return Ye(r.get);if(typeof r.value=="function")return Ye(r.value)}t=Bo(t)}function n(){return null}return n}const bi=Ze(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),ar=Ze(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),or=Ze(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),Yo=Ze(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),lr=Ze(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Xo=Ze(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),_i=Ze(["#text"]),vi=Ze(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),cr=Ze(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ri=Ze(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),On=Ze(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Jo=ut(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Qo=ut(/<%[\w\W]*|[\w\W]*%>/gm),el=ut(/\$\{[\w\W]*/gm),tl=ut(/^data-[\-\w.\u00B7-\uFFFF]+$/),nl=ut(/^aria-[\-\w]+$/),Zs=ut(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),rl=ut(/^(?:\w+script|data):/i),il=ut(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ys=ut(/^html$/i),sl=ut(/^[a-z][.\w]*(-[.\w]+)+$/i);var Ii=Object.freeze({__proto__:null,ARIA_ATTR:nl,ATTR_WHITESPACE:il,CUSTOM_ELEMENT:sl,DATA_ATTR:tl,DOCTYPE_NAME:Ys,ERB_EXPR:Qo,IS_ALLOWED_URI:Zs,IS_SCRIPT_OR_DATA:rl,MUSTACHE_EXPR:Jo,TMPLIT_EXPR:el});const un={element:1,text:3,progressingInstruction:7,comment:8,document:9},al=function(){return typeof window>"u"?null:window},ol=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const i="data-tt-policy-suffix";n&&n.hasAttribute(i)&&(r=n.getAttribute(i));const s="dompurify"+(r?"#"+r:"");try{return e.createPolicy(s,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+s+" could not be created."),null}},Ni=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Xs(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:al();const e=re=>Xs(re);if(e.version="3.3.0",e.removed=[],!t||!t.document||t.document.nodeType!==un.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const r=n,i=r.currentScript,{DocumentFragment:s,HTMLTemplateElement:a,Node:o,Element:c,NodeFilter:u,NamedNodeMap:l=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:g,trustedTypes:p}=t,x=c.prototype,S=cn(x,"cloneNode"),N=cn(x,"remove"),E=cn(x,"nextSibling"),v=cn(x,"childNodes"),M=cn(x,"parentNode");if(typeof a=="function"){const re=n.createElement("template");re.content&&re.content.ownerDocument&&(n=re.content.ownerDocument)}let O,P="";const{implementation:b,createNodeIterator:z,createDocumentFragment:U,getElementsByTagName:W}=n,{importNode:Y}=r;let G=Ni();e.isSupported=typeof Ks=="function"&&typeof M=="function"&&b&&b.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:H,ERB_EXPR:_,TMPLIT_EXPR:L,DATA_ATTR:F,ARIA_ATTR:ee,IS_SCRIPT_OR_DATA:se,ATTR_WHITESPACE:pe,CUSTOM_ELEMENT:ge}=Ii;let{IS_ALLOWED_URI:y}=Ii,Q=null;const B=fe({},[...bi,...ar,...or,...lr,..._i]);let C=null;const ie=fe({},[...vi,...cr,...Ri,...On]);let K=Object.seal(Rr(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),oe=null,ne=null;const te=Object.seal(Rr(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let xe=!0,de=!0,_e=!1,Te=!0,Oe=!1,it=!0,st=!1,Et=!1,bt=!1,gt=!1,_t=!1,mt=!1,jt=!0,Ft=!1;const Ht="user-content-";let ht=!0,dt=!1,R={},I=null;const V=fe({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let J=null;const he=fe({},["audio","video","img","source","image","track"]);let ve=null;const De=fe({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),je="http://www.w3.org/1998/Math/MathML",Je="http://www.w3.org/2000/svg",Fe="http://www.w3.org/1999/xhtml";let ye=Fe,Ge=!1,He=null;const bn=fe({},[je,Je,Fe],ir);let Vt=fe({},["mi","mo","mn","ms","mtext"]),Wt=fe({},["annotation-xml"]);const _n=fe({},["title","style","font","a","script"]);let At=null;const vn=["application/xhtml+xml","text/html"],Rn="text/html";let Re=null,vt=null;const In=n.createElement("form"),nn=function(w){return w instanceof RegExp||w instanceof Function},rn=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(vt&&vt===w)){if((!w||typeof w!="object")&&(w={}),w=It(w),At=vn.indexOf(w.PARSER_MEDIA_TYPE)===-1?Rn:w.PARSER_MEDIA_TYPE,Re=At==="application/xhtml+xml"?ir:zn,Q=pt(w,"ALLOWED_TAGS")?fe({},w.ALLOWED_TAGS,Re):B,C=pt(w,"ALLOWED_ATTR")?fe({},w.ALLOWED_ATTR,Re):ie,He=pt(w,"ALLOWED_NAMESPACES")?fe({},w.ALLOWED_NAMESPACES,ir):bn,ve=pt(w,"ADD_URI_SAFE_ATTR")?fe(It(De),w.ADD_URI_SAFE_ATTR,Re):De,J=pt(w,"ADD_DATA_URI_TAGS")?fe(It(he),w.ADD_DATA_URI_TAGS,Re):he,I=pt(w,"FORBID_CONTENTS")?fe({},w.FORBID_CONTENTS,Re):V,oe=pt(w,"FORBID_TAGS")?fe({},w.FORBID_TAGS,Re):It({}),ne=pt(w,"FORBID_ATTR")?fe({},w.FORBID_ATTR,Re):It({}),R=pt(w,"USE_PROFILES")?w.USE_PROFILES:!1,xe=w.ALLOW_ARIA_ATTR!==!1,de=w.ALLOW_DATA_ATTR!==!1,_e=w.ALLOW_UNKNOWN_PROTOCOLS||!1,Te=w.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Oe=w.SAFE_FOR_TEMPLATES||!1,it=w.SAFE_FOR_XML!==!1,st=w.WHOLE_DOCUMENT||!1,gt=w.RETURN_DOM||!1,_t=w.RETURN_DOM_FRAGMENT||!1,mt=w.RETURN_TRUSTED_TYPE||!1,bt=w.FORCE_BODY||!1,jt=w.SANITIZE_DOM!==!1,Ft=w.SANITIZE_NAMED_PROPS||!1,ht=w.KEEP_CONTENT!==!1,dt=w.IN_PLACE||!1,y=w.ALLOWED_URI_REGEXP||Zs,ye=w.NAMESPACE||Fe,Vt=w.MATHML_TEXT_INTEGRATION_POINTS||Vt,Wt=w.HTML_INTEGRATION_POINTS||Wt,K=w.CUSTOM_ELEMENT_HANDLING||{},w.CUSTOM_ELEMENT_HANDLING&&nn(w.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(K.tagNameCheck=w.CUSTOM_ELEMENT_HANDLING.tagNameCheck),w.CUSTOM_ELEMENT_HANDLING&&nn(w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(K.attributeNameCheck=w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),w.CUSTOM_ELEMENT_HANDLING&&typeof w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(K.allowCustomizedBuiltInElements=w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Oe&&(de=!1),_t&&(gt=!0),R&&(Q=fe({},_i),C=[],R.html===!0&&(fe(Q,bi),fe(C,vi)),R.svg===!0&&(fe(Q,ar),fe(C,cr),fe(C,On)),R.svgFilters===!0&&(fe(Q,or),fe(C,cr),fe(C,On)),R.mathMl===!0&&(fe(Q,lr),fe(C,Ri),fe(C,On))),w.ADD_TAGS&&(typeof w.ADD_TAGS=="function"?te.tagCheck=w.ADD_TAGS:(Q===B&&(Q=It(Q)),fe(Q,w.ADD_TAGS,Re))),w.ADD_ATTR&&(typeof w.ADD_ATTR=="function"?te.attributeCheck=w.ADD_ATTR:(C===ie&&(C=It(C)),fe(C,w.ADD_ATTR,Re))),w.ADD_URI_SAFE_ATTR&&fe(ve,w.ADD_URI_SAFE_ATTR,Re),w.FORBID_CONTENTS&&(I===V&&(I=It(I)),fe(I,w.FORBID_CONTENTS,Re)),ht&&(Q["#text"]=!0),st&&fe(Q,["html","head","body"]),Q.table&&(fe(Q,["tbody"]),delete oe.tbody),w.TRUSTED_TYPES_POLICY){if(typeof w.TRUSTED_TYPES_POLICY.createHTML!="function")throw ln('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof w.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ln('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');O=w.TRUSTED_TYPES_POLICY,P=O.createHTML("")}else O===void 0&&(O=ol(p,i)),O!==null&&typeof P=="string"&&(P=O.createHTML(""));Ze&&Ze(w),vt=w}},nr=fe({},[...ar,...or,...Yo]),sn=fe({},[...lr,...Xo]),Nn=function(w){let j=M(w);(!j||!j.tagName)&&(j={namespaceURI:ye,tagName:"template"});const X=zn(w.tagName),be=zn(j.tagName);return He[w.namespaceURI]?w.namespaceURI===Je?j.namespaceURI===Fe?X==="svg":j.namespaceURI===je?X==="svg"&&(be==="annotation-xml"||Vt[be]):!!nr[X]:w.namespaceURI===je?j.namespaceURI===Fe?X==="math":j.namespaceURI===Je?X==="math"&&Wt[be]:!!sn[X]:w.namespaceURI===Fe?j.namespaceURI===Je&&!Wt[be]||j.namespaceURI===je&&!Vt[be]?!1:!sn[X]&&(_n[X]||!nr[X]):!!(At==="application/xhtml+xml"&&He[w.namespaceURI]):!1},A=function(w){an(e.removed,{element:w});try{M(w).removeChild(w)}catch{N(w)}},me=function(w,j){try{an(e.removed,{attribute:j.getAttributeNode(w),from:j})}catch{an(e.removed,{attribute:null,from:j})}if(j.removeAttribute(w),w==="is")if(gt||_t)try{A(j)}catch{}else try{j.setAttribute(w,"")}catch{}},qe=function(w){let j=null,X=null;if(bt)w="<remove></remove>"+w;else{const Ne=sr(w,/^[\r\n\t ]+/);X=Ne&&Ne[0]}At==="application/xhtml+xml"&&ye===Fe&&(w='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+w+"</body></html>");const be=O?O.createHTML(w):w;if(ye===Fe)try{j=new g().parseFromString(be,At)}catch{}if(!j||!j.documentElement){j=b.createDocument(ye,"template",null);try{j.documentElement.innerHTML=Ge?P:be}catch{}}const $e=j.body||j.documentElement;return w&&X&&$e.insertBefore(n.createTextNode(X),$e.childNodes[0]||null),ye===Fe?W.call(j,st?"html":"body")[0]:st?j.documentElement:$e},Ie=function(w){return z.call(w.ownerDocument||w,w,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},Ee=function(w){return w instanceof d&&(typeof w.nodeName!="string"||typeof w.textContent!="string"||typeof w.removeChild!="function"||!(w.attributes instanceof l)||typeof w.removeAttribute!="function"||typeof w.setAttribute!="function"||typeof w.namespaceURI!="string"||typeof w.insertBefore!="function"||typeof w.hasChildNodes!="function")},Le=function(w){return typeof o=="function"&&w instanceof o};function Be(re,w,j){An(re,X=>{X.call(e,w,j,vt)})}const Ot=function(w){let j=null;if(Be(G.beforeSanitizeElements,w,null),Ee(w))return A(w),!0;const X=Re(w.nodeName);if(Be(G.uponSanitizeElement,w,{tagName:X,allowedTags:Q}),it&&w.hasChildNodes()&&!Le(w.firstElementChild)&&Ke(/<[/\w!]/g,w.innerHTML)&&Ke(/<[/\w!]/g,w.textContent)||w.nodeType===un.progressingInstruction||it&&w.nodeType===un.comment&&Ke(/<[/\w]/g,w.data))return A(w),!0;if(!(te.tagCheck instanceof Function&&te.tagCheck(X))&&(!Q[X]||oe[X])){if(!oe[X]&&xi(X)&&(K.tagNameCheck instanceof RegExp&&Ke(K.tagNameCheck,X)||K.tagNameCheck instanceof Function&&K.tagNameCheck(X)))return!1;if(ht&&!I[X]){const be=M(w)||w.parentNode,$e=v(w)||w.childNodes;if($e&&be){const Ne=$e.length;for(let Qe=Ne-1;Qe>=0;--Qe){const Rt=S($e[Qe],!0);Rt.__removalCount=(w.__removalCount||0)+1,be.insertBefore(Rt,E(w))}}}return A(w),!0}return w instanceof c&&!Nn(w)||(X==="noscript"||X==="noembed"||X==="noframes")&&Ke(/<\/no(script|embed|frames)/i,w.innerHTML)?(A(w),!0):(Oe&&w.nodeType===un.text&&(j=w.textContent,An([H,_,L],be=>{j=on(j,be," ")}),w.textContent!==j&&(an(e.removed,{element:w.cloneNode()}),w.textContent=j)),Be(G.afterSanitizeElements,w,null),!1)},Ci=function(w,j,X){if(jt&&(j==="id"||j==="name")&&(X in n||X in In))return!1;if(!(de&&!ne[j]&&Ke(F,j))){if(!(xe&&Ke(ee,j))){if(!(te.attributeCheck instanceof Function&&te.attributeCheck(j,w))){if(!C[j]||ne[j]){if(!(xi(w)&&(K.tagNameCheck instanceof RegExp&&Ke(K.tagNameCheck,w)||K.tagNameCheck instanceof Function&&K.tagNameCheck(w))&&(K.attributeNameCheck instanceof RegExp&&Ke(K.attributeNameCheck,j)||K.attributeNameCheck instanceof Function&&K.attributeNameCheck(j,w))||j==="is"&&K.allowCustomizedBuiltInElements&&(K.tagNameCheck instanceof RegExp&&Ke(K.tagNameCheck,X)||K.tagNameCheck instanceof Function&&K.tagNameCheck(X))))return!1}else if(!ve[j]){if(!Ke(y,on(X,pe,""))){if(!((j==="src"||j==="xlink:href"||j==="href")&&w!=="script"&&Go(X,"data:")===0&&J[w])){if(!(_e&&!Ke(se,on(X,pe,"")))){if(X)return!1}}}}}}}return!0},xi=function(w){return w!=="annotation-xml"&&sr(w,ge)},yi=function(w){Be(G.beforeSanitizeAttributes,w,null);const{attributes:j}=w;if(!j||Ee(w))return;const X={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:C,forceKeepAttr:void 0};let be=j.length;for(;be--;){const $e=j[be],{name:Ne,namespaceURI:Qe,value:Rt}=$e,Gt=Re(Ne),rr=Rt;let ze=Ne==="value"?rr:qo(rr);if(X.attrName=Gt,X.attrValue=ze,X.keepAttr=!0,X.forceKeepAttr=void 0,Be(G.uponSanitizeAttribute,w,X),ze=X.attrValue,Ft&&(Gt==="id"||Gt==="name")&&(me(Ne,w),ze=Ht+ze),it&&Ke(/((--!?|])>)|<\/(style|title|textarea)/i,ze)){me(Ne,w);continue}if(Gt==="attributename"&&sr(ze,"href")){me(Ne,w);continue}if(X.forceKeepAttr)continue;if(!X.keepAttr){me(Ne,w);continue}if(!Te&&Ke(/\/>/i,ze)){me(Ne,w);continue}Oe&&An([H,_,L],wi=>{ze=on(ze,wi," ")});const Si=Re(w.nodeName);if(!Ci(Si,Gt,ze)){me(Ne,w);continue}if(O&&typeof p=="object"&&typeof p.getAttributeType=="function"&&!Qe)switch(p.getAttributeType(Si,Gt)){case"TrustedHTML":{ze=O.createHTML(ze);break}case"TrustedScriptURL":{ze=O.createScriptURL(ze);break}}if(ze!==rr)try{Qe?w.setAttributeNS(Qe,Ne,ze):w.setAttribute(Ne,ze),Ee(w)?A(w):Ei(e.removed)}catch{me(Ne,w)}}Be(G.afterSanitizeAttributes,w,null)},wo=function re(w){let j=null;const X=Ie(w);for(Be(G.beforeSanitizeShadowDOM,w,null);j=X.nextNode();)Be(G.uponSanitizeShadowNode,j,null),Ot(j),yi(j),j.content instanceof s&&re(j.content);Be(G.afterSanitizeShadowDOM,w,null)};return e.sanitize=function(re){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},j=null,X=null,be=null,$e=null;if(Ge=!re,Ge&&(re="<!-->"),typeof re!="string"&&!Le(re))if(typeof re.toString=="function"){if(re=re.toString(),typeof re!="string")throw ln("dirty is not a string, aborting")}else throw ln("toString is not a function");if(!e.isSupported)return re;if(Et||rn(w),e.removed=[],typeof re=="string"&&(dt=!1),dt){if(re.nodeName){const Rt=Re(re.nodeName);if(!Q[Rt]||oe[Rt])throw ln("root node is forbidden and cannot be sanitized in-place")}}else if(re instanceof o)j=qe("<!---->"),X=j.ownerDocument.importNode(re,!0),X.nodeType===un.element&&X.nodeName==="BODY"||X.nodeName==="HTML"?j=X:j.appendChild(X);else{if(!gt&&!Oe&&!st&&re.indexOf("<")===-1)return O&&mt?O.createHTML(re):re;if(j=qe(re),!j)return gt?null:mt?P:""}j&&bt&&A(j.firstChild);const Ne=Ie(dt?re:j);for(;be=Ne.nextNode();)Ot(be),yi(be),be.content instanceof s&&wo(be.content);if(dt)return re;if(gt){if(_t)for($e=U.call(j.ownerDocument);j.firstChild;)$e.appendChild(j.firstChild);else $e=j;return(C.shadowroot||C.shadowrootmode)&&($e=Y.call(r,$e,!0)),$e}let Qe=st?j.outerHTML:j.innerHTML;return st&&Q["!doctype"]&&j.ownerDocument&&j.ownerDocument.doctype&&j.ownerDocument.doctype.name&&Ke(Ys,j.ownerDocument.doctype.name)&&(Qe="<!DOCTYPE "+j.ownerDocument.doctype.name+`>
`+Qe),Oe&&An([H,_,L],Rt=>{Qe=on(Qe,Rt," ")}),O&&mt?O.createHTML(Qe):Qe},e.setConfig=function(){let re=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};rn(re),Et=!0},e.clearConfig=function(){vt=null,Et=!1},e.isValidAttribute=function(re,w,j){vt||rn({});const X=Re(re),be=Re(w);return Ci(X,be,j)},e.addHook=function(re,w){typeof w=="function"&&an(G[re],w)},e.removeHook=function(re,w){if(w!==void 0){const j=Vo(G[re],w);return j===-1?void 0:Wo(G[re],j,1)[0]}return Ei(G[re])},e.removeHooks=function(re){G[re]=[]},e.removeAllHooks=function(){G=Ni()},e}var Js=Xs();const ll={userMessage:{ALLOWED_TAGS:["b","i","em","strong","code","pre","br"],ALLOWED_ATTR:[],KEEP_CONTENT:!0,ALLOW_DATA_ATTR:!1},assistantMessage:{ALLOWED_TAGS:["p","br","b","i","em","strong","code","pre","ul","ol","li","blockquote","h1","h2","h3","h4","h5","h6"],ALLOWED_ATTR:["class"],KEEP_CONTENT:!0,ALLOW_DATA_ATTR:!1},plainText:{ALLOWED_TAGS:[],ALLOWED_ATTR:[],KEEP_CONTENT:!0}};function cl(t,e="userMessage"){if(typeof t!="string")return console.warn("sanitizeInput received non-string input:",typeof t),"";if(!t.trim())return"";try{const n=ll[e],r=Js.sanitize(t,n);return Qs(r)?(console.warn("Suspicious content detected and removed:",t),r.replace(/javascript:/gi,"").replace(/data:/gi,"")):r}catch(n){return console.error("Error sanitizing input:",n),""}}function Qs(t){return[/javascript:/i,/data:.*base64/i,/vbscript:/i,/on\w+\s*=/i,/<script/i,/<iframe/i,/<object/i,/<embed/i,/<link/i,/<style/i].some(n=>n.test(t))}function Kr(t,e=!1){const n="___NEWLINE___",r=t.replace(/\n/g,n);return cl(r,e?"assistantMessage":"userMessage").replace(new RegExp(n,"g"),`
`)}function ul(t){return typeof t!="string"?"":t.replace(/[<>:"/\\|?*]/g,"_").replace(/\.\./g,"_").replace(/^\./,"_").trim().substring(0,255)}function Mi(t){if(typeof t!="string")return!1;try{const e=new URL(t);return!(!["http:","https:","data:"].includes(e.protocol)||Qs(t))}catch{return!1}}function hl(){Js.addHook("beforeSanitizeAttributes",t=>{if(["onclick","onload","onerror","onmouseover","onfocus"].forEach(n=>{t.hasAttribute(n)&&t.removeAttribute(n)}),t.hasAttribute("href")){const n=t.getAttribute("href");n&&!Mi(n)&&t.removeAttribute("href")}if(t.hasAttribute("src")){const n=t.getAttribute("src");n&&!Mi(n)&&t.removeAttribute("src")}})}hl();function dl(){const[t,e]=k.useState([]),n=k.useCallback(()=>Math.random().toString(36).substring(2)+Date.now().toString(36),[]),r=k.useCallback((a,o)=>{const u=Kr(o,a==="assistant");e(l=>[...l,{id:n(),role:a,content:u,timestamp:new Date}])},[n]),i=k.useCallback((a,o)=>{e(c=>c.map(u=>u.id===a?{...u,...o}:u))},[]),s=k.useCallback((a,o,c)=>{e(u=>u.map(l=>l.id===a?{...l,content:o,isStreaming:c}:l))},[]);return{messages:t,setMessages:e,addMessage:r,updateMessage:i,updateMessageContent:s,generateId:n}}const Ai=t=>{let e;const n=new Set,r=(u,l)=>{const d=typeof u=="function"?u(e):u;if(!Object.is(d,e)){const g=e;e=l??(typeof d!="object"||d===null)?d:Object.assign({},e,d),n.forEach(p=>p(e,g))}},i=()=>e,o={setState:r,getState:i,getInitialState:()=>c,subscribe:u=>(n.add(u),()=>n.delete(u))},c=e=t(r,i,o);return o},pl=t=>t?Ai(t):Ai,fl=t=>t;function gl(t,e=fl){const n=k.useSyncExternalStore(t.subscribe,k.useCallback(()=>e(t.getState()),[t,e]),k.useCallback(()=>e(t.getInitialState()),[t,e]));return k.useDebugValue(n),n}const ml=t=>{const e=pl(t),n=r=>gl(e,r);return Object.assign(n,e),n},Cl=t=>ml,Oi={BASE_URL:"/",DEV:!0,MODE:"production",PROD:!1,SSR:!1,VITE_APP_TOLGEE_API_KEY:"tgpak_ge4v6ytcm5xtozdlobzxk4twgyzwqntjoe3xi4bwozygu5q",VITE_APP_TOLGEE_API_URL:"https://tolgee-translation.oddleapp.com",VITE_APP_TOLGEE_PROJECT_ID:"19",VITE_USER_NODE_ENV:"development"},yn=new Map,Ln=t=>{const e=yn.get(t);return e?Object.fromEntries(Object.entries(e.stores).map(([n,r])=>[n,r.getState()])):{}},xl=(t,e,n)=>{if(t===void 0)return{type:"untracked",connection:e.connect(n)};const r=yn.get(n.name);if(r)return{type:"tracked",store:t,...r};const i={connection:e.connect(n),stores:{}};return yn.set(n.name,i),{type:"tracked",store:t,...i}},yl=(t,e)=>{if(e===void 0)return;const n=yn.get(t);n&&(delete n.stores[e],Object.keys(n.stores).length===0&&yn.delete(t))},Sl=t=>{var e,n;if(!t)return;const r=t.split(`
`),i=r.findIndex(a=>a.includes("api.setState"));if(i<0)return;const s=((e=r[i+1])==null?void 0:e.trim())||"";return(n=/.+ (.+) .+/.exec(s))==null?void 0:n[1]},wl=(t,e={})=>(n,r,i)=>{const{enabled:s,anonymousActionType:a,store:o,...c}=e;let u;try{u=(s??(Oi?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!u)return t(n,r,i);const{connection:l,...d}=xl(o,u,c);let g=!0;i.setState=(S,N,E)=>{const v=n(S,N);if(!g)return v;const M=E===void 0?{type:a||Sl(new Error().stack)||"anonymous"}:typeof E=="string"?{type:E}:E;return o===void 0?(l==null||l.send(M,r()),v):(l==null||l.send({...M,type:`${o}/${M.type}`},{...Ln(c.name),[o]:i.getState()}),v)},i.devtools={cleanup:()=>{l&&typeof l.unsubscribe=="function"&&l.unsubscribe(),yl(c.name,o)}};const p=(...S)=>{const N=g;g=!1,n(...S),g=N},x=t(i.setState,r,i);if(d.type==="untracked"?l==null||l.init(x):(d.stores[d.store]=i,l==null||l.init(Object.fromEntries(Object.entries(d.stores).map(([S,N])=>[S,S===d.store?x:N.getState()])))),i.dispatchFromDevtools&&typeof i.dispatch=="function"){let S=!1;const N=i.dispatch;i.dispatch=(...E)=>{(Oi?"production":void 0)!=="production"&&E[0].type==="__setState"&&!S&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),S=!0),N(...E)}}return l.subscribe(S=>{var N;switch(S.type){case"ACTION":if(typeof S.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return ur(S.payload,E=>{if(E.type==="__setState"){if(o===void 0){p(E.state);return}Object.keys(E.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const v=E.state[o];if(v==null)return;JSON.stringify(i.getState())!==JSON.stringify(v)&&p(v);return}i.dispatchFromDevtools&&typeof i.dispatch=="function"&&i.dispatch(E)});case"DISPATCH":switch(S.payload.type){case"RESET":return p(x),o===void 0?l==null?void 0:l.init(i.getState()):l==null?void 0:l.init(Ln(c.name));case"COMMIT":if(o===void 0){l==null||l.init(i.getState());return}return l==null?void 0:l.init(Ln(c.name));case"ROLLBACK":return ur(S.state,E=>{if(o===void 0){p(E),l==null||l.init(i.getState());return}p(E[o]),l==null||l.init(Ln(c.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return ur(S.state,E=>{if(o===void 0){p(E);return}JSON.stringify(i.getState())!==JSON.stringify(E[o])&&p(E[o])});case"IMPORT_STATE":{const{nextLiftedState:E}=S.payload,v=(N=E.computedStates.slice(-1)[0])==null?void 0:N.state;if(!v)return;p(o===void 0?v:v[o]),l==null||l.send(null,E);return}case"PAUSE_RECORDING":return g=!g}return}}),x},kl=wl,ur=(t,e)=>{let n;try{n=JSON.parse(t)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}n!==void 0&&e(n)},Tl=t=>({isModalOpen:!1,isCollapsed:!1,currentMode:"sidebar",setIsModalOpen:e=>t({isModalOpen:e}),setIsCollapsed:e=>t({isCollapsed:e}),setCurrentMode:e=>t({currentMode:e}),openModal:()=>t({isModalOpen:!0}),closeModal:()=>t({isModalOpen:!1}),toggleCollapse:()=>t(e=>({isCollapsed:!e.isCollapsed})),toggleFullscreen:()=>t(e=>({currentMode:e.currentMode==="sidebar"?"fullscreen":"sidebar"}))}),El=t=>({chatStatus:Se.IDLE,streamingStatus:tt.IDLE,setChatStatus:e=>t({chatStatus:e}),setStreamingStatus:e=>t({streamingStatus:e}),resetChatStatus:()=>t({chatStatus:Se.IDLE,streamingStatus:tt.IDLE})}),bl=t=>({isLoadingConversation:!1,conversationError:null,setIsLoadingConversation:e=>t({isLoadingConversation:e}),setConversationError:e=>t({conversationError:e}),clearConversationError:()=>t({conversationError:null})}),_l=t=>({currentThreadId:null,providerResId:null,setCurrentThreadId:e=>t({currentThreadId:e}),setProviderResId:e=>t({providerResId:e}),clearThreadData:()=>t({currentThreadId:null,providerResId:null})}),vl=t=>({isStreaming:!1,isThinking:!1,streamingContent:"",isHandlingTool:!1,currentAssistantMessageId:null,setIsStreaming:e=>t({isStreaming:e}),setIsThinking:e=>t({isThinking:e}),setStreamingContent:e=>t({streamingContent:e}),setIsHandlingTool:e=>t({isHandlingTool:e}),setCurrentAssistantMessageId:e=>t({currentAssistantMessageId:e}),startStreaming:e=>t({isStreaming:!0,isThinking:!0,currentAssistantMessageId:e,streamingContent:"",isHandlingTool:!1}),stopStreaming:()=>t({isStreaming:!1,isThinking:!1}),clearStreamingBuffers:()=>t({streamingContent:"",currentAssistantMessageId:null}),resetToolHandling:()=>t({isHandlingTool:!1})}),le=Cl()(kl((...t)=>({...Tl(...t),...El(...t),...bl(...t),..._l(...t),...vl(...t)}),{name:"ChatUI-Store"})),Rl=()=>le(t=>({isModalOpen:t.isModalOpen,isCollapsed:t.isCollapsed,currentMode:t.currentMode,openModal:t.openModal,closeModal:t.closeModal,toggleCollapse:t.toggleCollapse,toggleFullscreen:t.toggleFullscreen})),Il=()=>le(t=>({chatStatus:t.chatStatus,streamingStatus:t.streamingStatus,setChatStatus:t.setChatStatus,setStreamingStatus:t.setStreamingStatus,resetChatStatus:t.resetChatStatus})),Nl=()=>le(t=>({isLoadingConversation:t.isLoadingConversation,conversationError:t.conversationError,setIsLoadingConversation:t.setIsLoadingConversation,setConversationError:t.setConversationError,clearConversationError:t.clearConversationError})),Ml=()=>le(t=>({currentThreadId:t.currentThreadId,providerResId:t.providerResId,setCurrentThreadId:t.setCurrentThreadId,setProviderResId:t.setProviderResId,clearThreadData:t.clearThreadData}));function Al(){const t=le(v=>v.isStreaming),e=le(v=>v.setIsStreaming),n=le(v=>v.isThinking),r=le(v=>v.setIsThinking),i=le(v=>v.streamingContent),s=le(v=>v.setStreamingContent),a=le(v=>v.isHandlingTool),o=le(v=>v.setIsHandlingTool),c=le(v=>v.startStreaming),u=le(v=>v.stopStreaming),l=le(v=>v.clearStreamingBuffers),d=le(v=>v.resetToolHandling),g=k.useRef(""),p=k.useMemo(()=>({get current(){return le.getState().currentAssistantMessageId},set current(v){le.getState().setCurrentAssistantMessageId(v)}}),[]),x=k.useCallback(v=>{v?c(v):(e(!0),r(!0),s("")),g.current=""},[c,e,r,s]),S=k.useCallback(()=>{u(),g.current=""},[u]),N=k.useCallback(()=>{d()},[d]),E=k.useCallback(()=>{l(),g.current=""},[l]);return{isStreaming:t,setIsStreaming:e,isThinking:n,setIsThinking:r,streamingContent:i,setStreamingContent:s,isHandlingTool:a,setIsHandlingTool:o,currentAssistantMessageIdRef:p,streamingContentRef:g,startStreaming:x,stopStreaming:S,resetToolHandling:N,clearStreamingBuffers:E}}const ce=t=>typeof t=="string",hn=()=>{let t,e;const n=new Promise((r,i)=>{t=r,e=i});return n.resolve=t,n.reject=e,n},Li=t=>t==null?"":""+t,Ol=(t,e,n)=>{t.forEach(r=>{e[r]&&(n[r]=e[r])})},Ll=/###/g,Pi=t=>t&&t.indexOf("###")>-1?t.replace(Ll,"."):t,Di=t=>!t||ce(t),fn=(t,e,n)=>{const r=ce(e)?e.split("."):e;let i=0;for(;i<r.length-1;){if(Di(t))return{};const s=Pi(r[i]);!t[s]&&n&&(t[s]=new n),Object.prototype.hasOwnProperty.call(t,s)?t=t[s]:t={},++i}return Di(t)?{}:{obj:t,k:Pi(r[i])}},ji=(t,e,n)=>{const{obj:r,k:i}=fn(t,e,Object);if(r!==void 0||e.length===1){r[i]=n;return}let s=e[e.length-1],a=e.slice(0,e.length-1),o=fn(t,a,Object);for(;o.obj===void 0&&a.length;)s=`${a[a.length-1]}.${s}`,a=a.slice(0,a.length-1),o=fn(t,a,Object),o!=null&&o.obj&&typeof o.obj[`${o.k}.${s}`]<"u"&&(o.obj=void 0);o.obj[`${o.k}.${s}`]=n},Pl=(t,e,n,r)=>{const{obj:i,k:s}=fn(t,e,Object);i[s]=i[s]||[],i[s].push(n)},Wn=(t,e)=>{const{obj:n,k:r}=fn(t,e);if(n&&Object.prototype.hasOwnProperty.call(n,r))return n[r]},Dl=(t,e,n)=>{const r=Wn(t,n);return r!==void 0?r:Wn(e,n)},ea=(t,e,n)=>{for(const r in e)r!=="__proto__"&&r!=="constructor"&&(r in t?ce(t[r])||t[r]instanceof String||ce(e[r])||e[r]instanceof String?n&&(t[r]=e[r]):ea(t[r],e[r],n):t[r]=e[r]);return t},qt=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var jl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const Fl=t=>ce(t)?t.replace(/[&<>"'\/]/g,e=>jl[e]):t;class Hl{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const r=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,r),this.regExpQueue.push(e),r}}const zl=[" ",",","?","!",";"],Ul=new Hl(20),Bl=(t,e,n)=>{e=e||"",n=n||"";const r=zl.filter(a=>e.indexOf(a)<0&&n.indexOf(a)<0);if(r.length===0)return!0;const i=Ul.getRegExp(`(${r.map(a=>a==="?"?"\\?":a).join("|")})`);let s=!i.test(t);if(!s){const a=t.indexOf(n);a>0&&!i.test(t.substring(0,a))&&(s=!0)}return s},Mr=(t,e,n=".")=>{if(!t)return;if(t[e])return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0;const r=e.split(n);let i=t;for(let s=0;s<r.length;){if(!i||typeof i!="object")return;let a,o="";for(let c=s;c<r.length;++c)if(c!==s&&(o+=n),o+=r[c],a=i[o],a!==void 0){if(["string","number","boolean"].indexOf(typeof a)>-1&&c<r.length-1)continue;s+=c-s+1;break}i=a}return i},Sn=t=>t==null?void 0:t.replace("_","-"),$l={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){var n,r;(r=(n=console==null?void 0:console[t])==null?void 0:n.apply)==null||r.call(n,console,e)}};class Gn{constructor(e,n={}){this.init(e,n)}init(e,n={}){this.prefix=n.prefix||"i18next:",this.logger=e||$l,this.options=n,this.debug=n.debug}log(...e){return this.forward(e,"log","",!0)}warn(...e){return this.forward(e,"warn","",!0)}error(...e){return this.forward(e,"error","")}deprecate(...e){return this.forward(e,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,r,i){return i&&!this.debug?null:(ce(e[0])&&(e[0]=`${r}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new Gn(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new Gn(this.logger,e)}}var kt=new Gn;class Xn{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(r=>{this.observers[r]||(this.observers[r]=new Map);const i=this.observers[r].get(n)||0;this.observers[r].set(n,i+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e,...n){this.observers[e]&&Array.from(this.observers[e].entries()).forEach(([i,s])=>{for(let a=0;a<s;a++)i(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([i,s])=>{for(let a=0;a<s;a++)i.apply(i,[e,...n])})}}class Fi extends Xn{constructor(e,n={ns:["translation"],defaultNS:"translation"}){super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,r,i={}){var u,l;const s=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,a=i.ignoreJSONStructure!==void 0?i.ignoreJSONStructure:this.options.ignoreJSONStructure;let o;e.indexOf(".")>-1?o=e.split("."):(o=[e,n],r&&(Array.isArray(r)?o.push(...r):ce(r)&&s?o.push(...r.split(s)):o.push(r)));const c=Wn(this.data,o);return!c&&!n&&!r&&e.indexOf(".")>-1&&(e=o[0],n=o[1],r=o.slice(2).join(".")),c||!a||!ce(r)?c:Mr((l=(u=this.data)==null?void 0:u[e])==null?void 0:l[n],r,s)}addResource(e,n,r,i,s={silent:!1}){const a=s.keySeparator!==void 0?s.keySeparator:this.options.keySeparator;let o=[e,n];r&&(o=o.concat(a?r.split(a):r)),e.indexOf(".")>-1&&(o=e.split("."),i=n,n=o[1]),this.addNamespaces(n),ji(this.data,o,i),s.silent||this.emit("added",e,n,r,i)}addResources(e,n,r,i={silent:!1}){for(const s in r)(ce(r[s])||Array.isArray(r[s]))&&this.addResource(e,n,s,r[s],{silent:!0});i.silent||this.emit("added",e,n,r)}addResourceBundle(e,n,r,i,s,a={silent:!1,skipCopy:!1}){let o=[e,n];e.indexOf(".")>-1&&(o=e.split("."),i=r,r=n,n=o[1]),this.addNamespaces(n);let c=Wn(this.data,o)||{};a.skipCopy||(r=JSON.parse(JSON.stringify(r))),i?ea(c,r,s):c={...c,...r},ji(this.data,o,c),a.silent||this.emit("added",e,n,r)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(i=>n[i]&&Object.keys(n[i]).length>0)}toJSON(){return this.data}}var ta={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,r,i){return t.forEach(s=>{var a;e=((a=this.processors[s])==null?void 0:a.process(e,n,r,i))??e}),e}};const na=Symbol("i18next/PATH_KEY");function Vl(){const t=[],e=Object.create(null);let n;return e.get=(r,i)=>{var s;return(s=n==null?void 0:n.revoke)==null||s.call(n),i===na?t:(t.push(i),n=Proxy.revocable(r,e),n.proxy)},Proxy.revocable(Object.create(null),e).proxy}function Ar(t,e){const{[na]:n}=t(Vl());return n.join((e==null?void 0:e.keySeparator)??".")}const Hi={},hr=t=>!ce(t)&&typeof t!="boolean"&&typeof t!="number";class qn extends Xn{constructor(e,n={}){super(),Ol(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=kt.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e,n={interpolation:{}}){const r={...n};if(e==null)return!1;const i=this.resolve(e,r);if((i==null?void 0:i.res)===void 0)return!1;const s=hr(i.res);return!(r.returnObjects===!1&&s)}extractFromKey(e,n){let r=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;r===void 0&&(r=":");const i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let s=n.ns||this.options.defaultNS||[];const a=r&&e.indexOf(r)>-1,o=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!Bl(e,r,i);if(a&&!o){const c=e.match(this.interpolator.nestingRegexp);if(c&&c.length>0)return{key:e,namespaces:ce(s)?[s]:s};const u=e.split(r);(r!==i||r===i&&this.options.ns.indexOf(u[0])>-1)&&(s=u.shift()),e=u.join(i)}return{key:e,namespaces:ce(s)?[s]:s}}translate(e,n,r){let i=typeof n=="object"?{...n}:n;if(typeof i!="object"&&this.options.overloadTranslationOptionHandler&&(i=this.options.overloadTranslationOptionHandler(arguments)),typeof i=="object"&&(i={...i}),i||(i={}),e==null)return"";typeof e=="function"&&(e=Ar(e,{...this.options,...i})),Array.isArray(e)||(e=[String(e)]);const s=i.returnDetails!==void 0?i.returnDetails:this.options.returnDetails,a=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator,{key:o,namespaces:c}=this.extractFromKey(e[e.length-1],i),u=c[c.length-1];let l=i.nsSeparator!==void 0?i.nsSeparator:this.options.nsSeparator;l===void 0&&(l=":");const d=i.lng||this.language,g=i.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((d==null?void 0:d.toLowerCase())==="cimode")return g?s?{res:`${u}${l}${o}`,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:u,usedParams:this.getUsedParamsDetails(i)}:`${u}${l}${o}`:s?{res:o,usedKey:o,exactUsedKey:o,usedLng:d,usedNS:u,usedParams:this.getUsedParamsDetails(i)}:o;const p=this.resolve(e,i);let x=p==null?void 0:p.res;const S=(p==null?void 0:p.usedKey)||o,N=(p==null?void 0:p.exactUsedKey)||o,E=["[object Number]","[object Function]","[object RegExp]"],v=i.joinArrays!==void 0?i.joinArrays:this.options.joinArrays,M=!this.i18nFormat||this.i18nFormat.handleAsObject,O=i.count!==void 0&&!ce(i.count),P=qn.hasDefaultValue(i),b=O?this.pluralResolver.getSuffix(d,i.count,i):"",z=i.ordinal&&O?this.pluralResolver.getSuffix(d,i.count,{ordinal:!1}):"",U=O&&!i.ordinal&&i.count===0,W=U&&i[`defaultValue${this.options.pluralSeparator}zero`]||i[`defaultValue${b}`]||i[`defaultValue${z}`]||i.defaultValue;let Y=x;M&&!x&&P&&(Y=W);const G=hr(Y),H=Object.prototype.toString.apply(Y);if(M&&Y&&G&&E.indexOf(H)<0&&!(ce(v)&&Array.isArray(Y))){if(!i.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const _=this.options.returnedObjectHandler?this.options.returnedObjectHandler(S,Y,{...i,ns:c}):`key '${o} (${this.language})' returned an object instead of string.`;return s?(p.res=_,p.usedParams=this.getUsedParamsDetails(i),p):_}if(a){const _=Array.isArray(Y),L=_?[]:{},F=_?N:S;for(const ee in Y)if(Object.prototype.hasOwnProperty.call(Y,ee)){const se=`${F}${a}${ee}`;P&&!x?L[ee]=this.translate(se,{...i,defaultValue:hr(W)?W[ee]:void 0,joinArrays:!1,ns:c}):L[ee]=this.translate(se,{...i,joinArrays:!1,ns:c}),L[ee]===se&&(L[ee]=Y[ee])}x=L}}else if(M&&ce(v)&&Array.isArray(x))x=x.join(v),x&&(x=this.extendTranslation(x,e,i,r));else{let _=!1,L=!1;!this.isValidLookup(x)&&P&&(_=!0,x=W),this.isValidLookup(x)||(L=!0,x=o);const ee=(i.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&L?void 0:x,se=P&&W!==x&&this.options.updateMissing;if(L||_||se){if(this.logger.log(se?"updateKey":"missingKey",d,u,o,se?W:x),a){const Q=this.resolve(o,{...i,keySeparator:!1});Q&&Q.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let pe=[];const ge=this.languageUtils.getFallbackCodes(this.options.fallbackLng,i.lng||this.language);if(this.options.saveMissingTo==="fallback"&&ge&&ge[0])for(let Q=0;Q<ge.length;Q++)pe.push(ge[Q]);else this.options.saveMissingTo==="all"?pe=this.languageUtils.toResolveHierarchy(i.lng||this.language):pe.push(i.lng||this.language);const y=(Q,B,C)=>{var K;const ie=P&&C!==x?C:ee;this.options.missingKeyHandler?this.options.missingKeyHandler(Q,u,B,ie,se,i):(K=this.backendConnector)!=null&&K.saveMissing&&this.backendConnector.saveMissing(Q,u,B,ie,se,i),this.emit("missingKey",Q,u,B,x)};this.options.saveMissing&&(this.options.saveMissingPlurals&&O?pe.forEach(Q=>{const B=this.pluralResolver.getSuffixes(Q,i);U&&i[`defaultValue${this.options.pluralSeparator}zero`]&&B.indexOf(`${this.options.pluralSeparator}zero`)<0&&B.push(`${this.options.pluralSeparator}zero`),B.forEach(C=>{y([Q],o+C,i[`defaultValue${C}`]||W)})}):y(pe,o,W))}x=this.extendTranslation(x,e,i,p,r),L&&x===o&&this.options.appendNamespaceToMissingKey&&(x=`${u}${l}${o}`),(L||_)&&this.options.parseMissingKeyHandler&&(x=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${u}${l}${o}`:o,_?x:void 0,i))}return s?(p.res=x,p.usedParams=this.getUsedParamsDetails(i),p):x}extendTranslation(e,n,r,i,s){var c,u;if((c=this.i18nFormat)!=null&&c.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...r},r.lng||this.language||i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init({...r,interpolation:{...this.options.interpolation,...r.interpolation}});const l=ce(e)&&(((u=r==null?void 0:r.interpolation)==null?void 0:u.skipOnVariables)!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let d;if(l){const p=e.match(this.interpolator.nestingRegexp);d=p&&p.length}let g=r.replace&&!ce(r.replace)?r.replace:r;if(this.options.interpolation.defaultVariables&&(g={...this.options.interpolation.defaultVariables,...g}),e=this.interpolator.interpolate(e,g,r.lng||this.language||i.usedLng,r),l){const p=e.match(this.interpolator.nestingRegexp),x=p&&p.length;d<x&&(r.nest=!1)}!r.lng&&i&&i.res&&(r.lng=this.language||i.usedLng),r.nest!==!1&&(e=this.interpolator.nest(e,(...p)=>(s==null?void 0:s[0])===p[0]&&!r.context?(this.logger.warn(`It seems you are nesting recursively key: ${p[0]} in key: ${n[0]}`),null):this.translate(...p,n),r)),r.interpolation&&this.interpolator.reset()}const a=r.postProcess||this.options.postProcess,o=ce(a)?[a]:a;return e!=null&&(o!=null&&o.length)&&r.applyPostProcessor!==!1&&(e=ta.handle(o,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...i,usedParams:this.getUsedParamsDetails(r)},...r}:r,this)),e}resolve(e,n={}){let r,i,s,a,o;return ce(e)&&(e=[e]),e.forEach(c=>{if(this.isValidLookup(r))return;const u=this.extractFromKey(c,n),l=u.key;i=l;let d=u.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const g=n.count!==void 0&&!ce(n.count),p=g&&!n.ordinal&&n.count===0,x=n.context!==void 0&&(ce(n.context)||typeof n.context=="number")&&n.context!=="",S=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);d.forEach(N=>{var E,v;this.isValidLookup(r)||(o=N,!Hi[`${S[0]}-${N}`]&&((E=this.utils)!=null&&E.hasLoadedNamespace)&&!((v=this.utils)!=null&&v.hasLoadedNamespace(o))&&(Hi[`${S[0]}-${N}`]=!0,this.logger.warn(`key "${i}" for languages "${S.join(", ")}" won't get resolved as namespace "${o}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),S.forEach(M=>{var b;if(this.isValidLookup(r))return;a=M;const O=[l];if((b=this.i18nFormat)!=null&&b.addLookupKeys)this.i18nFormat.addLookupKeys(O,l,M,N,n);else{let z;g&&(z=this.pluralResolver.getSuffix(M,n.count,n));const U=`${this.options.pluralSeparator}zero`,W=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(g&&(n.ordinal&&z.indexOf(W)===0&&O.push(l+z.replace(W,this.options.pluralSeparator)),O.push(l+z),p&&O.push(l+U)),x){const Y=`${l}${this.options.contextSeparator||"_"}${n.context}`;O.push(Y),g&&(n.ordinal&&z.indexOf(W)===0&&O.push(Y+z.replace(W,this.options.pluralSeparator)),O.push(Y+z),p&&O.push(Y+U))}}let P;for(;P=O.pop();)this.isValidLookup(r)||(s=P,r=this.getResource(M,N,P,n))}))})}),{res:r,usedKey:i,exactUsedKey:s,usedLng:a,usedNS:o}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,r,i={}){var s;return(s=this.i18nFormat)!=null&&s.getResource?this.i18nFormat.getResource(e,n,r,i):this.resourceStore.getResource(e,n,r,i)}getUsedParamsDetails(e={}){const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],r=e.replace&&!ce(e.replace);let i=r?e.replace:e;if(r&&typeof e.count<"u"&&(i.count=e.count),this.options.interpolation.defaultVariables&&(i={...this.options.interpolation.defaultVariables,...i}),!r){i={...i};for(const s of n)delete i[s]}return i}static hasDefaultValue(e){const n="defaultValue";for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&n===r.substring(0,n.length)&&e[r]!==void 0)return!0;return!1}}class zi{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=kt.create("languageUtils")}getScriptPartFromCode(e){if(e=Sn(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=Sn(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(ce(e)&&e.indexOf("-")>-1){let n;try{n=Intl.getCanonicalLocales(e)[0]}catch{}return n&&this.options.lowerCaseLng&&(n=n.toLowerCase()),n||(this.options.lowerCaseLng?e.toLowerCase():e)}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(r=>{if(n)return;const i=this.formatLanguageCode(r);(!this.options.supportedLngs||this.isSupportedCode(i))&&(n=i)}),!n&&this.options.supportedLngs&&e.forEach(r=>{if(n)return;const i=this.getScriptPartFromCode(r);if(this.isSupportedCode(i))return n=i;const s=this.getLanguagePartFromCode(r);if(this.isSupportedCode(s))return n=s;n=this.options.supportedLngs.find(a=>{if(a===s)return a;if(!(a.indexOf("-")<0&&s.indexOf("-")<0)&&(a.indexOf("-")>0&&s.indexOf("-")<0&&a.substring(0,a.indexOf("-"))===s||a.indexOf(s)===0&&s.length>1))return a})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),ce(e)&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let r=e[n];return r||(r=e[this.getScriptPartFromCode(n)]),r||(r=e[this.formatLanguageCode(n)]),r||(r=e[this.getLanguagePartFromCode(n)]),r||(r=e.default),r||[]}toResolveHierarchy(e,n){const r=this.getFallbackCodes((n===!1?[]:n)||this.options.fallbackLng||[],e),i=[],s=a=>{a&&(this.isSupportedCode(a)?i.push(a):this.logger.warn(`rejecting language code not found in supportedLngs: ${a}`))};return ce(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&s(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&s(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&s(this.getLanguagePartFromCode(e))):ce(e)&&s(this.formatLanguageCode(e)),r.forEach(a=>{i.indexOf(a)<0&&s(this.formatLanguageCode(a))}),i}}const Ui={zero:0,one:1,two:2,few:3,many:4,other:5},Bi={select:t=>t===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class Wl{constructor(e,n={}){this.languageUtils=e,this.options=n,this.logger=kt.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(e,n={}){const r=Sn(e==="dev"?"en":e),i=n.ordinal?"ordinal":"cardinal",s=JSON.stringify({cleanedCode:r,type:i});if(s in this.pluralRulesCache)return this.pluralRulesCache[s];let a;try{a=new Intl.PluralRules(r,{type:i})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),Bi;if(!e.match(/-|_/))return Bi;const c=this.languageUtils.getLanguagePartFromCode(e);a=this.getRule(c,n)}return this.pluralRulesCache[s]=a,a}needsPlural(e,n={}){let r=this.getRule(e,n);return r||(r=this.getRule("dev",n)),(r==null?void 0:r.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(e,n,r={}){return this.getSuffixes(e,r).map(i=>`${n}${i}`)}getSuffixes(e,n={}){let r=this.getRule(e,n);return r||(r=this.getRule("dev",n)),r?r.resolvedOptions().pluralCategories.sort((i,s)=>Ui[i]-Ui[s]).map(i=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${i}`):[]}getSuffix(e,n,r={}){const i=this.getRule(e,r);return i?`${this.options.prepend}${r.ordinal?`ordinal${this.options.prepend}`:""}${i.select(n)}`:(this.logger.warn(`no plural rule found for: ${e}`),this.getSuffix("dev",n,r))}}const $i=(t,e,n,r=".",i=!0)=>{let s=Dl(t,e,n);return!s&&i&&ce(n)&&(s=Mr(t,n,r),s===void 0&&(s=Mr(e,n,r))),s},dr=t=>t.replace(/\$/g,"$$$$");class Vi{constructor(e={}){var n;this.logger=kt.create("interpolator"),this.options=e,this.format=((n=e==null?void 0:e.interpolation)==null?void 0:n.format)||(r=>r),this.init(e)}init(e={}){e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:r,useRawValueToEscape:i,prefix:s,prefixEscaped:a,suffix:o,suffixEscaped:c,formatSeparator:u,unescapeSuffix:l,unescapePrefix:d,nestingPrefix:g,nestingPrefixEscaped:p,nestingSuffix:x,nestingSuffixEscaped:S,nestingOptionsSeparator:N,maxReplaces:E,alwaysFormat:v}=e.interpolation;this.escape=n!==void 0?n:Fl,this.escapeValue=r!==void 0?r:!0,this.useRawValueToEscape=i!==void 0?i:!1,this.prefix=s?qt(s):a||"{{",this.suffix=o?qt(o):c||"}}",this.formatSeparator=u||",",this.unescapePrefix=l?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":l||"",this.nestingPrefix=g?qt(g):p||qt("$t("),this.nestingSuffix=x?qt(x):S||qt(")"),this.nestingOptionsSeparator=N||",",this.maxReplaces=E||1e3,this.alwaysFormat=v!==void 0?v:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,r)=>(n==null?void 0:n.source)===r?(n.lastIndex=0,n):new RegExp(r,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(e,n,r,i){var p;let s,a,o;const c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},u=x=>{if(x.indexOf(this.formatSeparator)<0){const v=$i(n,c,x,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(v,void 0,r,{...i,...n,interpolationkey:x}):v}const S=x.split(this.formatSeparator),N=S.shift().trim(),E=S.join(this.formatSeparator).trim();return this.format($i(n,c,N,this.options.keySeparator,this.options.ignoreJSONStructure),E,r,{...i,...n,interpolationkey:N})};this.resetRegExp();const l=(i==null?void 0:i.missingInterpolationHandler)||this.options.missingInterpolationHandler,d=((p=i==null?void 0:i.interpolation)==null?void 0:p.skipOnVariables)!==void 0?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:x=>dr(x)},{regex:this.regexp,safeValue:x=>this.escapeValue?dr(this.escape(x)):dr(x)}].forEach(x=>{for(o=0;s=x.regex.exec(e);){const S=s[1].trim();if(a=u(S),a===void 0)if(typeof l=="function"){const E=l(e,s,i);a=ce(E)?E:""}else if(i&&Object.prototype.hasOwnProperty.call(i,S))a="";else if(d){a=s[0];continue}else this.logger.warn(`missed to pass in variable ${S} for interpolating ${e}`),a="";else!ce(a)&&!this.useRawValueToEscape&&(a=Li(a));const N=x.safeValue(a);if(e=e.replace(s[0],N),d?(x.regex.lastIndex+=a.length,x.regex.lastIndex-=s[0].length):x.regex.lastIndex=0,o++,o>=this.maxReplaces)break}}),e}nest(e,n,r={}){let i,s,a;const o=(c,u)=>{const l=this.nestingOptionsSeparator;if(c.indexOf(l)<0)return c;const d=c.split(new RegExp(`${l}[ ]*{`));let g=`{${d[1]}`;c=d[0],g=this.interpolate(g,a);const p=g.match(/'/g),x=g.match(/"/g);(((p==null?void 0:p.length)??0)%2===0&&!x||x.length%2!==0)&&(g=g.replace(/'/g,'"'));try{a=JSON.parse(g),u&&(a={...u,...a})}catch(S){return this.logger.warn(`failed parsing options string in nesting for key ${c}`,S),`${c}${l}${g}`}return a.defaultValue&&a.defaultValue.indexOf(this.prefix)>-1&&delete a.defaultValue,c};for(;i=this.nestingRegexp.exec(e);){let c=[];a={...r},a=a.replace&&!ce(a.replace)?a.replace:a,a.applyPostProcessor=!1,delete a.defaultValue;const u=/{.*}/.test(i[1])?i[1].lastIndexOf("}")+1:i[1].indexOf(this.formatSeparator);if(u!==-1&&(c=i[1].slice(u).split(this.formatSeparator).map(l=>l.trim()).filter(Boolean),i[1]=i[1].slice(0,u)),s=n(o.call(this,i[1].trim(),a),a),s&&i[0]===e&&!ce(s))return s;ce(s)||(s=Li(s)),s||(this.logger.warn(`missed to resolve ${i[1]} for nesting ${e}`),s=""),c.length&&(s=c.reduce((l,d)=>this.format(l,d,r.lng,{...r,interpolationkey:i[1].trim()}),s.trim())),e=e.replace(i[0],s),this.regexp.lastIndex=0}return e}}const Gl=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const r=t.split("(");e=r[0].toLowerCase().trim();const i=r[1].substring(0,r[1].length-1);e==="currency"&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):e==="relativetime"&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach(a=>{if(a){const[o,...c]=a.split(":"),u=c.join(":").trim().replace(/^'+|'+$/g,""),l=o.trim();n[l]||(n[l]=u),u==="false"&&(n[l]=!1),u==="true"&&(n[l]=!0),isNaN(u)||(n[l]=parseInt(u,10))}})}return{formatName:e,formatOptions:n}},Wi=t=>{const e={};return(n,r,i)=>{let s=i;i&&i.interpolationkey&&i.formatParams&&i.formatParams[i.interpolationkey]&&i[i.interpolationkey]&&(s={...s,[i.interpolationkey]:void 0});const a=r+JSON.stringify(s);let o=e[a];return o||(o=t(Sn(r),i),e[a]=o),o(n)}},ql=t=>(e,n,r)=>t(Sn(n),r)(e);class Kl{constructor(e={}){this.logger=kt.create("formatter"),this.options=e,this.init(e)}init(e,n={interpolation:{}}){this.formatSeparator=n.interpolation.formatSeparator||",";const r=n.cacheInBuiltFormats?Wi:ql;this.formats={number:r((i,s)=>{const a=new Intl.NumberFormat(i,{...s});return o=>a.format(o)}),currency:r((i,s)=>{const a=new Intl.NumberFormat(i,{...s,style:"currency"});return o=>a.format(o)}),datetime:r((i,s)=>{const a=new Intl.DateTimeFormat(i,{...s});return o=>a.format(o)}),relativetime:r((i,s)=>{const a=new Intl.RelativeTimeFormat(i,{...s});return o=>a.format(o,s.range||"day")}),list:r((i,s)=>{const a=new Intl.ListFormat(i,{...s});return o=>a.format(o)})}}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=Wi(n)}format(e,n,r,i={}){const s=n.split(this.formatSeparator);if(s.length>1&&s[0].indexOf("(")>1&&s[0].indexOf(")")<0&&s.find(o=>o.indexOf(")")>-1)){const o=s.findIndex(c=>c.indexOf(")")>-1);s[0]=[s[0],...s.splice(1,o)].join(this.formatSeparator)}return s.reduce((o,c)=>{var d;const{formatName:u,formatOptions:l}=Gl(c);if(this.formats[u]){let g=o;try{const p=((d=i==null?void 0:i.formatParams)==null?void 0:d[i.interpolationkey])||{},x=p.locale||p.lng||i.locale||i.lng||r;g=this.formats[u](o,x,{...l,...i,...p})}catch(p){this.logger.warn(p)}return g}else this.logger.warn(`there was no format function for ${u}`);return o},e)}}const Zl=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class Yl extends Xn{constructor(e,n,r,i={}){var s,a;super(),this.backend=e,this.store=n,this.services=r,this.languageUtils=r.languageUtils,this.options=i,this.logger=kt.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=i.maxParallelReads||10,this.readingCalls=0,this.maxRetries=i.maxRetries>=0?i.maxRetries:5,this.retryTimeout=i.retryTimeout>=1?i.retryTimeout:350,this.state={},this.queue=[],(a=(s=this.backend)==null?void 0:s.init)==null||a.call(s,r,i.backend,i)}queueLoad(e,n,r,i){const s={},a={},o={},c={};return e.forEach(u=>{let l=!0;n.forEach(d=>{const g=`${u}|${d}`;!r.reload&&this.store.hasResourceBundle(u,d)?this.state[g]=2:this.state[g]<0||(this.state[g]===1?a[g]===void 0&&(a[g]=!0):(this.state[g]=1,l=!1,a[g]===void 0&&(a[g]=!0),s[g]===void 0&&(s[g]=!0),c[d]===void 0&&(c[d]=!0)))}),l||(o[u]=!0)}),(Object.keys(s).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(s),pending:Object.keys(a),toLoadLanguages:Object.keys(o),toLoadNamespaces:Object.keys(c)}}loaded(e,n,r){const i=e.split("|"),s=i[0],a=i[1];n&&this.emit("failedLoading",s,a,n),!n&&r&&this.store.addResourceBundle(s,a,r,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&r&&(this.state[e]=0);const o={};this.queue.forEach(c=>{Pl(c.loaded,[s],a),Zl(c,e),n&&c.errors.push(n),c.pendingCount===0&&!c.done&&(Object.keys(c.loaded).forEach(u=>{o[u]||(o[u]={});const l=c.loaded[u];l.length&&l.forEach(d=>{o[u][d]===void 0&&(o[u][d]=!0)})}),c.done=!0,c.errors.length?c.callback(c.errors):c.callback())}),this.emit("loaded",o),this.queue=this.queue.filter(c=>!c.done)}read(e,n,r,i=0,s=this.retryTimeout,a){if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:r,tried:i,wait:s,callback:a});return}this.readingCalls++;const o=(u,l)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(u&&l&&i<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,r,i+1,s*2,a)},s);return}a(u,l)},c=this.backend[r].bind(this.backend);if(c.length===2){try{const u=c(e,n);u&&typeof u.then=="function"?u.then(l=>o(null,l)).catch(o):o(null,u)}catch(u){o(u)}return}return c(e,n,o)}prepareLoading(e,n,r={},i){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();ce(e)&&(e=this.languageUtils.toResolveHierarchy(e)),ce(n)&&(n=[n]);const s=this.queueLoad(e,n,r,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach(a=>{this.loadOne(a)})}load(e,n,r){this.prepareLoading(e,n,{},r)}reload(e,n,r){this.prepareLoading(e,n,{reload:!0},r)}loadOne(e,n=""){const r=e.split("|"),i=r[0],s=r[1];this.read(i,s,"read",void 0,void 0,(a,o)=>{a&&this.logger.warn(`${n}loading namespace ${s} for language ${i} failed`,a),!a&&o&&this.logger.log(`${n}loaded namespace ${s} for language ${i}`,o),this.loaded(e,a,o)})}saveMissing(e,n,r,i,s,a={},o=()=>{}){var c,u,l,d,g;if((u=(c=this.services)==null?void 0:c.utils)!=null&&u.hasLoadedNamespace&&!((d=(l=this.services)==null?void 0:l.utils)!=null&&d.hasLoadedNamespace(n))){this.logger.warn(`did not save key "${r}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(r==null||r==="")){if((g=this.backend)!=null&&g.create){const p={...a,isUpdate:s},x=this.backend.create.bind(this.backend);if(x.length<6)try{let S;x.length===5?S=x(e,n,r,i,p):S=x(e,n,r,i),S&&typeof S.then=="function"?S.then(N=>o(null,N)).catch(o):o(null,S)}catch(S){o(S)}else x(e,n,r,i,o,p)}!e||!e[0]||this.store.addResource(e[0],n,r,i)}}}const pr=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),ce(t[1])&&(e.defaultValue=t[1]),ce(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(r=>{e[r]=n[r]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Gi=t=>{var e,n;return ce(t.ns)&&(t.ns=[t.ns]),ce(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),ce(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),((n=(e=t.supportedLngs)==null?void 0:e.indexOf)==null?void 0:n.call(e,"cimode"))<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),typeof t.initImmediate=="boolean"&&(t.initAsync=t.initImmediate),t},Pn=()=>{},Xl=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class gn extends Xn{constructor(e={},n){if(super(),this.options=Gi(e),this.services={},this.logger=kt,this.modules={external:[]},Xl(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initAsync)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(e={},n){this.isInitializing=!0,typeof e=="function"&&(n=e,e={}),e.defaultNS==null&&e.ns&&(ce(e.ns)?e.defaultNS=e.ns:e.ns.indexOf("translation")<0&&(e.defaultNS=e.ns[0]));const r=pr();this.options={...r,...this.options,...Gi(e)},this.options.interpolation={...r.interpolation,...this.options.interpolation},e.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=e.keySeparator),e.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=e.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=r.overloadTranslationOptionHandler);const i=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?kt.init(i(this.modules.logger),this.options):kt.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:u=Kl;const l=new zi(this.options);this.store=new Fi(this.options.resources,this.options);const d=this.services;d.logger=kt,d.resourceStore=this.store,d.languageUtils=l,d.pluralResolver=new Wl(l,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==r.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),u&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(d.formatter=i(u),d.formatter.init&&d.formatter.init(d,this.options),this.options.interpolation.format=d.formatter.format.bind(d.formatter)),d.interpolator=new Vi(this.options),d.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},d.backendConnector=new Yl(i(this.modules.backend),d.resourceStore,d,this.options),d.backendConnector.on("*",(p,...x)=>{this.emit(p,...x)}),this.modules.languageDetector&&(d.languageDetector=i(this.modules.languageDetector),d.languageDetector.init&&d.languageDetector.init(d,this.options.detection,this.options)),this.modules.i18nFormat&&(d.i18nFormat=i(this.modules.i18nFormat),d.i18nFormat.init&&d.i18nFormat.init(this)),this.translator=new qn(this.services,this.options),this.translator.on("*",(p,...x)=>{this.emit(p,...x)}),this.modules.external.forEach(p=>{p.init&&p.init(this)})}if(this.format=this.options.interpolation.format,n||(n=Pn),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=(...l)=>this.store[u](...l)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=(...l)=>(this.store[u](...l),this)});const o=hn(),c=()=>{const u=(l,d)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),o.resolve(d),n(l,d)};if(this.languages&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initAsync?c():setTimeout(c,0),o}loadResources(e,n=Pn){var s,a;let r=n;const i=ce(e)?e:this.language;if(typeof e=="function"&&(r=e),!this.options.resources||this.options.partialBundledLanguages){if((i==null?void 0:i.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return r();const o=[],c=u=>{if(!u||u==="cimode")return;this.services.languageUtils.toResolveHierarchy(u).forEach(d=>{d!=="cimode"&&o.indexOf(d)<0&&o.push(d)})};i?c(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>c(l)),(a=(s=this.options.preload)==null?void 0:s.forEach)==null||a.call(s,u=>c(u)),this.services.backendConnector.load(o,this.options.ns,u=>{!u&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),r(u)})}else r(null)}reloadResources(e,n,r){const i=hn();return typeof e=="function"&&(r=e,e=void 0),typeof n=="function"&&(r=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),r||(r=Pn),this.services.backendConnector.reload(e,n,s=>{i.resolve(),r(s)}),i}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&ta.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1)){for(let n=0;n<this.languages.length;n++){const r=this.languages[n];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}!this.resolvedLanguage&&this.languages.indexOf(e)<0&&this.store.hasLanguageSomeTranslations(e)&&(this.resolvedLanguage=e,this.languages.unshift(e))}}changeLanguage(e,n){this.isLanguageChangingTo=e;const r=hn();this.emit("languageChanging",e);const i=o=>{this.language=o,this.languages=this.services.languageUtils.toResolveHierarchy(o),this.resolvedLanguage=void 0,this.setResolvedLanguage(o)},s=(o,c)=>{c?this.isLanguageChangingTo===e&&(i(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,r.resolve((...u)=>this.t(...u)),n&&n(o,(...u)=>this.t(...u))},a=o=>{var l,d;!e&&!o&&this.services.languageDetector&&(o=[]);const c=ce(o)?o:o&&o[0],u=this.store.hasLanguageSomeTranslations(c)?c:this.services.languageUtils.getBestMatchFromCodes(ce(o)?[o]:o);u&&(this.language||i(u),this.translator.language||this.translator.changeLanguage(u),(d=(l=this.services.languageDetector)==null?void 0:l.cacheUserLanguage)==null||d.call(l,u)),this.loadResources(u,g=>{s(g,u)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),r}getFixedT(e,n,r){const i=(s,a,...o)=>{let c;typeof a!="object"?c=this.options.overloadTranslationOptionHandler([s,a].concat(o)):c={...a},c.lng=c.lng||i.lng,c.lngs=c.lngs||i.lngs,c.ns=c.ns||i.ns,c.keyPrefix!==""&&(c.keyPrefix=c.keyPrefix||r||i.keyPrefix);const u=this.options.keySeparator||".";let l;return c.keyPrefix&&Array.isArray(s)?l=s.map(d=>(typeof d=="function"&&(d=Ar(d,{...this.options,...a})),`${c.keyPrefix}${u}${d}`)):(typeof s=="function"&&(s=Ar(s,{...this.options,...a})),l=c.keyPrefix?`${c.keyPrefix}${u}${s}`:s),this.t(l,c)};return ce(e)?i.lng=e:i.lngs=e,i.ns=n,i.keyPrefix=r,i}t(...e){var n;return(n=this.translator)==null?void 0:n.translate(...e)}exists(...e){var n;return(n=this.translator)==null?void 0:n.exists(...e)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e,n={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const r=n.lng||this.resolvedLanguage||this.languages[0],i=this.options?this.options.fallbackLng:!1,s=this.languages[this.languages.length-1];if(r.toLowerCase()==="cimode")return!0;const a=(o,c)=>{const u=this.services.backendConnector.state[`${o}|${c}`];return u===-1||u===0||u===2};if(n.precheck){const o=n.precheck(this,a);if(o!==void 0)return o}return!!(this.hasResourceBundle(r,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||a(r,e)&&(!i||a(s,e)))}loadNamespaces(e,n){const r=hn();return this.options.ns?(ce(e)&&(e=[e]),e.forEach(i=>{this.options.ns.indexOf(i)<0&&this.options.ns.push(i)}),this.loadResources(i=>{r.resolve(),n&&n(i)}),r):(n&&n(),Promise.resolve())}loadLanguages(e,n){const r=hn();ce(e)&&(e=[e]);const i=this.options.preload||[],s=e.filter(a=>i.indexOf(a)<0&&this.services.languageUtils.isSupportedCode(a));return s.length?(this.options.preload=i.concat(s),this.loadResources(a=>{r.resolve(),n&&n(a)}),r):(n&&n(),Promise.resolve())}dir(e){var i,s;if(e||(e=this.resolvedLanguage||(((i=this.languages)==null?void 0:i.length)>0?this.languages[0]:this.language)),!e)return"rtl";try{const a=new Intl.Locale(e);if(a&&a.getTextInfo){const o=a.getTextInfo();if(o&&o.direction)return o.direction}}catch{}const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],r=((s=this.services)==null?void 0:s.languageUtils)||new zi(pr());return e.toLowerCase().indexOf("-latn")>1?"ltr":n.indexOf(r.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(e={},n){const r=new gn(e,n);return r.createInstance=gn.createInstance,r}cloneInstance(e={},n=Pn){const r=e.forkResourceStore;r&&delete e.forkResourceStore;const i={...this.options,...e,isClone:!0},s=new gn(i);if((e.debug!==void 0||e.prefix!==void 0)&&(s.logger=s.logger.clone(e)),["store","services","language"].forEach(o=>{s[o]=this[o]}),s.services={...this.services},s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},r){const o=Object.keys(this.store.data).reduce((c,u)=>(c[u]={...this.store.data[u]},c[u]=Object.keys(c[u]).reduce((l,d)=>(l[d]={...c[u][d]},l),c[u]),c),{});s.store=new Fi(o,i),s.services.resourceStore=s.store}if(e.interpolation){const c={...pr().interpolation,...this.options.interpolation,...e.interpolation},u={...i,interpolation:c};s.services.interpolator=new Vi(u)}return s.translator=new qn(s.services,i),s.translator.on("*",(o,...c)=>{s.emit(o,...c)}),s.init(i,n),s.translator.options=i,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Xe=gn.createInstance();Xe.createInstance;Xe.dir;Xe.init;Xe.loadResources;Xe.reloadResources;Xe.use;Xe.changeLanguage;Xe.getFixedT;Xe.t;Xe.exists;Xe.setDefaultNamespace;Xe.hasLoadedNamespace;Xe.loadNamespaces;Xe.loadLanguages;var Kn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}const Jl=(t,e,n,r)=>{var s,a,o,c;const i=[n,{code:e,...r||{}}];if((a=(s=t==null?void 0:t.services)==null?void 0:s.logger)!=null&&a.forward)return t.services.logger.forward(i,"warn","react-i18next::",!0);Bt(i[0])&&(i[0]=`react-i18next:: ${i[0]}`),(c=(o=t==null?void 0:t.services)==null?void 0:o.logger)!=null&&c.warn?t.services.logger.warn(...i):console!=null&&console.warn&&console.warn(...i)},qi={},ra=(t,e,n,r)=>{Bt(n)&&qi[n]||(Bt(n)&&(qi[n]=new Date),Jl(t,e,n,r))},ia=(t,e)=>()=>{if(t.isInitialized)e();else{const n=()=>{setTimeout(()=>{t.off("initialized",n)},0),e()};t.on("initialized",n)}},Or=(t,e,n)=>{t.loadNamespaces(e,ia(t,n))},Ki=(t,e,n,r)=>{if(Bt(n)&&(n=[n]),t.options.preload&&t.options.preload.indexOf(e)>-1)return Or(t,n,r);n.forEach(i=>{t.options.ns.indexOf(i)<0&&t.options.ns.push(i)}),t.loadLanguages(e,ia(t,r))},Ql=(t,e,n={})=>!e.languages||!e.languages.length?(ra(e,"NO_LANGUAGES","i18n.languages were undefined or empty",{languages:e.languages}),!0):e.hasLoadedNamespace(t,{lng:n.lng,precheck:(r,i)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!i(r.isLanguageChangingTo,t))return!1}}),Bt=t=>typeof t=="string",ec=t=>typeof t=="object"&&t!==null,tc=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,nc={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"Â©","&#169;":"Â©","&reg;":"Â®","&#174;":"Â®","&hellip;":"â€¦","&#8230;":"â€¦","&#x2F;":"/","&#47;":"/"},rc=t=>nc[t],ic=t=>t.replace(tc,rc);let Lr={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:ic,transDefaultProps:void 0};const sc=(t={})=>{Lr={...Lr,...t}},ac=()=>Lr;let sa;const oc=t=>{sa=t},lc=()=>sa,cc={type:"3rdParty",init(t){sc(t.options.react),oc(t)}},uc=k.createContext();class hc{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}var aa={exports:{}},oa={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qt=k;function dc(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var pc=typeof Object.is=="function"?Object.is:dc,fc=Qt.useState,gc=Qt.useEffect,mc=Qt.useLayoutEffect,Cc=Qt.useDebugValue;function xc(t,e){var n=e(),r=fc({inst:{value:n,getSnapshot:e}}),i=r[0].inst,s=r[1];return mc(function(){i.value=n,i.getSnapshot=e,fr(i)&&s({inst:i})},[t,n,e]),gc(function(){return fr(i)&&s({inst:i}),t(function(){fr(i)&&s({inst:i})})},[t]),Cc(n),n}function fr(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!pc(t,n)}catch{return!0}}function yc(t,e){return e()}var Sc=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?yc:xc;oa.useSyncExternalStore=Qt.useSyncExternalStore!==void 0?Qt.useSyncExternalStore:Sc;aa.exports=oa;var wc=aa.exports;const kc=(t,e)=>Bt(e)?e:ec(e)&&Bt(e.defaultValue)?e.defaultValue:Array.isArray(t)?t[t.length-1]:t,Tc={t:kc,ready:!1},Ec=()=>()=>{},bc=(t,e={})=>{var W,Y,G;const{i18n:n}=e,{i18n:r,defaultNS:i}=k.useContext(uc)||{},s=n||r||lc();s&&!s.reportNamespaces&&(s.reportNamespaces=new hc),s||ra(s,"NO_I18NEXT_INSTANCE","useTranslation: You will need to pass in an i18next instance by using initReactI18next");const a=k.useMemo(()=>{var H;return{...ac(),...(H=s==null?void 0:s.options)==null?void 0:H.react,...e}},[s,e]),{useSuspense:o,keyPrefix:c}=a,u=i||((W=s==null?void 0:s.options)==null?void 0:W.defaultNS),l=Bt(u)?[u]:u||["translation"],d=k.useMemo(()=>l,l);(G=(Y=s==null?void 0:s.reportNamespaces)==null?void 0:Y.addUsedNamespaces)==null||G.call(Y,d);const g=k.useRef(0),p=k.useCallback(H=>{if(!s)return Ec;const{bindI18n:_,bindI18nStore:L}=a,F=()=>{g.current+=1,H()};return _&&s.on(_,F),L&&s.store.on(L,F),()=>{_&&_.split(" ").forEach(ee=>s.off(ee,F)),L&&L.split(" ").forEach(ee=>s.store.off(ee,F))}},[s,a]),x=k.useRef(),S=k.useCallback(()=>{if(!s)return Tc;const H=!!(s.isInitialized||s.initializedStoreOnce)&&d.every(pe=>Ql(pe,s,a)),_=e.lng||s.language,L=g.current,F=x.current;if(F&&F.ready===H&&F.lng===_&&F.keyPrefix===c&&F.revision===L)return F;const se={t:s.getFixedT(_,a.nsMode==="fallback"?d:d[0],c),ready:H,lng:_,keyPrefix:c,revision:L};return x.current=se,se},[s,d,c,a,e.lng]),[N,E]=k.useState(0),{t:v,ready:M}=wc.useSyncExternalStore(p,S,S);k.useEffect(()=>{if(s&&!M&&!o){const H=()=>E(_=>_+1);e.lng?Ki(s,e.lng,d,H):Or(s,d,H)}},[s,e.lng,d,M,o,N]);const O=s||{},P=k.useRef(null),b=k.useRef(),z=H=>{const _=Object.getOwnPropertyDescriptors(H);_.__original&&delete _.__original;const L=Object.create(Object.getPrototypeOf(H),_);if(!Object.prototype.hasOwnProperty.call(L,"__original"))try{Object.defineProperty(L,"__original",{value:H,writable:!1,enumerable:!1,configurable:!1})}catch{}return L},U=k.useMemo(()=>{const H=O,_=H==null?void 0:H.language;let L=H;H&&(P.current&&P.current.__original===H?b.current!==_?(L=z(H),P.current=L,b.current=_):L=P.current:(L=z(H),P.current=L,b.current=_));const F=[v,L,M];return F.t=v,F.i18n=L,F.ready=M,F},[v,O,M,O.resolvedLanguage,O.language,O.languages]);if(s&&o&&!M)throw new Promise(H=>{const _=()=>H();e.lng?Ki(s,e.lng,d,_):Or(s,d,_)});return U};async function Yr({chatServerUrl:t,chatServerKey:e,mpAuthToken:n,locale:r}){const s=`${t.replace(/\/$/,"").replace(/^ws(s)?:/,"http$1:")}/api/v1/translations/${r}`,a=await fetch(s,{method:"GET",headers:{"x-oddle-chat-server-key":e,"x-oddle-mp-auth-token":n,"Content-Type":"application/json"}});if(!a.ok){if(a.status===404&&r!=="en")return console.warn(`Translations not found for locale '${r}', falling back to 'en'`),Yr({chatServerUrl:t,chatServerKey:e,mpAuthToken:n,locale:"en"});throw new Error(`Failed to fetch translations: ${a.status} ${a.statusText}`)}const o=await a.json();if(!o.success||!o.translations)throw new Error("Invalid translation response: missing translations data");return o.translations}const _c=()=>{const t=Xe.createInstance();return t.use(cc),t},la=k.createContext(null),vc={chat:{connection:{reconnecting:"Reconnecting..."},errors:{authentication:"Authentication error. Please refresh the page and try again.",connection:"Connection error. Please check your internet connection and try again.",retry:"Retry",timeout:"Request timed out. Please try again.",unexpected:"An unexpected error occurred. Please try again."},fileUpload:{maxFilesExceeded:"Maximum {{maxFiles}} files allowed",sizeLimitExceeded:"File size must be less than {{maxSize}}MB",typeNotAllowed:"Only image files are allowed"},input:{placeholder:"What would you like to know?"},tools:{completed:"Completed",executing:"Executing...",failed:"Failed"},reasoning:{thinking:"Thinking...",thought:"Thought",completed:"Completed",error:"Error",processing:"Processing",duration:{for:"for",second:"second",seconds:"seconds"}}}};function ca({children:t,locale:e="en",chatServerUrl:n,chatServerKey:r,mpAuthToken:i,fallback:s}){const[a]=k.useState(()=>_c()),[o,c]=k.useState(!0),[u,l]=k.useState(!1),[d,g]=k.useState(null),p=k.useRef(!1),x=k.useCallback(async(E,v)=>{a.isInitialized?(a.addResourceBundle(v,"translation",E,!0,!0),await a.changeLanguage(v)):await a.init({lng:v,fallbackLng:"en",resources:{[v]:{translation:E}},interpolation:{escapeValue:!1},react:{useSuspense:!1}})},[a]);k.useEffect(()=>{if(p.current)return;let E=!0;return(async()=>{c(!0),g(null);try{const M=await Yr({chatServerUrl:n,chatServerKey:r,mpAuthToken:i,locale:e});if(!E)return;await x(M,e),p.current=!0,l(!0)}catch(M){if(!E)return;console.error("Failed to load translations:",M),g(M instanceof Error?M:new Error("Failed to load translations")),await x(vc,"en"),p.current=!0,l(!0)}finally{E&&c(!1)}})(),()=>{E=!1}},[e,n,r,i,x]);const S=k.useCallback((E,v)=>a.isInitialized&&a.t(E,v)||E,[a]),N=k.useMemo(()=>({t:S,locale:e,isLoading:o,isReady:u,error:d}),[S,e,o,u,d]);return o&&s?h.jsx(h.Fragment,{children:s}):h.jsx(la.Provider,{value:N,children:t})}function Mt(){const t=k.useContext(la);if(!t)throw new Error("useTranslations must be used within TranslationProvider. Make sure your component is wrapped with <TranslationProvider>.");return t}function Rc(){return bc()}function Ic(){const{t}=Mt(),e=k.useCallback((s,a)=>a===!1?Pe.isErrorMessage(s)?Ue.ERROR:Ue.COMPLETED:Pe.isCompletedMessage(s)?Ue.COMPLETED:Pe.isErrorMessage(s)?Ue.ERROR:Ue.PROCESSING,[]),n=k.useCallback(s=>Pe.extractDuration(s,t),[t]),r=k.useCallback(s=>Pe.cleanReasoningContent(s),[]),i=k.useCallback((s,a)=>{switch(Pe.getMessageType(s,a)){case ae.MESSAGE_TYPES.ERROR:return t("chat.reasoning.error");case ae.MESSAGE_TYPES.COMPLETED:return t("chat.reasoning.completed");case ae.MESSAGE_TYPES.THOUGHT:return t("chat.reasoning.thought");case ae.MESSAGE_TYPES.THINKING:default:return t("chat.reasoning.thinking")}},[t]);return{getReasoningStatus:e,getReasoningDuration:n,getReasoningContentOnly:r,getReasoningTitle:i}}function Nc(){const{t}=Mt(),e=k.useCallback((r,i)=>i===!1?r.includes(ae.ERROR_MARKER)?t("chat.tools.failed"):t("chat.tools.completed"):r.includes(ae.COMPLETED_MARKER)||r.includes("âœ…")?t("chat.tools.completed"):r.includes(ae.ERROR_MARKER)?t("chat.tools.failed"):(r.includes(ae.HANDLING_MARKER),t("chat.tools.executing")),[t]),n=k.useCallback((r,i)=>i===!1?r.includes(ae.ERROR_MARKER)?Ue.ERROR:Ue.COMPLETED:r.includes(ae.COMPLETED_MARKER)||r.includes("âœ…")?Ue.COMPLETED:r.includes(ae.ERROR_MARKER)?Ue.ERROR:Ue.PROCESSING,[]);return{getToolingTitle:e,getToolingStatus:n}}function Mc({setMessages:t,addMessage:e,updateMessageContent:n,generateId:r,setIsThinking:i,setIsStreaming:s,setStreamingContent:a,setIsHandlingTool:o,currentAssistantMessageIdRef:c,streamingContentRef:u,clearStreamingBuffers:l,resetToolHandling:d}){const g=k.useRef(new Map),p=k.useRef(new Map),x=k.useCallback(()=>{if(c.current&&u.current){const O=Kr(u.current,!0);return n(c.current,O,!1),l(),!0}return!1},[c,u,n,l]),S=k.useCallback(O=>{if(window.responseTimeoutId&&(clearTimeout(window.responseTimeoutId),window.responseTimeoutId=null,c.current||t(P=>{var z;const b=(z=P.map((U,W)=>({msg:U,index:W})).filter(({msg:U})=>U.role==="user").pop())==null?void 0:z.index;return b!==void 0?P.map((U,W)=>W===b&&(U.hasError||U.isRetrying)?{...U,hasError:!1,errorMessage:void 0,isRetrying:!1}:U):P})),c.current)u.current+=O,a(u.current),n(c.current,u.current,!0);else{i(!1);const P=r();c.current=P,u.current=O,a(O);const b={id:P,role:"assistant",content:O,timestamp:new Date,isStreaming:!0};t(z=>[...z,b])}},[c,u,a,n,i,r,t]),N=k.useCallback((O,P,b)=>{const{callId:z}=b||{};if(o(O),!z)return;const U=Pe.isThinkingMessage(P)&&!ae.PATTERNS.DURATION.test(P),W=Pe.isThinkingMessage(P)&&ae.PATTERNS.DURATION.test(P),Y=Pe.isHandlingMessage(P),G=Pe.isCompletedMessage(P),H=Pe.isErrorMessage(P);if(U||W){const L=g.current.get(z);if(U&&!L){x();const F=r();g.current.set(z,F);const ee={id:F,role:"reasoning",content:P,timestamp:new Date,isStreaming:!0};t(se=>[...se,ee])}else W&&L?(n(L,P,!1),g.current.delete(z)):L&&U&&n(L,P,!0)}const _=p.current.get(z);if(Y&&!_){x();const L=P.match(ae.PATTERNS.HANDLING_TOOL),F=L?L[1]:"Unknown Tool",ee=r();p.current.set(z,ee);const se={id:ee,role:"tooling",content:P,timestamp:new Date,isStreaming:!0,toolData:{...b,toolName:F,callId:z,status:Ue.PROCESSING}};t(pe=>[...pe,se])}else if((G||H)&&_){const L=P.match(ae.PATTERNS.COMPLETED_OR_ERROR_TOOL),F=L?L[1]:"Unknown Tool";t(ee=>ee.map(se=>se.id===_?{...se,content:P,isStreaming:!1,toolData:{...se.toolData,toolName:F,status:H?Ue.ERROR:Ue.COMPLETED,callId:z??""}}:se)),p.current.delete(z)}else _&&O&&!G&&!H&&n(_,P,!0)},[o,x,r,t,n]),E=k.useCallback(()=>{s(!1),i(!1),x()},[s,i,x]),v=k.useCallback(O=>{s(!1),i(!1),x(),e("system",`âŒ Chat error: ${O}`)},[s,i,x,e]),M=k.useCallback(()=>{s(!1),i(!1),l(),d()},[s,i,l,d]);return{handleSetMessage:S,handleReasoningUpdate:N,handleChatFinished:E,handleChatError:v,stopGeneration:M,finalizeCurrentStreamingMessage:x}}function Ac(){const t=dl(),e=Al(),n=Ic(),r=Nc(),i=Mc({setMessages:t.setMessages,addMessage:t.addMessage,updateMessageContent:t.updateMessageContent,generateId:t.generateId,setIsThinking:e.setIsThinking,setIsStreaming:e.setIsStreaming,setStreamingContent:e.setStreamingContent,setIsHandlingTool:e.setIsHandlingTool,currentAssistantMessageIdRef:e.currentAssistantMessageIdRef,streamingContentRef:e.streamingContentRef,clearStreamingBuffers:e.clearStreamingBuffers,resetToolHandling:e.resetToolHandling});return{messages:t.messages,setMessages:t.setMessages,isStreaming:e.isStreaming,setIsStreaming:e.setIsStreaming,isThinking:e.isThinking,setIsThinking:e.setIsThinking,streamingContent:e.streamingContent,isHandlingTool:e.isHandlingTool,currentAssistantMessageIdRef:e.currentAssistantMessageIdRef,getReasoningStatus:n.getReasoningStatus,getReasoningDuration:n.getReasoningDuration,getReasoningContentOnly:n.getReasoningContentOnly,getReasoningTitle:n.getReasoningTitle,getToolingTitle:r.getToolingTitle,getToolingStatus:r.getToolingStatus,addMessage:t.addMessage,handleSetMessage:i.handleSetMessage,handleReasoningUpdate:i.handleReasoningUpdate,handleChatFinished:i.handleChatFinished,handleChatError:i.handleChatError,stopGeneration:i.stopGeneration,finalizeCurrentStreamingMessage:i.finalizeCurrentStreamingMessage}}function Oc({initialMode:t="sidebar"}){const e=le();return k.useEffect(()=>{t&&e.currentMode!==t&&e.setCurrentMode(t)},[t]),k.useEffect(()=>{if(typeof window>"u"||typeof document>"u")return;const n=r=>{r.key==="Escape"&&e.currentMode==="modal"&&e.isModalOpen&&e.closeModal()};if(e.currentMode==="modal"&&e.isModalOpen)return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[e.currentMode,e.isModalOpen,e.closeModal]),{isModalOpen:e.isModalOpen,setIsModalOpen:e.setIsModalOpen,isCollapsed:e.isCollapsed,setIsCollapsed:e.setIsCollapsed,currentMode:e.currentMode,setCurrentMode:e.setCurrentMode,chatStatus:e.chatStatus,setChatStatus:e.setChatStatus,streamingStatus:e.streamingStatus,setStreamingStatus:e.setStreamingStatus,isLoadingConversation:e.isLoadingConversation,setIsLoadingConversation:e.setIsLoadingConversation,conversationError:e.conversationError,setConversationError:e.setConversationError,currentThreadId:e.currentThreadId,setCurrentThreadId:e.setCurrentThreadId,providerResId:e.providerResId,setProviderResId:e.setProviderResId,openModal:e.openModal,closeModal:e.closeModal,toggleCollapse:e.toggleCollapse,toggleFullscreen:e.toggleFullscreen}}function Lc({entityId:t,entityType:e,httpApiUrl:n,userMpAuthToken:r,chatServerKey:i,messages:s,setMessages:a,setIsLoadingConversation:o,setConversationError:c,setCurrentThreadId:u,setProviderResId:l,metadata:d,isConnected:g=!0,onConversationInitialized:p}){const x=k.useRef(!1),S=async()=>{if(g){if(!t){o(!1);return}if(!d||typeof d=="object"&&Object.keys(d).length===0){o(!1);return}if(!n){o(!1);return}if(!r){o(!1);return}if(!i){o(!1);return}if(!x.current&&!(s.length>0))try{o(!0),c(null);const E=await Ws(n,{entityId:t,entityType:e,metadata:d},{userMpAuthToken:r,chatServerKey:i});a(E.messages),E.threadId&&u(E.threadId),E.providerResId&&l(E.providerResId),E.messages.length>0&&p&&p(),x.current=!0}catch(E){Jt(E,"ConversationLoader"),c(E instanceof Error?E.message:"Failed to load conversation"),x.current=!0}finally{o(!1)}}};return k.useEffect(()=>{S()},[g,t,e,n,r,i,s.length,a,o,c,u,l,d]),{hasLoadedConversationRef:x,resetConversationLoader:()=>{x.current=!1},reloadConversation:S}}function Pc(t){if(!t||typeof t!="object")return!1;const e=Object.keys(t);return e.length===0?!1:e.some(n=>t[n]!=null)}function Dc({metadata:t,chatClient:e,currentProviderResId:n,isLoadingConversation:r,messages:i=[],entityId:s,entityType:a}){const o=k.useRef(void 0),c=k.useRef(!1),u=k.useRef(null),l=k.useRef(void 0);return k.useEffect(()=>{if(r||!e)return;const d=!n&&i.length===0,g=!!n;if(d&&(!s||!a)||g&&!n)return;if(!c.current){c.current=!0,o.current=t;return}if(!(o.current!==t))return;if(!Pc(t)){o.current=t;return}if(d)o.current=t;else if(g){if(l.current===t)return;if(u.current){u.current.finally(()=>{if(l.current!==t){const N=e.updateMetadata(n,{metadata:t}).then(()=>{o.current=t,l.current=t,u.current=null}).catch(E=>{console.error("[useMetadataSync] âŒ Failed to update existing thread metadata:",E),u.current=null});u.current=N}});return}const S=e.updateMetadata(n,{metadata:t}).then(()=>{o.current=t,l.current=t,u.current=null}).catch(N=>{console.error("[useMetadataSync] âŒ Failed to update existing thread metadata:",N),u.current=null});u.current=S}},[t,n,e,r,i.length,s,a]),{lastMetadata:o.current,hasInitialized:c.current,isDraftState:!n&&i.length===0,isExistingThread:!!n}}function jc(){const[t,e]=k.useState(navigator.onLine),[n,r]=k.useState(!1);return k.useEffect(()=>{const i=()=>{e(!0),n&&r(!1)},s=()=>{e(!1),r(!0)};return window.addEventListener("online",i),window.addEventListener("offline",s),()=>{window.removeEventListener("online",i),window.removeEventListener("offline",s)}},[n]),{isOnline:t,wasOffline:n}}class Fc{constructor(e){q(this,"config");q(this,"defaultFolder","chat-uploads");q(this,"defaultMaxFileSize",15*1024*1024);this.config={folder:this.defaultFolder,maxFileSize:this.defaultMaxFileSize,...e}}async uploadFiles(e,n){return e.forEach(r=>this.validateFile(r)),e.length===1?[await this.uploadSingleFile(e[0],n?r=>{const i=[{file:e[0],progress:r,status:r===100?"completed":"uploading"}];n(i)}:void 0)]:this.uploadMultipleFiles(e,n)}async uploadMultipleFiles(e,n){const r=new FormData;e.forEach(a=>{r.append("files",a)}),r.append("folder",this.config.folder||this.defaultFolder);const i=this.buildAuthHeaders(),s=e.map(a=>({file:a,progress:0,status:"uploading"}));return new Promise((a,o)=>{const c=new XMLHttpRequest;c.upload.addEventListener("progress",u=>{if(u.lengthComputable&&n){const l=u.loaded/u.total*100;s.forEach(d=>{d.progress=l}),n([...s])}}),c.addEventListener("load",async()=>{if(c.status>=200&&c.status<300)try{const u=JSON.parse(c.responseText);let l;u.data&&Array.isArray(u.data)?l=u.data.map((d,g)=>this.processUploadResult(e[g],d)):Array.isArray(u)?l=u.map((d,g)=>this.processUploadResult(e[g],d)):l=[this.processUploadResult(e[0],u)],s.forEach(d=>{d.status="completed",d.progress=100}),n&&n([...s]),a(l)}catch{s.forEach(l=>{l.status="error"}),n&&n([...s]),o(new Error("Invalid response format"))}else s.forEach(u=>{u.status="error"}),n&&n([...s]),o(new Error(`Upload failed with status ${c.status}`))}),c.addEventListener("error",()=>{s.forEach(u=>{u.status="error"}),n&&n([...s]),o(new Error("Network error during upload"))}),c.open("POST",`${this.config.apiUrl}/api/v1/upload`),Object.entries(i).forEach(([u,l])=>{c.setRequestHeader(u,l)}),c.send(r)})}async uploadSingleFile(e,n){const r=new FormData;r.append("file",e),r.append("folder",this.config.folder||this.defaultFolder);const i=this.buildAuthHeaders();return new Promise((s,a)=>{const o=new XMLHttpRequest;o.upload.addEventListener("progress",c=>{if(c.lengthComputable&&n){const u=c.loaded/c.total*100;n(u)}}),o.addEventListener("load",async()=>{if(o.status>=200&&o.status<300)try{const c=JSON.parse(o.responseText),u=this.processUploadResult(e,c);s(u)}catch{a(new Error("Invalid response format"))}else a(new Error(`Upload failed with status ${o.status}`))}),o.addEventListener("error",()=>{a(new Error("Network error during upload"))}),o.open("POST",`${this.config.apiUrl}/api/v1/upload`),Object.entries(i).forEach(([c,u])=>{o.setRequestHeader(c,u)}),o.send(r)})}processUploadResult(e,n){return n.cdnUrl||n.url}validateFile(e){if(e.size>(this.config.maxFileSize||this.defaultMaxFileSize))throw new Error(`File ${e.name} is too large. Maximum size is ${this.formatFileSize(this.config.maxFileSize||this.defaultMaxFileSize)}`);if(this.config.allowedTypes&&this.config.allowedTypes.length>0&&!this.config.allowedTypes.some(r=>e.type.startsWith(r)||e.name.toLowerCase().endsWith(r)))throw new Error(`File type ${e.type} is not allowed`)}buildAuthHeaders(){const e={};return this.config.userMpAuthToken&&(e["x-oddle-mp-auth-token"]=this.config.userMpAuthToken),this.config.chatServerKey&&(e["x-oddle-chat-server-key"]=this.config.chatServerKey),e}formatFileSize(e){if(e===0)return"0 Bytes";const n=1024,r=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,i)).toFixed(2))+" "+r[i]}updateConfig(e){this.config={...this.config,...e}}getConfig(){return{...this.config}}}class Hc{constructor(e,n={}){q(this,"config");q(this,"chatClient");this.chatClient=e,this.config=n}canSubmit(e,n,r){return!!(e.trim()&&!n&&this.chatClient&&r)}createUserMessage(e,n){return{id:this.generateId(),role:"user",content:e.trim(),timestamp:new Date,media:n,hasError:!1,isRetrying:!1,isStreaming:!1}}async submitMessage(e){const{message:n,media:r,providerResId:i}=e,s=this.createUserMessage(n,r);try{return await this.chatClient.onTriggerMessage({message:s.content,media:r,providerResId:i}),s}catch(a){throw this.handleError(a),a}}handleError(e){const n=e instanceof Error?e:new Error("Unknown error");console.error("Agent client send error:",n),this.config.onError&&this.config.onError(n)}generateId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}createErrorMessage(e){return`Sorry, there was an error: ${e instanceof Error?e.message:"Unknown error"}`}}const zc={shouldShowBubble:(t,e,n)=>t==="modal"&&!e||(t==="sidebar"||t==="fullscreen")&&n,isCollapsedState:(t,e)=>(t==="sidebar"||t==="fullscreen")&&e,getBubbleTitle:(t,e)=>t==="modal"?`Open ${e}`:`Expand ${e}`,shouldShowHeader:t=>t!==!1,shouldShowMainHeader:(t,e,n)=>t===0&&!e&&!n,getContentAreaClass:(t,e,n)=>`chat-wrapper__content ${t===0&&!e&&!n?"chat-wrapper__content--empty":"chat-wrapper__content--with-messages"}`,shouldShowSuggestedPrompts:(t,e,n,r)=>t===0&&!e&&!n&&!!r},ua={convertWebSocketToHttp:t=>t.replace(/^wss?:\/\//,e=>e==="wss://"?"https://":"http://"),isValidWebSocketUrl:t=>{try{const e=new URL(t);return e.protocol==="ws:"||e.protocol==="wss:"}catch{return!1}},isValidHttpUrl:t=>{try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}}},Uc={validateAuthProps:t=>{if(!t.userMpAuthToken)throw new Error("ChatWrapper: userMpAuthToken is required");if(!t.chatServerUrl)throw new Error("ChatWrapper: chatServerUrl is required");if(!t.chatServerKey)throw new Error("ChatWrapper: chatServerKey is required")},validateWebSocketUrl:t=>{if(!ua.isValidWebSocketUrl(t))throw new Error(`Invalid WebSocket URL: ${t}. Must start with ws:// or wss://`)},validateMessageContent:t=>t.trim().length>0},ha={buildClasses:(...t)=>t.filter(Boolean).join(" "),getContainerClasses:(t,e,n,r,i)=>ha.buildClasses("chat-wrapper",`chat-wrapper--${t}`,e&&`chat-wrapper--${e}`,n&&`chat-wrapper--${n}`,r&&"chat-wrapper--collapsed",t==="embedded"&&i&&"chat-wrapper--constrained")},da={createChatError:(t,e,n)=>{const r=new Error(t);return r.code=e,r.originalError=n,r},isNetworkError:t=>t.message.includes("fetch")||t.message.includes("network")||t.message.includes("connection"),getUserFriendlyErrorMessage:t=>da.isNetworkError(t)?"Connection error. Please check your internet connection and try again.":t.message.includes("authentication")||t.message.includes("auth")?"Authentication error. Please refresh the page and try again.":t.message.includes("timeout")?"Request timed out. Please try again.":"An unexpected error occurred. Please try again."},St={state:zc,url:ua,validation:Uc,css:ha,error:da};class Zi extends k.Component{constructor(n){super(n);q(this,"resetTimeoutId",null);q(this,"resetErrorBoundary",()=>{this.resetTimeoutId&&clearTimeout(this.resetTimeoutId),this.setState({hasError:!1,error:void 0,errorInfo:void 0})});q(this,"handleRetry",()=>{this.resetTimeoutId=window.setTimeout(()=>{this.resetErrorBoundary()},100)});this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,r){this.setState({error:n,errorInfo:r}),this.props.onError&&this.props.onError(n,r)}componentDidUpdate(n){const{resetOnPropsChange:r,resetKeys:i}=this.props,{hasError:s}=this.state;if(s&&r&&i){const a=n.resetKeys||[];i.some((c,u)=>c!==a[u])&&this.resetErrorBoundary()}}render(){const{hasError:n,error:r}=this.state,{children:i,fallback:s}=this.props;return n&&r?s?s(r,this.handleRetry):h.jsx("div",{className:"chat-wrapper__error-boundary",children:h.jsxs("div",{className:"chat-wrapper__error-content",children:[h.jsx("div",{className:"chat-wrapper__error-icon",children:"âš ï¸"}),h.jsx("h3",{className:"chat-wrapper__error-title",children:"Something went wrong"}),h.jsx("p",{className:"chat-wrapper__error-message",children:St.error.getUserFriendlyErrorMessage(r)}),h.jsx("div",{className:"chat-wrapper__error-actions",children:h.jsx("button",{className:"chat-wrapper__error-retry",onClick:this.handleRetry,type:"button",children:"Try Again"})}),(()=>{try{return!0}catch{return!1}})()&&h.jsxs("details",{className:"chat-wrapper__error-details",children:[h.jsx("summary",{children:"Error Details (Development)"}),h.jsx("pre",{className:"chat-wrapper__error-stack",children:r.stack})]})]})}):i}}class Bc extends k.Component{constructor(n){super(n);q(this,"retryCount",0);q(this,"retryTimeoutId",null);q(this,"handleRetry",()=>{const{maxRetries:n=3,retryDelay:r=1e3,onRetry:i}=this.props;this.retryCount>=n||(this.setState({isRetrying:!0}),this.retryCount++,this.retryTimeoutId=window.setTimeout(()=>{this.setState({hasError:!1,error:void 0,isRetrying:!1}),i&&i()},r*this.retryCount))});q(this,"handleManualReset",()=>{this.retryCount=0,this.setState({hasError:!1,error:void 0,isRetrying:!1}),this.props.onRetry&&this.props.onRetry()});this.state={hasError:!1,isRetrying:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n){this.props.onError&&this.props.onError(n)}componentWillUnmount(){this.retryTimeoutId&&clearTimeout(this.retryTimeoutId)}render(){const{hasError:n,error:r,isRetrying:i}=this.state,{children:s,maxRetries:a=3}=this.props;return n&&r&&(r.message.includes("WebSocket")||r.message.includes("connection")||St.error.isNetworkError(r))?h.jsx("div",{className:"chat-wrapper__websocket-error",children:h.jsxs("div",{className:"chat-wrapper__error-content",children:[h.jsx("div",{className:"chat-wrapper__error-icon",children:"ðŸ”Œ"}),h.jsx("h3",{className:"chat-wrapper__error-title",children:"Connection Error"}),h.jsx("p",{className:"chat-wrapper__error-message",children:"Unable to establish connection to the chat server."}),h.jsx("div",{className:"chat-wrapper__error-actions",children:i?h.jsxs("div",{className:"chat-wrapper__error-retrying",children:[h.jsx("span",{children:"Reconnecting..."}),h.jsx("div",{className:"chat-wrapper__spinner"})]}):h.jsxs(h.Fragment,{children:[this.retryCount<a&&h.jsxs("button",{className:"chat-wrapper__error-retry",onClick:this.handleRetry,type:"button",children:["Retry Connection (",a-this.retryCount," attempts left)"]}),h.jsx("button",{className:"chat-wrapper__error-reset",onClick:this.handleManualReset,type:"button",children:"Reset Connection"})]})}),(()=>{try{return!0}catch{return!1}})()&&h.jsxs("details",{className:"chat-wrapper__error-details",children:[h.jsx("summary",{children:"Error Details (Development)"}),h.jsx("pre",{className:"chat-wrapper__error-stack",children:r.stack})]})]})}):s}}class $c extends k.Component{constructor(n){super(n);q(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,failedFiles:void 0}),this.props.onRetry&&this.props.onRetry()});q(this,"handleDismiss",()=>{this.setState({hasError:!1,error:void 0,failedFiles:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n){const r=this.extractFailedFiles(n);this.setState({failedFiles:r}),this.props.onError&&this.props.onError(n,r)}extractFailedFiles(n){const r=/file[s]?\s*['":]?\s*([^,\n]+)/gi,i=n.message.match(r);return i?i.map(s=>s.replace(/file[s]?\s*['":]?\s*/i,"").trim()):[]}render(){const{hasError:n,error:r,failedFiles:i}=this.state,{children:s,allowRetry:a=!0}=this.props;return n&&r&&(r.message.includes("upload")||r.message.includes("file")||r.message.includes("attachment"))?h.jsx("div",{className:"chat-wrapper__file-upload-error",children:h.jsxs("div",{className:"chat-wrapper__error-content",children:[h.jsx("div",{className:"chat-wrapper__error-icon",children:"ðŸ“"}),h.jsx("h3",{className:"chat-wrapper__error-title",children:"File Upload Error"}),h.jsx("p",{className:"chat-wrapper__error-message",children:this.getFileUploadErrorMessage(r)}),i&&i.length>0&&h.jsxs("div",{className:"chat-wrapper__failed-files",children:[h.jsx("p",{className:"chat-wrapper__failed-files-title",children:"Failed files:"}),h.jsx("ul",{className:"chat-wrapper__failed-files-list",children:i.map((c,u)=>h.jsx("li",{className:"chat-wrapper__failed-file",children:c},u))})]}),h.jsxs("div",{className:"chat-wrapper__error-actions",children:[a&&h.jsx("button",{className:"chat-wrapper__error-retry",onClick:this.handleRetry,type:"button",children:"Try Again"}),h.jsx("button",{className:"chat-wrapper__error-dismiss",onClick:this.handleDismiss,type:"button",children:"Continue Without Files"})]}),(()=>{try{return!0}catch{return!1}})()&&h.jsxs("details",{className:"chat-wrapper__error-details",children:[h.jsx("summary",{children:"Error Details (Development)"}),h.jsx("pre",{className:"chat-wrapper__error-stack",children:r.stack})]})]})}):s}getFileUploadErrorMessage(n){return n.message.includes("size")||n.message.includes("large")?"File size is too large. Please try with smaller files.":n.message.includes("type")||n.message.includes("format")?"File type is not supported. Please try with different file types.":n.message.includes("network")||n.message.includes("connection")?"Network error during upload. Please check your connection and try again.":n.message.includes("timeout")?"Upload timed out. Please try again with smaller files or better connection.":"Failed to upload files. Please try again."}}const pa=({className:t,onClick:e,size:n=24,color:r="currentColor"})=>h.jsxs("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,onClick:e,style:{cursor:e?"pointer":"default"},children:[h.jsx("path",{d:"M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H5.17L4 17.17V4H20V16Z",fill:r}),h.jsx("circle",{cx:"7",cy:"10",r:"1",fill:r}),h.jsx("circle",{cx:"12",cy:"10",r:"1",fill:r}),h.jsx("circle",{cx:"17",cy:"10",r:"1",fill:r})]}),fa=({className:t,onClick:e,size:n=20,color:r="currentColor"})=>h.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,onClick:e,style:{cursor:e?"pointer":"default"},children:h.jsx("path",{d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z",fill:r})}),ga=({className:t,onClick:e,size:n=20,color:r="currentColor",isFullscreen:i=!1})=>h.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,onClick:e,style:{cursor:e?"pointer":"default"},children:i?h.jsx("path",{d:"M8 3v3a2 2 0 01-2 2H3M21 8h-3a2 2 0 01-2-2V3M3 16h3a2 2 0 012 2v3M16 21v-3a2 2 0 012-2h3",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}):h.jsx("path",{d:"M7 14H5v5h5v-2M5 10V5h5v2M17 14h2v5h-5v-2M19 10V5h-5v2",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),ma=({className:t,onClick:e,size:n=20,color:r="currentColor"})=>h.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,onClick:e,style:{cursor:e?"pointer":"default"},children:h.jsx("path",{d:"M18 12l-3 3-3-3m-6 3l-3 3-3-3",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),Vc=({className:t,onClick:e,size:n=16,color:r="currentColor"})=>h.jsx("svg",{width:n,height:n,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,onClick:e,style:{cursor:e?"pointer":"default"},children:h.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 00.12-.61l-1.92-3.32a.488.488 0 00-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 00-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 00-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z",fill:r})}),Ca=({className:t,onClick:e,size:n=18,color:r="currentColor"})=>h.jsxs("svg",{width:n,height:n,viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,onClick:e,style:{cursor:e?"pointer":"default"},children:[h.jsx("mask",{id:"mask0_444_23118",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"18",height:"18",children:h.jsx("rect",{width:"18",height:"18",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_444_23118)",children:h.jsx("path",{d:"M5.8498 13.4998C5.47855 13.4998 5.16074 13.3676 4.89637 13.1032C4.63199 12.8389 4.4998 12.5211 4.4998 12.1498V3.1498C4.4998 2.77855 4.63199 2.46074 4.89637 2.19637C5.16074 1.93199 5.47855 1.7998 5.8498 1.7998H14.8498C15.2211 1.7998 15.5389 1.93199 15.8032 2.19637C16.0676 2.46074 16.1998 2.77855 16.1998 3.1498V12.1498C16.1998 12.5211 16.0676 12.8389 15.8032 13.1032C15.5389 13.3676 15.2211 13.4998 14.8498 13.4998H5.8498ZM5.8498 12.1498H14.8498V3.1498H5.8498V12.1498ZM3.1498 16.1998C2.77855 16.1998 2.46074 16.0676 2.19637 15.8032C1.93199 15.5389 1.7998 15.2211 1.7998 14.8498V4.4998H3.1498V14.8498H13.4998V16.1998H3.1498Z",fill:r})})]}),Wc=({mode:t,headerName:e,bubbleText:n,showBubbleText:r=!0,onClick:i})=>{const s=t==="modal"?`Open ${e}`:`Expand ${e}`;return h.jsxs("button",{className:"chat-wrapper__bubble-button",onClick:i,title:s,children:[h.jsx(pa,{className:"chat-wrapper__bubble-icon",size:24}),r&&h.jsx("span",{className:"chat-wrapper__bubble-text",children:n||"Chat"})]})},Gc=({headerName:t,mode:e,isCollapsed:n,isModalOpen:r,onClose:i,onToggleFullscreen:s,onToggleCollapse:a})=>{const o=()=>e==="modal"&&r&&i?h.jsx("button",{className:"chat-wrapper__close-button",onClick:i,title:"Close chat",children:h.jsx(fa,{size:20})}):null,c=()=>{if((e==="sidebar"||e==="fullscreen")&&!n&&s){const l=e==="fullscreen";return h.jsx("button",{className:l?"chat-wrapper__minimize-button":"chat-wrapper__fullscreen-button",onClick:s,title:l?"Switch to sidebar":"Switch to fullscreen",children:h.jsx(ga,{size:20,isFullscreen:l})})}return null},u=()=>(e==="sidebar"||e==="fullscreen")&&!n&&a?h.jsx("button",{className:"chat-wrapper__collapse-button",onClick:a,title:"Collapse chat",children:h.jsx(ma,{size:20})}):null;return h.jsxs("div",{className:"chat-wrapper__header",children:[h.jsx("div",{className:"chat-wrapper__title-area",children:h.jsx("h2",{className:"chat-wrapper__title",children:t})}),h.jsxs("div",{className:"chat-wrapper__header-controls",children:[c(),u(),o()]})]})};class qc extends Error{constructor(n,r,i,s,a){super(n);q(this,"name","Assertion");q(this,"code","ERR_ASSERTION");Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.actual=r,this.expected=i,this.generated=a,this.operator=s}}function T(t,e){xa(!!t,!1,!0,"ok","Expected value to be truthy",e)}function Pr(t){xa(!1,!1,!0,"ok","Unreachable",t)}function xa(t,e,n,r,i,s){if(!t)throw s instanceof Error?s:new qc(s||i,e,n,r,!s)}function Kc(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const Zc=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Yc=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Xc={};function Yi(t,e){return(Xc.jsx?Yc:Zc).test(t)}const Jc=/[ \t\n\f\r]/g;function Qc(t){return typeof t=="object"?t.type==="text"?Xi(t.value):!1:Xi(t)}function Xi(t){return t.replace(Jc,"")===""}class kn{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}kn.prototype.normal={};kn.prototype.property={};kn.prototype.space=void 0;function ya(t,e){const n={},r={};for(const i of t)Object.assign(n,i.property),Object.assign(r,i.normal);return new kn(n,r,e)}function Dr(t){return t.toLowerCase()}class rt{constructor(e,n){this.attribute=n,this.property=e}}rt.prototype.attribute="";rt.prototype.booleanish=!1;rt.prototype.boolean=!1;rt.prototype.commaOrSpaceSeparated=!1;rt.prototype.commaSeparated=!1;rt.prototype.defined=!1;rt.prototype.mustUseProperty=!1;rt.prototype.number=!1;rt.prototype.overloadedBoolean=!1;rt.prototype.property="";rt.prototype.spaceSeparated=!1;rt.prototype.space=void 0;let eu=0;const ue=$t(),Me=$t(),jr=$t(),D=$t(),we=$t(),Yt=$t(),at=$t();function $t(){return 2**++eu}const Fr=Object.freeze(Object.defineProperty({__proto__:null,boolean:ue,booleanish:Me,commaOrSpaceSeparated:at,commaSeparated:Yt,number:D,overloadedBoolean:jr,spaceSeparated:we},Symbol.toStringTag,{value:"Module"})),gr=Object.keys(Fr);class Xr extends rt{constructor(e,n,r,i){let s=-1;if(super(e,n),Ji(this,"space",i),typeof r=="number")for(;++s<gr.length;){const a=gr[s];Ji(this,gr[s],(r&Fr[a])===Fr[a])}}}Xr.prototype.defined=!0;function Ji(t,e,n){n&&(t[e]=n)}function en(t){const e={},n={};for(const[r,i]of Object.entries(t.properties)){const s=new Xr(r,t.transform(t.attributes||{},r),i,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(s.mustUseProperty=!0),e[r]=s,n[Dr(r)]=r,n[Dr(s.attribute)]=r}return new kn(e,n,t.space)}const Sa=en({properties:{ariaActiveDescendant:null,ariaAtomic:Me,ariaAutoComplete:null,ariaBusy:Me,ariaChecked:Me,ariaColCount:D,ariaColIndex:D,ariaColSpan:D,ariaControls:we,ariaCurrent:null,ariaDescribedBy:we,ariaDetails:null,ariaDisabled:Me,ariaDropEffect:we,ariaErrorMessage:null,ariaExpanded:Me,ariaFlowTo:we,ariaGrabbed:Me,ariaHasPopup:null,ariaHidden:Me,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:we,ariaLevel:D,ariaLive:null,ariaModal:Me,ariaMultiLine:Me,ariaMultiSelectable:Me,ariaOrientation:null,ariaOwns:we,ariaPlaceholder:null,ariaPosInSet:D,ariaPressed:Me,ariaReadOnly:Me,ariaRelevant:null,ariaRequired:Me,ariaRoleDescription:we,ariaRowCount:D,ariaRowIndex:D,ariaRowSpan:D,ariaSelected:Me,ariaSetSize:D,ariaSort:null,ariaValueMax:D,ariaValueMin:D,ariaValueNow:D,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function wa(t,e){return e in t?t[e]:e}function ka(t,e){return wa(t,e.toLowerCase())}const tu=en({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Yt,acceptCharset:we,accessKey:we,action:null,allow:null,allowFullScreen:ue,allowPaymentRequest:ue,allowUserMedia:ue,alt:null,as:null,async:ue,autoCapitalize:null,autoComplete:we,autoFocus:ue,autoPlay:ue,blocking:we,capture:null,charSet:null,checked:ue,cite:null,className:we,cols:D,colSpan:null,content:null,contentEditable:Me,controls:ue,controlsList:we,coords:D|Yt,crossOrigin:null,data:null,dateTime:null,decoding:null,default:ue,defer:ue,dir:null,dirName:null,disabled:ue,download:jr,draggable:Me,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:ue,formTarget:null,headers:we,height:D,hidden:jr,high:D,href:null,hrefLang:null,htmlFor:we,httpEquiv:we,id:null,imageSizes:null,imageSrcSet:null,inert:ue,inputMode:null,integrity:null,is:null,isMap:ue,itemId:null,itemProp:we,itemRef:we,itemScope:ue,itemType:we,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:ue,low:D,manifest:null,max:null,maxLength:D,media:null,method:null,min:null,minLength:D,multiple:ue,muted:ue,name:null,nonce:null,noModule:ue,noValidate:ue,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:ue,optimum:D,pattern:null,ping:we,placeholder:null,playsInline:ue,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:ue,referrerPolicy:null,rel:we,required:ue,reversed:ue,rows:D,rowSpan:D,sandbox:we,scope:null,scoped:ue,seamless:ue,selected:ue,shadowRootClonable:ue,shadowRootDelegatesFocus:ue,shadowRootMode:null,shape:null,size:D,sizes:null,slot:null,span:D,spellCheck:Me,src:null,srcDoc:null,srcLang:null,srcSet:null,start:D,step:null,style:null,tabIndex:D,target:null,title:null,translate:null,type:null,typeMustMatch:ue,useMap:null,value:Me,width:D,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:we,axis:null,background:null,bgColor:null,border:D,borderColor:null,bottomMargin:D,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:ue,declare:ue,event:null,face:null,frame:null,frameBorder:null,hSpace:D,leftMargin:D,link:null,longDesc:null,lowSrc:null,marginHeight:D,marginWidth:D,noResize:ue,noHref:ue,noShade:ue,noWrap:ue,object:null,profile:null,prompt:null,rev:null,rightMargin:D,rules:null,scheme:null,scrolling:Me,standby:null,summary:null,text:null,topMargin:D,valueType:null,version:null,vAlign:null,vLink:null,vSpace:D,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:ue,disableRemotePlayback:ue,prefix:null,property:null,results:D,security:null,unselectable:null},space:"html",transform:ka}),nu=en({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:at,accentHeight:D,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:D,amplitude:D,arabicForm:null,ascent:D,attributeName:null,attributeType:null,azimuth:D,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:D,by:null,calcMode:null,capHeight:D,className:we,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:D,diffuseConstant:D,direction:null,display:null,dur:null,divisor:D,dominantBaseline:null,download:ue,dx:null,dy:null,edgeMode:null,editable:null,elevation:D,enableBackground:null,end:null,event:null,exponent:D,externalResourcesRequired:null,fill:null,fillOpacity:D,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Yt,g2:Yt,glyphName:Yt,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:D,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:D,horizOriginX:D,horizOriginY:D,id:null,ideographic:D,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:D,k:D,k1:D,k2:D,k3:D,k4:D,kernelMatrix:at,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:D,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:D,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:D,overlineThickness:D,paintOrder:null,panose1:null,path:null,pathLength:D,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:we,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:D,pointsAtY:D,pointsAtZ:D,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:at,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:at,rev:at,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:at,requiredFeatures:at,requiredFonts:at,requiredFormats:at,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:D,specularExponent:D,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:D,strikethroughThickness:D,string:null,stroke:null,strokeDashArray:at,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:D,strokeOpacity:D,strokeWidth:null,style:null,surfaceScale:D,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:at,tabIndex:D,tableValues:null,target:null,targetX:D,targetY:D,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:at,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:D,underlineThickness:D,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:D,values:null,vAlphabetic:D,vMathematical:D,vectorEffect:null,vHanging:D,vIdeographic:D,version:null,vertAdvY:D,vertOriginX:D,vertOriginY:D,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:D,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:wa}),Ta=en({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),Ea=en({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:ka}),ba=en({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),ru={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},iu=/[A-Z]/g,Qi=/-[a-z]/g,su=/^data[-\w.:]+$/i;function au(t,e){const n=Dr(e);let r=e,i=rt;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&su.test(e)){if(e.charAt(4)==="-"){const s=e.slice(5).replace(Qi,lu);r="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=e.slice(4);if(!Qi.test(s)){let a=s.replace(iu,ou);a.charAt(0)!=="-"&&(a="-"+a),e="data"+a}}i=Xr}return new i(r,e)}function ou(t){return"-"+t.toLowerCase()}function lu(t){return t.charAt(1).toUpperCase()}const cu=ya([Sa,tu,Ta,Ea,ba],"html"),Jr=ya([Sa,nu,Ta,Ea,ba],"svg");function uu(t){return t.join(" ").trim()}var Qr={},es=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,hu=/\n/g,du=/^\s*/,pu=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,fu=/^:\s*/,gu=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,mu=/^[;\s]*/,Cu=/^\s+|\s+$/g,xu=`
`,ts="/",ns="*",Ut="",yu="comment",Su="declaration",wu=function(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function i(x){var S=x.match(hu);S&&(n+=S.length);var N=x.lastIndexOf(xu);r=~N?x.length-N:r+x.length}function s(){var x={line:n,column:r};return function(S){return S.position=new a(x),u(),S}}function a(x){this.start=x,this.end={line:n,column:r},this.source=e.source}a.prototype.content=t;function o(x){var S=new Error(e.source+":"+n+":"+r+": "+x);if(S.reason=x,S.filename=e.source,S.line=n,S.column=r,S.source=t,!e.silent)throw S}function c(x){var S=x.exec(t);if(S){var N=S[0];return i(N),t=t.slice(N.length),S}}function u(){c(du)}function l(x){var S;for(x=x||[];S=d();)S!==!1&&x.push(S);return x}function d(){var x=s();if(!(ts!=t.charAt(0)||ns!=t.charAt(1))){for(var S=2;Ut!=t.charAt(S)&&(ns!=t.charAt(S)||ts!=t.charAt(S+1));)++S;if(S+=2,Ut===t.charAt(S-1))return o("End of comment missing");var N=t.slice(2,S-2);return r+=2,i(N),t=t.slice(S),r+=2,x({type:yu,comment:N})}}function g(){var x=s(),S=c(pu);if(S){if(d(),!c(fu))return o("property missing ':'");var N=c(gu),E=x({type:Su,property:rs(S[0].replace(es,Ut)),value:N?rs(N[0].replace(es,Ut)):Ut});return c(mu),E}}function p(){var x=[];l(x);for(var S;S=g();)S!==!1&&(x.push(S),l(x));return x}return u(),p()};function rs(t){return t?t.replace(Cu,Ut):Ut}var ku=Kn&&Kn.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.default=Eu;var Tu=ku(wu);function Eu(t,e){var n=null;if(!t||typeof t!="string")return n;var r=(0,Tu.default)(t),i=typeof e=="function";return r.forEach(function(s){if(s.type==="declaration"){var a=s.property,o=s.value;i?e(a,o,s):o&&(n=n||{},n[a]=o)}}),n}var Jn={};Object.defineProperty(Jn,"__esModule",{value:!0});Jn.camelCase=void 0;var bu=/^--[a-zA-Z0-9_-]+$/,_u=/-([a-z])/g,vu=/^[^-]+$/,Ru=/^-(webkit|moz|ms|o|khtml)-/,Iu=/^-(ms)-/,Nu=function(t){return!t||vu.test(t)||bu.test(t)},Mu=function(t,e){return e.toUpperCase()},is=function(t,e){return"".concat(e,"-")},Au=function(t,e){return e===void 0&&(e={}),Nu(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(Iu,is):t=t.replace(Ru,is),t.replace(_u,Mu))};Jn.camelCase=Au;var Ou=Kn&&Kn.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},Lu=Ou(Qr),Pu=Jn;function Hr(t,e){var n={};return!t||typeof t!="string"||(0,Lu.default)(t,function(r,i){r&&i&&(n[(0,Pu.camelCase)(r,e)]=i)}),n}Hr.default=Hr;var Du=Hr;const ju=Zr(Du),_a=va("end"),ei=va("start");function va(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function Fu(t){const e=ei(t),n=_a(t);if(e&&n)return{start:e,end:n}}function mn(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?ss(t.position):"start"in t||"end"in t?ss(t):"line"in t||"column"in t?zr(t):""}function zr(t){return as(t&&t.line)+":"+as(t&&t.column)}function ss(t){return zr(t&&t.start)+"-"+zr(t&&t.end)}function as(t){return t&&typeof t=="number"?t:1}class We extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let i="",s={},a=!1;if(n&&("line"in n&&"column"in n?s={place:n}:"start"in n&&"end"in n?s={place:n}:"type"in n?s={ancestors:[n],place:n.position}:s={...n}),typeof e=="string"?i=e:!s.cause&&e&&(a=!0,i=e.message,s.cause=e),!s.ruleId&&!s.source&&typeof r=="string"){const c=r.indexOf(":");c===-1?s.ruleId=r:(s.source=r.slice(0,c),s.ruleId=r.slice(c+1))}if(!s.place&&s.ancestors&&s.ancestors){const c=s.ancestors[s.ancestors.length-1];c&&(s.place=c.position)}const o=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=i,this.line=o?o.line:void 0,this.name=mn(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=a&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}We.prototype.file="";We.prototype.name="";We.prototype.reason="";We.prototype.message="";We.prototype.stack="";We.prototype.column=void 0;We.prototype.line=void 0;We.prototype.ancestors=void 0;We.prototype.cause=void 0;We.prototype.fatal=void 0;We.prototype.place=void 0;We.prototype.ruleId=void 0;We.prototype.source=void 0;const ti={}.hasOwnProperty,Hu=new Map,zu=/[A-Z]/g,Uu=new Set(["table","tbody","thead","tfoot","tr"]),Bu=new Set(["td","th"]),Ra="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function $u(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=Xu(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=Yu(n,e.jsx,e.jsxs)}const i={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?Jr:cu,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},s=Ia(i,t,void 0);return s&&typeof s!="string"?s:i.create(t,i.Fragment,{children:s||void 0},void 0)}function Ia(t,e,n){if(e.type==="element")return Vu(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return Wu(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return qu(t,e,n);if(e.type==="mdxjsEsm")return Gu(t,e);if(e.type==="root")return Ku(t,e,n);if(e.type==="text")return Zu(t,e)}function Vu(t,e,n){const r=t.schema;let i=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(i=Jr,t.schema=i),t.ancestors.push(e);const s=Ma(t,e.tagName,!1),a=Ju(t,e);let o=ri(t,e);return Uu.has(e.tagName)&&(o=o.filter(function(c){return typeof c=="string"?!Qc(c):!0})),Na(t,a,s,e),ni(a,o),t.ancestors.pop(),t.schema=r,t.create(e,s,a,n)}function Wu(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return T(r.type==="ExpressionStatement"),t.evaluater.evaluateExpression(r.expression)}wn(t,e.position)}function Gu(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);wn(t,e.position)}function qu(t,e,n){const r=t.schema;let i=r;e.name==="svg"&&r.space==="html"&&(i=Jr,t.schema=i),t.ancestors.push(e);const s=e.name===null?t.Fragment:Ma(t,e.name,!0),a=Qu(t,e),o=ri(t,e);return Na(t,a,s,e),ni(a,o),t.ancestors.pop(),t.schema=r,t.create(e,s,a,n)}function Ku(t,e,n){const r={};return ni(r,ri(t,e)),t.create(e,t.Fragment,r,n)}function Zu(t,e){return e.value}function Na(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function ni(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function Yu(t,e,n){return r;function r(i,s,a,o){const u=Array.isArray(a.children)?n:e;return o?u(s,a,o):u(s,a)}}function Xu(t,e){return n;function n(r,i,s,a){const o=Array.isArray(s.children),c=ei(r);return e(i,s,a,o,{columnNumber:c?c.column-1:void 0,fileName:t,lineNumber:c?c.line:void 0},void 0)}}function Ju(t,e){const n={};let r,i;for(i in e.properties)if(i!=="children"&&ti.call(e.properties,i)){const s=eh(t,i,e.properties[i]);if(s){const[a,o]=s;t.tableCellAlignToStyle&&a==="align"&&typeof o=="string"&&Bu.has(e.tagName)?r=o:n[a]=o}}if(r){const s=n.style||(n.style={});s[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function Qu(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const s=r.data.estree.body[0];T(s.type==="ExpressionStatement");const a=s.expression;T(a.type==="ObjectExpression");const o=a.properties[0];T(o.type==="SpreadElement"),Object.assign(n,t.evaluater.evaluateExpression(o.argument))}else wn(t,e.position);else{const i=r.name;let s;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const o=r.value.data.estree.body[0];T(o.type==="ExpressionStatement"),s=t.evaluater.evaluateExpression(o.expression)}else wn(t,e.position);else s=r.value===null?!0:r.value;n[i]=s}return n}function ri(t,e){const n=[];let r=-1;const i=t.passKeys?new Map:Hu;for(;++r<e.children.length;){const s=e.children[r];let a;if(t.passKeys){const c=s.type==="element"?s.tagName:s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement"?s.name:void 0;if(c){const u=i.get(c)||0;a=c+"-"+u,i.set(c,u+1)}}const o=Ia(t,s,a);o!==void 0&&n.push(o)}return n}function eh(t,e,n){const r=au(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?Kc(n):uu(n)),r.property==="style"){let i=typeof n=="object"?n:th(t,String(n));return t.stylePropertyNameCase==="css"&&(i=nh(i)),["style",i]}return[t.elementAttributeNameCase==="react"&&r.space?ru[r.property]||r.property:r.attribute,n]}}function th(t,e){try{return ju(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,i=new We("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw i.file=t.filePath||void 0,i.url=Ra+"#cannot-parse-style-attribute",i}}function Ma(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const i=e.split(".");let s=-1,a;for(;++s<i.length;){const o=Yi(i[s])?{type:"Identifier",name:i[s]}:{type:"Literal",value:i[s]};a=a?{type:"MemberExpression",object:a,property:o,computed:!!(s&&o.type==="Literal"),optional:!1}:o}T(a,"always a result"),r=a}else r=Yi(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const i=r.value;return ti.call(t.components,i)?t.components[i]:i}if(t.evaluater)return t.evaluater.evaluateExpression(r);wn(t)}function wn(t,e){const n=new We("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=Ra+"#cannot-handle-mdx-estrees-without-createevaluater",n}function nh(t){const e={};let n;for(n in t)ti.call(t,n)&&(e[rh(n)]=t[n]);return e}function rh(t){let e=t.replace(zu,ih);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function ih(t){return"-"+t.toLowerCase()}const mr={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},sh={};function ah(t,e){const n=sh,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,i=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return Aa(t,r,i)}function Aa(t,e,n){if(oh(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return os(t.children,e,n)}return Array.isArray(t)?os(t,e,n):""}function os(t,e,n){const r=[];let i=-1;for(;++i<t.length;)r[i]=Aa(t[i],e,n);return r.join("")}function oh(t){return!!(t&&typeof t=="object")}const ls=document.createElement("i");function ii(t){const e="&"+t+";";ls.innerHTML=e;const n=ls.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}const m={carriageReturn:-5,lineFeed:-4,carriageReturnLineFeed:-3,horizontalTab:-2,virtualSpace:-1,eof:null,nul:0,ht:9,lf:10,vt:11,cr:13,space:32,exclamationMark:33,quotationMark:34,numberSign:35,percentSign:37,ampersand:38,apostrophe:39,leftParenthesis:40,rightParenthesis:41,asterisk:42,plusSign:43,dash:45,dot:46,slash:47,digit0:48,digit1:49,digit2:50,digit3:51,digit4:52,digit5:53,digit6:54,digit7:55,digit8:56,digit9:57,colon:58,semicolon:59,lessThan:60,equalsTo:61,greaterThan:62,questionMark:63,atSign:64,uppercaseX:88,leftSquareBracket:91,backslash:92,rightSquareBracket:93,caret:94,underscore:95,graveAccent:96,lowercaseX:120,tilde:126,del:127,byteOrderMarker:65279,replacementCharacter:65533},$={atxHeadingOpeningFenceSizeMax:6,autolinkDomainSizeMax:63,autolinkSchemeSizeMax:32,cdataOpeningString:"CDATA[",characterGroupPunctuation:2,characterGroupWhitespace:1,characterReferenceDecimalSizeMax:7,characterReferenceHexadecimalSizeMax:6,characterReferenceNamedSizeMax:31,codeFencedSequenceSizeMin:3,contentTypeContent:"content",contentTypeFlow:"flow",contentTypeString:"string",contentTypeText:"text",hardBreakPrefixSizeMin:2,htmlBasic:6,htmlCdata:5,htmlComment:2,htmlComplete:7,htmlDeclaration:4,htmlInstruction:3,htmlRawSizeMax:8,htmlRaw:1,linkResourceDestinationBalanceMax:32,linkReferenceSizeMax:999,listItemValueSizeMax:10,numericBaseDecimal:10,numericBaseHexadecimal:16,tabSize:4,thematicBreakMarkerCountMin:3,v8MaxSafeChunkSize:1e4},f={data:"data",whitespace:"whitespace",lineEnding:"lineEnding",lineEndingBlank:"lineEndingBlank",linePrefix:"linePrefix",lineSuffix:"lineSuffix",atxHeading:"atxHeading",atxHeadingSequence:"atxHeadingSequence",atxHeadingText:"atxHeadingText",autolink:"autolink",autolinkEmail:"autolinkEmail",autolinkMarker:"autolinkMarker",autolinkProtocol:"autolinkProtocol",characterEscape:"characterEscape",characterEscapeValue:"characterEscapeValue",characterReference:"characterReference",characterReferenceMarker:"characterReferenceMarker",characterReferenceMarkerNumeric:"characterReferenceMarkerNumeric",characterReferenceMarkerHexadecimal:"characterReferenceMarkerHexadecimal",characterReferenceValue:"characterReferenceValue",codeFenced:"codeFenced",codeFencedFence:"codeFencedFence",codeFencedFenceSequence:"codeFencedFenceSequence",codeFencedFenceInfo:"codeFencedFenceInfo",codeFencedFenceMeta:"codeFencedFenceMeta",codeFlowValue:"codeFlowValue",codeIndented:"codeIndented",codeText:"codeText",codeTextData:"codeTextData",codeTextPadding:"codeTextPadding",codeTextSequence:"codeTextSequence",content:"content",definition:"definition",definitionDestination:"definitionDestination",definitionDestinationLiteral:"definitionDestinationLiteral",definitionDestinationLiteralMarker:"definitionDestinationLiteralMarker",definitionDestinationRaw:"definitionDestinationRaw",definitionDestinationString:"definitionDestinationString",definitionLabel:"definitionLabel",definitionLabelMarker:"definitionLabelMarker",definitionLabelString:"definitionLabelString",definitionMarker:"definitionMarker",definitionTitle:"definitionTitle",definitionTitleMarker:"definitionTitleMarker",definitionTitleString:"definitionTitleString",emphasis:"emphasis",emphasisSequence:"emphasisSequence",emphasisText:"emphasisText",escapeMarker:"escapeMarker",hardBreakEscape:"hardBreakEscape",hardBreakTrailing:"hardBreakTrailing",htmlFlow:"htmlFlow",htmlFlowData:"htmlFlowData",htmlText:"htmlText",htmlTextData:"htmlTextData",image:"image",label:"label",labelText:"labelText",labelLink:"labelLink",labelImage:"labelImage",labelMarker:"labelMarker",labelImageMarker:"labelImageMarker",labelEnd:"labelEnd",link:"link",paragraph:"paragraph",reference:"reference",referenceMarker:"referenceMarker",referenceString:"referenceString",resource:"resource",resourceDestination:"resourceDestination",resourceDestinationLiteral:"resourceDestinationLiteral",resourceDestinationLiteralMarker:"resourceDestinationLiteralMarker",resourceDestinationRaw:"resourceDestinationRaw",resourceDestinationString:"resourceDestinationString",resourceMarker:"resourceMarker",resourceTitle:"resourceTitle",resourceTitleMarker:"resourceTitleMarker",resourceTitleString:"resourceTitleString",setextHeading:"setextHeading",setextHeadingText:"setextHeadingText",setextHeadingLine:"setextHeadingLine",setextHeadingLineSequence:"setextHeadingLineSequence",strong:"strong",strongSequence:"strongSequence",strongText:"strongText",thematicBreak:"thematicBreak",thematicBreakSequence:"thematicBreakSequence",blockQuote:"blockQuote",blockQuotePrefix:"blockQuotePrefix",blockQuoteMarker:"blockQuoteMarker",blockQuotePrefixWhitespace:"blockQuotePrefixWhitespace",listOrdered:"listOrdered",listUnordered:"listUnordered",listItemIndent:"listItemIndent",listItemMarker:"listItemMarker",listItemPrefix:"listItemPrefix",listItemPrefixWhitespace:"listItemPrefixWhitespace",listItemValue:"listItemValue",chunkContent:"chunkContent",chunkFlow:"chunkFlow",chunkText:"chunkText",chunkString:"chunkString"},yt={ht:"	",lf:`
`,cr:"\r",space:" ",replacementCharacter:"ï¿½"};function Tt(t,e,n,r){const i=t.length;let s=0,a;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,n=n>0?n:0,r.length<$.v8MaxSafeChunkSize)a=Array.from(r),a.unshift(e,n),t.splice(...a);else for(n&&t.splice(e,n);s<r.length;)a=r.slice(s,s+$.v8MaxSafeChunkSize),a.unshift(e,0),t.splice(...a),s+=$.v8MaxSafeChunkSize,e+=$.v8MaxSafeChunkSize}function ct(t,e){return t.length>0?(Tt(t,t.length,0,e),t):e}const cs={}.hasOwnProperty;function lh(t){const e={};let n=-1;for(;++n<t.length;)ch(e,t[n]);return e}function ch(t,e){let n;for(n in e){const i=(cs.call(t,n)?t[n]:void 0)||(t[n]={}),s=e[n];let a;if(s)for(a in s){cs.call(i,a)||(i[a]=[]);const o=s[a];uh(i[a],Array.isArray(o)?o:o?[o]:[])}}}function uh(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);Tt(t,0,0,r)}function Oa(t,e){const n=Number.parseInt(t,e);return n<m.ht||n===m.vt||n>m.cr&&n<m.space||n>m.tilde&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?yt.replacementCharacter:String.fromCodePoint(n)}function Xt(t){return t.replace(/[\t\n\r ]+/g,yt.space).replace(/^ | $/g,"").toLowerCase().toUpperCase()}const wt=Dt(/[A-Za-z]/),ot=Dt(/[\dA-Za-z]/),hh=Dt(/[#-'*+\--9=?A-Z^-~]/);function Ur(t){return t!==null&&(t<m.space||t===m.del)}const Br=Dt(/\d/),dh=Dt(/[\dA-Fa-f]/),ph=Dt(/[!-/:-@[-`{-~]/);function Z(t){return t!==null&&t<m.horizontalTab}function nt(t){return t!==null&&(t<m.nul||t===m.space)}function Ce(t){return t===m.horizontalTab||t===m.virtualSpace||t===m.space}const fh=Dt(new RegExp("\\p{P}|\\p{S}","u")),gh=Dt(/\s/);function Dt(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function tn(t){const e=[];let n=-1,r=0,i=0;for(;++n<t.length;){const s=t.charCodeAt(n);let a="";if(s===m.percentSign&&ot(t.charCodeAt(n+1))&&ot(t.charCodeAt(n+2)))i=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(a=String.fromCharCode(s));else if(s>55295&&s<57344){const o=t.charCodeAt(n+1);s<56320&&o>56319&&o<57344?(a=String.fromCharCode(s,o),i=1):a=yt.replacementCharacter}else a=String.fromCharCode(s);a&&(e.push(t.slice(r,n),encodeURIComponent(a)),r=n+i+1,a=""),i&&(n+=i,i=0)}return e.join("")+t.slice(r)}function ke(t,e,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let s=0;return a;function a(c){return Ce(c)?(t.enter(n),o(c)):e(c)}function o(c){return Ce(c)&&s++<i?(t.consume(c),o):(t.exit(n),e(c))}}const mh={tokenize:Ch};function Ch(t){const e=t.attempt(this.parser.constructs.contentInitial,r,i);let n;return e;function r(o){if(T(o===m.eof||Z(o),"expected eol or eof"),o===m.eof){t.consume(o);return}return t.enter(f.lineEnding),t.consume(o),t.exit(f.lineEnding),ke(t,e,f.linePrefix)}function i(o){return T(o!==m.eof&&!Z(o),"expected anything other than a line ending or EOF"),t.enter(f.paragraph),s(o)}function s(o){const c=t.enter(f.chunkText,{contentType:$.contentTypeText,previous:n});return n&&(n.next=c),n=c,a(o)}function a(o){if(o===m.eof){t.exit(f.chunkText),t.exit(f.paragraph),t.consume(o);return}return Z(o)?(t.consume(o),t.exit(f.chunkText),s):(t.consume(o),a)}}const xh={tokenize:yh},us={tokenize:Sh};function yh(t){const e=this,n=[];let r=0,i,s,a;return o;function o(M){if(r<n.length){const O=n[r];return e.containerState=O[1],T(O[0].continuation,"expected `continuation` to be defined on container construct"),t.attempt(O[0].continuation,c,u)(M)}return u(M)}function c(M){if(T(e.containerState,"expected `containerState` to be defined after continuation"),r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,i&&v();const O=e.events.length;let P=O,b;for(;P--;)if(e.events[P][0]==="exit"&&e.events[P][1].type===f.chunkFlow){b=e.events[P][1].end;break}T(b,"could not find previous flow chunk"),E(r);let z=O;for(;z<e.events.length;)e.events[z][1].end={...b},z++;return Tt(e.events,P+1,0,e.events.slice(O)),e.events.length=z,u(M)}return o(M)}function u(M){if(r===n.length){if(!i)return g(M);if(i.currentConstruct&&i.currentConstruct.concrete)return x(M);e.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(us,l,d)(M)}function l(M){return i&&v(),E(r),g(M)}function d(M){return e.parser.lazy[e.now().line]=r!==n.length,a=e.now().offset,x(M)}function g(M){return e.containerState={},t.attempt(us,p,x)(M)}function p(M){return T(e.currentConstruct,"expected `currentConstruct` to be defined on tokenizer"),T(e.containerState,"expected `containerState` to be defined on tokenizer"),r++,n.push([e.currentConstruct,e.containerState]),g(M)}function x(M){if(M===m.eof){i&&v(),E(0),t.consume(M);return}return i=i||e.parser.flow(e.now()),t.enter(f.chunkFlow,{_tokenizer:i,contentType:$.contentTypeFlow,previous:s}),S(M)}function S(M){if(M===m.eof){N(t.exit(f.chunkFlow),!0),E(0),t.consume(M);return}return Z(M)?(t.consume(M),N(t.exit(f.chunkFlow)),r=0,e.interrupt=void 0,o):(t.consume(M),S)}function N(M,O){T(i,"expected `childFlow` to be defined when continuing");const P=e.sliceStream(M);if(O&&P.push(null),M.previous=s,s&&(s.next=M),s=M,i.defineSkip(M.start),i.write(P),e.parser.lazy[M.start.line]){let b=i.events.length;for(;b--;)if(i.events[b][1].start.offset<a&&(!i.events[b][1].end||i.events[b][1].end.offset>a))return;const z=e.events.length;let U=z,W,Y;for(;U--;)if(e.events[U][0]==="exit"&&e.events[U][1].type===f.chunkFlow){if(W){Y=e.events[U][1].end;break}W=!0}for(T(Y,"could not find previous flow chunk"),E(r),b=z;b<e.events.length;)e.events[b][1].end={...Y},b++;Tt(e.events,U+1,0,e.events.slice(z)),e.events.length=b}}function E(M){let O=n.length;for(;O-- >M;){const P=n[O];e.containerState=P[1],T(P[0].exit,"expected `exit` to be defined on container construct"),P[0].exit.call(e,t)}n.length=M}function v(){T(e.containerState,"expected `containerState` to be defined when closing flow"),T(i,"expected `childFlow` to be defined when closing it"),i.write([m.eof]),s=void 0,i=void 0,e.containerState._closeFlow=void 0}}function Sh(t,e,n){return T(this.parser.constructs.disable.null,"expected `disable.null` to be populated"),ke(t,t.attempt(this.parser.constructs.document,e,n),f.linePrefix,this.parser.constructs.disable.null.includes("codeIndented")?void 0:$.tabSize)}function hs(t){if(t===m.eof||nt(t)||gh(t))return $.characterGroupWhitespace;if(fh(t))return $.characterGroupPunctuation}function si(t,e,n){const r=[];let i=-1;for(;++i<t.length;){const s=t[i].resolveAll;s&&!r.includes(s)&&(e=s(e,n),r.push(s))}return e}const $r={name:"attention",resolveAll:wh,tokenize:kh};function wh(t,e){let n=-1,r,i,s,a,o,c,u,l;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;c=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const d={...t[r][1].end},g={...t[n][1].start};ds(d,-c),ds(g,c),a={type:c>1?f.strongSequence:f.emphasisSequence,start:d,end:{...t[r][1].end}},o={type:c>1?f.strongSequence:f.emphasisSequence,start:{...t[n][1].start},end:g},s={type:c>1?f.strongText:f.emphasisText,start:{...t[r][1].end},end:{...t[n][1].start}},i={type:c>1?f.strong:f.emphasis,start:{...a.start},end:{...o.end}},t[r][1].end={...a.start},t[n][1].start={...o.end},u=[],t[r][1].end.offset-t[r][1].start.offset&&(u=ct(u,[["enter",t[r][1],e],["exit",t[r][1],e]])),u=ct(u,[["enter",i,e],["enter",a,e],["exit",a,e],["enter",s,e]]),T(e.parser.constructs.insideSpan.null,"expected `insideSpan` to be populated"),u=ct(u,si(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),u=ct(u,[["exit",s,e],["enter",o,e],["exit",o,e],["exit",i,e]]),t[n][1].end.offset-t[n][1].start.offset?(l=2,u=ct(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):l=0,Tt(t,r-1,n-r+3,u),n=r+u.length-l-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function kh(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=hs(r);let s;return a;function a(c){return T(c===m.asterisk||c===m.underscore,"expected asterisk or underscore"),s=c,t.enter("attentionSequence"),o(c)}function o(c){if(c===s)return t.consume(c),o;const u=t.exit("attentionSequence"),l=hs(c);T(n,"expected `attentionMarkers` to be populated");const d=!l||l===$.characterGroupPunctuation&&i||n.includes(c),g=!i||i===$.characterGroupPunctuation&&l||n.includes(r);return u._open=!!(s===m.asterisk?d:d&&(i||!g)),u._close=!!(s===m.asterisk?g:g&&(l||!d)),e(c)}}function ds(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const Th={name:"autolink",tokenize:Eh};function Eh(t,e,n){let r=0;return i;function i(p){return T(p===m.lessThan,"expected `<`"),t.enter(f.autolink),t.enter(f.autolinkMarker),t.consume(p),t.exit(f.autolinkMarker),t.enter(f.autolinkProtocol),s}function s(p){return wt(p)?(t.consume(p),a):p===m.atSign?n(p):u(p)}function a(p){return p===m.plusSign||p===m.dash||p===m.dot||ot(p)?(r=1,o(p)):u(p)}function o(p){return p===m.colon?(t.consume(p),r=0,c):(p===m.plusSign||p===m.dash||p===m.dot||ot(p))&&r++<$.autolinkSchemeSizeMax?(t.consume(p),o):(r=0,u(p))}function c(p){return p===m.greaterThan?(t.exit(f.autolinkProtocol),t.enter(f.autolinkMarker),t.consume(p),t.exit(f.autolinkMarker),t.exit(f.autolink),e):p===m.eof||p===m.space||p===m.lessThan||Ur(p)?n(p):(t.consume(p),c)}function u(p){return p===m.atSign?(t.consume(p),l):hh(p)?(t.consume(p),u):n(p)}function l(p){return ot(p)?d(p):n(p)}function d(p){return p===m.dot?(t.consume(p),r=0,l):p===m.greaterThan?(t.exit(f.autolinkProtocol).type=f.autolinkEmail,t.enter(f.autolinkMarker),t.consume(p),t.exit(f.autolinkMarker),t.exit(f.autolink),e):g(p)}function g(p){if((p===m.dash||ot(p))&&r++<$.autolinkDomainSizeMax){const x=p===m.dash?g:d;return t.consume(p),x}return n(p)}}const Qn={partial:!0,tokenize:bh};function bh(t,e,n){return r;function r(s){return Ce(s)?ke(t,i,f.linePrefix)(s):i(s)}function i(s){return s===m.eof||Z(s)?e(s):n(s)}}const La={continuation:{tokenize:vh},exit:Rh,name:"blockQuote",tokenize:_h};function _h(t,e,n){const r=this;return i;function i(a){if(a===m.greaterThan){const o=r.containerState;return T(o,"expected `containerState` to be defined in container"),o.open||(t.enter(f.blockQuote,{_container:!0}),o.open=!0),t.enter(f.blockQuotePrefix),t.enter(f.blockQuoteMarker),t.consume(a),t.exit(f.blockQuoteMarker),s}return n(a)}function s(a){return Ce(a)?(t.enter(f.blockQuotePrefixWhitespace),t.consume(a),t.exit(f.blockQuotePrefixWhitespace),t.exit(f.blockQuotePrefix),e):(t.exit(f.blockQuotePrefix),e(a))}}function vh(t,e,n){const r=this;return i;function i(a){return Ce(a)?(T(r.parser.constructs.disable.null,"expected `disable.null` to be populated"),ke(t,s,f.linePrefix,r.parser.constructs.disable.null.includes("codeIndented")?void 0:$.tabSize)(a)):s(a)}function s(a){return t.attempt(La,e,n)(a)}}function Rh(t){t.exit(f.blockQuote)}const Pa={name:"characterEscape",tokenize:Ih};function Ih(t,e,n){return r;function r(s){return T(s===m.backslash,"expected `\\`"),t.enter(f.characterEscape),t.enter(f.escapeMarker),t.consume(s),t.exit(f.escapeMarker),i}function i(s){return ph(s)?(t.enter(f.characterEscapeValue),t.consume(s),t.exit(f.characterEscapeValue),t.exit(f.characterEscape),e):n(s)}}const Da={name:"characterReference",tokenize:Nh};function Nh(t,e,n){const r=this;let i=0,s,a;return o;function o(d){return T(d===m.ampersand,"expected `&`"),t.enter(f.characterReference),t.enter(f.characterReferenceMarker),t.consume(d),t.exit(f.characterReferenceMarker),c}function c(d){return d===m.numberSign?(t.enter(f.characterReferenceMarkerNumeric),t.consume(d),t.exit(f.characterReferenceMarkerNumeric),u):(t.enter(f.characterReferenceValue),s=$.characterReferenceNamedSizeMax,a=ot,l(d))}function u(d){return d===m.uppercaseX||d===m.lowercaseX?(t.enter(f.characterReferenceMarkerHexadecimal),t.consume(d),t.exit(f.characterReferenceMarkerHexadecimal),t.enter(f.characterReferenceValue),s=$.characterReferenceHexadecimalSizeMax,a=dh,l):(t.enter(f.characterReferenceValue),s=$.characterReferenceDecimalSizeMax,a=Br,l(d))}function l(d){if(d===m.semicolon&&i){const g=t.exit(f.characterReferenceValue);return a===ot&&!ii(r.sliceSerialize(g))?n(d):(t.enter(f.characterReferenceMarker),t.consume(d),t.exit(f.characterReferenceMarker),t.exit(f.characterReference),e)}return a(d)&&i++<s?(t.consume(d),l):n(d)}}const ps={partial:!0,tokenize:Ah},fs={concrete:!0,name:"codeFenced",tokenize:Mh};function Mh(t,e,n){const r=this,i={partial:!0,tokenize:P};let s=0,a=0,o;return c;function c(b){return u(b)}function u(b){T(b===m.graveAccent||b===m.tilde,"expected `` ` `` or `~`");const z=r.events[r.events.length-1];return s=z&&z[1].type===f.linePrefix?z[2].sliceSerialize(z[1],!0).length:0,o=b,t.enter(f.codeFenced),t.enter(f.codeFencedFence),t.enter(f.codeFencedFenceSequence),l(b)}function l(b){return b===o?(a++,t.consume(b),l):a<$.codeFencedSequenceSizeMin?n(b):(t.exit(f.codeFencedFenceSequence),Ce(b)?ke(t,d,f.whitespace)(b):d(b))}function d(b){return b===m.eof||Z(b)?(t.exit(f.codeFencedFence),r.interrupt?e(b):t.check(ps,S,O)(b)):(t.enter(f.codeFencedFenceInfo),t.enter(f.chunkString,{contentType:$.contentTypeString}),g(b))}function g(b){return b===m.eof||Z(b)?(t.exit(f.chunkString),t.exit(f.codeFencedFenceInfo),d(b)):Ce(b)?(t.exit(f.chunkString),t.exit(f.codeFencedFenceInfo),ke(t,p,f.whitespace)(b)):b===m.graveAccent&&b===o?n(b):(t.consume(b),g)}function p(b){return b===m.eof||Z(b)?d(b):(t.enter(f.codeFencedFenceMeta),t.enter(f.chunkString,{contentType:$.contentTypeString}),x(b))}function x(b){return b===m.eof||Z(b)?(t.exit(f.chunkString),t.exit(f.codeFencedFenceMeta),d(b)):b===m.graveAccent&&b===o?n(b):(t.consume(b),x)}function S(b){return T(Z(b),"expected eol"),t.attempt(i,O,N)(b)}function N(b){return T(Z(b),"expected eol"),t.enter(f.lineEnding),t.consume(b),t.exit(f.lineEnding),E}function E(b){return s>0&&Ce(b)?ke(t,v,f.linePrefix,s+1)(b):v(b)}function v(b){return b===m.eof||Z(b)?t.check(ps,S,O)(b):(t.enter(f.codeFlowValue),M(b))}function M(b){return b===m.eof||Z(b)?(t.exit(f.codeFlowValue),v(b)):(t.consume(b),M)}function O(b){return t.exit(f.codeFenced),e(b)}function P(b,z,U){let W=0;return Y;function Y(F){return T(Z(F),"expected eol"),b.enter(f.lineEnding),b.consume(F),b.exit(f.lineEnding),G}function G(F){return T(r.parser.constructs.disable.null,"expected `disable.null` to be populated"),b.enter(f.codeFencedFence),Ce(F)?ke(b,H,f.linePrefix,r.parser.constructs.disable.null.includes("codeIndented")?void 0:$.tabSize)(F):H(F)}function H(F){return F===o?(b.enter(f.codeFencedFenceSequence),_(F)):U(F)}function _(F){return F===o?(W++,b.consume(F),_):W>=a?(b.exit(f.codeFencedFenceSequence),Ce(F)?ke(b,L,f.whitespace)(F):L(F)):U(F)}function L(F){return F===m.eof||Z(F)?(b.exit(f.codeFencedFence),z(F)):U(F)}}}function Ah(t,e,n){const r=this;return i;function i(a){return a===m.eof?n(a):(T(Z(a),"expected eol"),t.enter(f.lineEnding),t.consume(a),t.exit(f.lineEnding),s)}function s(a){return r.parser.lazy[r.now().line]?n(a):e(a)}}const Cr={name:"codeIndented",tokenize:Lh},Oh={partial:!0,tokenize:Ph};function Lh(t,e,n){const r=this;return i;function i(u){return T(Ce(u)),t.enter(f.codeIndented),ke(t,s,f.linePrefix,$.tabSize+1)(u)}function s(u){const l=r.events[r.events.length-1];return l&&l[1].type===f.linePrefix&&l[2].sliceSerialize(l[1],!0).length>=$.tabSize?a(u):n(u)}function a(u){return u===m.eof?c(u):Z(u)?t.attempt(Oh,a,c)(u):(t.enter(f.codeFlowValue),o(u))}function o(u){return u===m.eof||Z(u)?(t.exit(f.codeFlowValue),a(u)):(t.consume(u),o)}function c(u){return t.exit(f.codeIndented),e(u)}}function Ph(t,e,n){const r=this;return i;function i(a){return r.parser.lazy[r.now().line]?n(a):Z(a)?(t.enter(f.lineEnding),t.consume(a),t.exit(f.lineEnding),i):ke(t,s,f.linePrefix,$.tabSize+1)(a)}function s(a){const o=r.events[r.events.length-1];return o&&o[1].type===f.linePrefix&&o[2].sliceSerialize(o[1],!0).length>=$.tabSize?e(a):Z(a)?i(a):n(a)}}const Dh={name:"codeText",previous:ja,resolve:jh,tokenize:Fh};function jh(t){let e=t.length-4,n=3,r,i;if((t[n][1].type===f.lineEnding||t[n][1].type==="space")&&(t[e][1].type===f.lineEnding||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type===f.codeTextData){t[n][1].type=f.codeTextPadding,t[e][1].type=f.codeTextPadding,n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)i===void 0?r!==e&&t[r][1].type!==f.lineEnding&&(i=r):(r===e||t[r][1].type===f.lineEnding)&&(t[i][1].type=f.codeTextData,r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return t}function ja(t){return t!==m.graveAccent||this.events[this.events.length-1][1].type===f.characterEscape}function Fh(t,e,n){const r=this;let i=0,s,a;return o;function o(g){return T(g===m.graveAccent,"expected `` ` ``"),T(ja.call(r,r.previous),"expected correct previous"),t.enter(f.codeText),t.enter(f.codeTextSequence),c(g)}function c(g){return g===m.graveAccent?(t.consume(g),i++,c):(t.exit(f.codeTextSequence),u(g))}function u(g){return g===m.eof?n(g):g===m.space?(t.enter("space"),t.consume(g),t.exit("space"),u):g===m.graveAccent?(a=t.enter(f.codeTextSequence),s=0,d(g)):Z(g)?(t.enter(f.lineEnding),t.consume(g),t.exit(f.lineEnding),u):(t.enter(f.codeTextData),l(g))}function l(g){return g===m.eof||g===m.space||g===m.graveAccent||Z(g)?(t.exit(f.codeTextData),u(g)):(t.consume(g),l)}function d(g){return g===m.graveAccent?(t.consume(g),s++,d):s===i?(t.exit(f.codeTextSequence),t.exit(f.codeText),e(g)):(a.type=f.codeTextData,l(g))}}class Hh{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const i=n||0;this.setCursor(Math.trunc(e));const s=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&dn(this.left,r),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),dn(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),dn(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);dn(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);dn(this.left,n.reverse())}}}function dn(t,e){let n=0;if(e.length<$.v8MaxSafeChunkSize)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+$.v8MaxSafeChunkSize)),n+=$.v8MaxSafeChunkSize}function Fa(t){const e={};let n=-1,r,i,s,a,o,c,u;const l=new Hh(t);for(;++n<l.length;){for(;n in e;)n=e[n];if(r=l.get(n),n&&r[1].type===f.chunkFlow&&l.get(n-1)[1].type===f.listItemPrefix&&(T(r[1]._tokenizer,"expected `_tokenizer` on subtokens"),c=r[1]._tokenizer.events,s=0,s<c.length&&c[s][1].type===f.lineEndingBlank&&(s+=2),s<c.length&&c[s][1].type===f.content))for(;++s<c.length&&c[s][1].type!==f.content;)c[s][1].type===f.chunkText&&(c[s][1]._isInFirstContentOfListItem=!0,s++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,zh(l,n)),n=e[n],u=!0);else if(r[1]._container){for(s=n,i=void 0;s--;)if(a=l.get(s),a[1].type===f.lineEnding||a[1].type===f.lineEndingBlank)a[0]==="enter"&&(i&&(l.get(i)[1].type=f.lineEndingBlank),a[1].type=f.lineEnding,i=s);else if(!(a[1].type===f.linePrefix||a[1].type===f.listItemIndent))break;i&&(r[1].end={...l.get(i)[1].start},o=l.slice(i,n),o.unshift(r),l.splice(i,n-i+1,o))}}return Tt(t,0,Number.POSITIVE_INFINITY,l.slice(0)),!u}function zh(t,e){const n=t.get(e)[1],r=t.get(e)[2];let i=e-1;const s=[];T(n.contentType,"expected `contentType` on subtokens");let a=n._tokenizer;a||(a=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(a._contentTypeTextTrailing=!0));const o=a.events,c=[],u={};let l,d,g=-1,p=n,x=0,S=0;const N=[S];for(;p;){for(;t.get(++i)[1]!==p;);T(!d||p.previous===d,"expected previous to match"),T(!d||d.next===p,"expected next to match"),s.push(i),p._tokenizer||(l=r.sliceStream(p),p.next||l.push(m.eof),d&&a.defineSkip(p.start),p._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(l),p._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=n;++g<o.length;)o[g][0]==="exit"&&o[g-1][0]==="enter"&&o[g][1].type===o[g-1][1].type&&o[g][1].start.line!==o[g][1].end.line&&(T(p,"expected a current token"),S=g+1,N.push(S),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(a.events=[],p?(p._tokenizer=void 0,p.previous=void 0,T(!p.next,"expected no next token")):N.pop(),g=N.length;g--;){const E=o.slice(N[g],N[g+1]),v=s.pop();T(v!==void 0,"expected a start position when splicing"),c.push([v,v+E.length-1]),t.splice(v,2,E)}for(c.reverse(),g=-1;++g<c.length;)u[x+c[g][0]]=x+c[g][1],x+=c[g][1]-c[g][0]-1;return u}const Uh={resolve:$h,tokenize:Vh},Bh={partial:!0,tokenize:Wh};function $h(t){return Fa(t),t}function Vh(t,e){let n;return r;function r(o){return T(o!==m.eof&&!Z(o),"expected no eof or eol"),t.enter(f.content),n=t.enter(f.chunkContent,{contentType:$.contentTypeContent}),i(o)}function i(o){return o===m.eof?s(o):Z(o)?t.check(Bh,a,s)(o):(t.consume(o),i)}function s(o){return t.exit(f.chunkContent),t.exit(f.content),e(o)}function a(o){return T(Z(o),"expected eol"),t.consume(o),t.exit(f.chunkContent),T(n,"expected previous token"),n.next=t.enter(f.chunkContent,{contentType:$.contentTypeContent,previous:n}),n=n.next,i}}function Wh(t,e,n){const r=this;return i;function i(a){return T(Z(a),"expected a line ending"),t.exit(f.chunkContent),t.enter(f.lineEnding),t.consume(a),t.exit(f.lineEnding),ke(t,s,f.linePrefix)}function s(a){if(a===m.eof||Z(a))return n(a);T(r.parser.constructs.disable.null,"expected `disable.null` to be populated");const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type===f.linePrefix&&o[2].sliceSerialize(o[1],!0).length>=$.tabSize?e(a):t.interrupt(r.parser.constructs.flow,n,e)(a)}}function Ha(t,e,n,r,i,s,a,o,c){const u=c||Number.POSITIVE_INFINITY;let l=0;return d;function d(E){return E===m.lessThan?(t.enter(r),t.enter(i),t.enter(s),t.consume(E),t.exit(s),g):E===m.eof||E===m.space||E===m.rightParenthesis||Ur(E)?n(E):(t.enter(r),t.enter(a),t.enter(o),t.enter(f.chunkString,{contentType:$.contentTypeString}),S(E))}function g(E){return E===m.greaterThan?(t.enter(s),t.consume(E),t.exit(s),t.exit(i),t.exit(r),e):(t.enter(o),t.enter(f.chunkString,{contentType:$.contentTypeString}),p(E))}function p(E){return E===m.greaterThan?(t.exit(f.chunkString),t.exit(o),g(E)):E===m.eof||E===m.lessThan||Z(E)?n(E):(t.consume(E),E===m.backslash?x:p)}function x(E){return E===m.lessThan||E===m.greaterThan||E===m.backslash?(t.consume(E),p):p(E)}function S(E){return!l&&(E===m.eof||E===m.rightParenthesis||nt(E))?(t.exit(f.chunkString),t.exit(o),t.exit(a),t.exit(r),e(E)):l<u&&E===m.leftParenthesis?(t.consume(E),l++,S):E===m.rightParenthesis?(t.consume(E),l--,S):E===m.eof||E===m.space||E===m.leftParenthesis||Ur(E)?n(E):(t.consume(E),E===m.backslash?N:S)}function N(E){return E===m.leftParenthesis||E===m.rightParenthesis||E===m.backslash?(t.consume(E),S):S(E)}}function za(t,e,n,r,i,s){const a=this;let o=0,c;return u;function u(p){return T(p===m.leftSquareBracket,"expected `[`"),t.enter(r),t.enter(i),t.consume(p),t.exit(i),t.enter(s),l}function l(p){return o>$.linkReferenceSizeMax||p===m.eof||p===m.leftSquareBracket||p===m.rightSquareBracket&&!c||p===m.caret&&!o&&"_hiddenFootnoteSupport"in a.parser.constructs?n(p):p===m.rightSquareBracket?(t.exit(s),t.enter(i),t.consume(p),t.exit(i),t.exit(r),e):Z(p)?(t.enter(f.lineEnding),t.consume(p),t.exit(f.lineEnding),l):(t.enter(f.chunkString,{contentType:$.contentTypeString}),d(p))}function d(p){return p===m.eof||p===m.leftSquareBracket||p===m.rightSquareBracket||Z(p)||o++>$.linkReferenceSizeMax?(t.exit(f.chunkString),l(p)):(t.consume(p),c||(c=!Ce(p)),p===m.backslash?g:d)}function g(p){return p===m.leftSquareBracket||p===m.backslash||p===m.rightSquareBracket?(t.consume(p),o++,d):d(p)}}function Ua(t,e,n,r,i,s){let a;return o;function o(g){return g===m.quotationMark||g===m.apostrophe||g===m.leftParenthesis?(t.enter(r),t.enter(i),t.consume(g),t.exit(i),a=g===m.leftParenthesis?m.rightParenthesis:g,c):n(g)}function c(g){return g===a?(t.enter(i),t.consume(g),t.exit(i),t.exit(r),e):(t.enter(s),u(g))}function u(g){return g===a?(t.exit(s),c(a)):g===m.eof?n(g):Z(g)?(t.enter(f.lineEnding),t.consume(g),t.exit(f.lineEnding),ke(t,u,f.linePrefix)):(t.enter(f.chunkString,{contentType:$.contentTypeString}),l(g))}function l(g){return g===a||g===m.eof||Z(g)?(t.exit(f.chunkString),u(g)):(t.consume(g),g===m.backslash?d:l)}function d(g){return g===a||g===m.backslash?(t.consume(g),l):l(g)}}function Cn(t,e){let n;return r;function r(i){return Z(i)?(t.enter(f.lineEnding),t.consume(i),t.exit(f.lineEnding),n=!0,r):Ce(i)?ke(t,r,n?f.linePrefix:f.lineSuffix)(i):e(i)}}const Gh={name:"definition",tokenize:Kh},qh={partial:!0,tokenize:Zh};function Kh(t,e,n){const r=this;let i;return s;function s(p){return t.enter(f.definition),a(p)}function a(p){return T(p===m.leftSquareBracket,"expected `[`"),za.call(r,t,o,n,f.definitionLabel,f.definitionLabelMarker,f.definitionLabelString)(p)}function o(p){return i=Xt(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===m.colon?(t.enter(f.definitionMarker),t.consume(p),t.exit(f.definitionMarker),c):n(p)}function c(p){return nt(p)?Cn(t,u)(p):u(p)}function u(p){return Ha(t,l,n,f.definitionDestination,f.definitionDestinationLiteral,f.definitionDestinationLiteralMarker,f.definitionDestinationRaw,f.definitionDestinationString)(p)}function l(p){return t.attempt(qh,d,d)(p)}function d(p){return Ce(p)?ke(t,g,f.whitespace)(p):g(p)}function g(p){return p===m.eof||Z(p)?(t.exit(f.definition),r.parser.defined.push(i),e(p)):n(p)}}function Zh(t,e,n){return r;function r(o){return nt(o)?Cn(t,i)(o):n(o)}function i(o){return Ua(t,s,n,f.definitionTitle,f.definitionTitleMarker,f.definitionTitleString)(o)}function s(o){return Ce(o)?ke(t,a,f.whitespace)(o):a(o)}function a(o){return o===m.eof||Z(o)?e(o):n(o)}}const Yh={name:"hardBreakEscape",tokenize:Xh};function Xh(t,e,n){return r;function r(s){return T(s===m.backslash,"expected `\\`"),t.enter(f.hardBreakEscape),t.consume(s),i}function i(s){return Z(s)?(t.exit(f.hardBreakEscape),e(s)):n(s)}}const Jh={name:"headingAtx",resolve:Qh,tokenize:ed};function Qh(t,e){let n=t.length-2,r=3,i,s;return t[r][1].type===f.whitespace&&(r+=2),n-2>r&&t[n][1].type===f.whitespace&&(n-=2),t[n][1].type===f.atxHeadingSequence&&(r===n-1||n-4>r&&t[n-2][1].type===f.whitespace)&&(n-=r+1===n?2:4),n>r&&(i={type:f.atxHeadingText,start:t[r][1].start,end:t[n][1].end},s={type:f.chunkText,start:t[r][1].start,end:t[n][1].end,contentType:$.contentTypeText},Tt(t,r,n-r+1,[["enter",i,e],["enter",s,e],["exit",s,e],["exit",i,e]])),t}function ed(t,e,n){let r=0;return i;function i(l){return t.enter(f.atxHeading),s(l)}function s(l){return T(l===m.numberSign,"expected `#`"),t.enter(f.atxHeadingSequence),a(l)}function a(l){return l===m.numberSign&&r++<$.atxHeadingOpeningFenceSizeMax?(t.consume(l),a):l===m.eof||nt(l)?(t.exit(f.atxHeadingSequence),o(l)):n(l)}function o(l){return l===m.numberSign?(t.enter(f.atxHeadingSequence),c(l)):l===m.eof||Z(l)?(t.exit(f.atxHeading),e(l)):Ce(l)?ke(t,o,f.whitespace)(l):(t.enter(f.atxHeadingText),u(l))}function c(l){return l===m.numberSign?(t.consume(l),c):(t.exit(f.atxHeadingSequence),o(l))}function u(l){return l===m.eof||l===m.numberSign||nt(l)?(t.exit(f.atxHeadingText),o(l)):(t.consume(l),u)}}const td=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],gs=["pre","script","style","textarea"],nd={concrete:!0,name:"htmlFlow",resolveTo:sd,tokenize:ad},rd={partial:!0,tokenize:ld},id={partial:!0,tokenize:od};function sd(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type===f.htmlFlow););return e>1&&t[e-2][1].type===f.linePrefix&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function ad(t,e,n){const r=this;let i,s,a,o,c;return u;function u(C){return l(C)}function l(C){return T(C===m.lessThan,"expected `<`"),t.enter(f.htmlFlow),t.enter(f.htmlFlowData),t.consume(C),d}function d(C){return C===m.exclamationMark?(t.consume(C),g):C===m.slash?(t.consume(C),s=!0,S):C===m.questionMark?(t.consume(C),i=$.htmlInstruction,r.interrupt?e:y):wt(C)?(T(C!==null),t.consume(C),a=String.fromCharCode(C),N):n(C)}function g(C){return C===m.dash?(t.consume(C),i=$.htmlComment,p):C===m.leftSquareBracket?(t.consume(C),i=$.htmlCdata,o=0,x):wt(C)?(t.consume(C),i=$.htmlDeclaration,r.interrupt?e:y):n(C)}function p(C){return C===m.dash?(t.consume(C),r.interrupt?e:y):n(C)}function x(C){const ie=$.cdataOpeningString;return C===ie.charCodeAt(o++)?(t.consume(C),o===ie.length?r.interrupt?e:H:x):n(C)}function S(C){return wt(C)?(T(C!==null),t.consume(C),a=String.fromCharCode(C),N):n(C)}function N(C){if(C===m.eof||C===m.slash||C===m.greaterThan||nt(C)){const ie=C===m.slash,K=a.toLowerCase();return!ie&&!s&&gs.includes(K)?(i=$.htmlRaw,r.interrupt?e(C):H(C)):td.includes(a.toLowerCase())?(i=$.htmlBasic,ie?(t.consume(C),E):r.interrupt?e(C):H(C)):(i=$.htmlComplete,r.interrupt&&!r.parser.lazy[r.now().line]?n(C):s?v(C):M(C))}return C===m.dash||ot(C)?(t.consume(C),a+=String.fromCharCode(C),N):n(C)}function E(C){return C===m.greaterThan?(t.consume(C),r.interrupt?e:H):n(C)}function v(C){return Ce(C)?(t.consume(C),v):Y(C)}function M(C){return C===m.slash?(t.consume(C),Y):C===m.colon||C===m.underscore||wt(C)?(t.consume(C),O):Ce(C)?(t.consume(C),M):Y(C)}function O(C){return C===m.dash||C===m.dot||C===m.colon||C===m.underscore||ot(C)?(t.consume(C),O):P(C)}function P(C){return C===m.equalsTo?(t.consume(C),b):Ce(C)?(t.consume(C),P):M(C)}function b(C){return C===m.eof||C===m.lessThan||C===m.equalsTo||C===m.greaterThan||C===m.graveAccent?n(C):C===m.quotationMark||C===m.apostrophe?(t.consume(C),c=C,z):Ce(C)?(t.consume(C),b):U(C)}function z(C){return C===c?(t.consume(C),c=null,W):C===m.eof||Z(C)?n(C):(t.consume(C),z)}function U(C){return C===m.eof||C===m.quotationMark||C===m.apostrophe||C===m.slash||C===m.lessThan||C===m.equalsTo||C===m.greaterThan||C===m.graveAccent||nt(C)?P(C):(t.consume(C),U)}function W(C){return C===m.slash||C===m.greaterThan||Ce(C)?M(C):n(C)}function Y(C){return C===m.greaterThan?(t.consume(C),G):n(C)}function G(C){return C===m.eof||Z(C)?H(C):Ce(C)?(t.consume(C),G):n(C)}function H(C){return C===m.dash&&i===$.htmlComment?(t.consume(C),ee):C===m.lessThan&&i===$.htmlRaw?(t.consume(C),se):C===m.greaterThan&&i===$.htmlDeclaration?(t.consume(C),Q):C===m.questionMark&&i===$.htmlInstruction?(t.consume(C),y):C===m.rightSquareBracket&&i===$.htmlCdata?(t.consume(C),ge):Z(C)&&(i===$.htmlBasic||i===$.htmlComplete)?(t.exit(f.htmlFlowData),t.check(rd,B,_)(C)):C===m.eof||Z(C)?(t.exit(f.htmlFlowData),_(C)):(t.consume(C),H)}function _(C){return t.check(id,L,B)(C)}function L(C){return T(Z(C)),t.enter(f.lineEnding),t.consume(C),t.exit(f.lineEnding),F}function F(C){return C===m.eof||Z(C)?_(C):(t.enter(f.htmlFlowData),H(C))}function ee(C){return C===m.dash?(t.consume(C),y):H(C)}function se(C){return C===m.slash?(t.consume(C),a="",pe):H(C)}function pe(C){if(C===m.greaterThan){const ie=a.toLowerCase();return gs.includes(ie)?(t.consume(C),Q):H(C)}return wt(C)&&a.length<$.htmlRawSizeMax?(T(C!==null),t.consume(C),a+=String.fromCharCode(C),pe):H(C)}function ge(C){return C===m.rightSquareBracket?(t.consume(C),y):H(C)}function y(C){return C===m.greaterThan?(t.consume(C),Q):C===m.dash&&i===$.htmlComment?(t.consume(C),y):H(C)}function Q(C){return C===m.eof||Z(C)?(t.exit(f.htmlFlowData),B(C)):(t.consume(C),Q)}function B(C){return t.exit(f.htmlFlow),e(C)}}function od(t,e,n){const r=this;return i;function i(a){return Z(a)?(t.enter(f.lineEnding),t.consume(a),t.exit(f.lineEnding),s):n(a)}function s(a){return r.parser.lazy[r.now().line]?n(a):e(a)}}function ld(t,e,n){return r;function r(i){return T(Z(i),"expected a line ending"),t.enter(f.lineEnding),t.consume(i),t.exit(f.lineEnding),t.attempt(Qn,e,n)}}const cd={name:"htmlText",tokenize:ud};function ud(t,e,n){const r=this;let i,s,a;return o;function o(y){return T(y===m.lessThan,"expected `<`"),t.enter(f.htmlText),t.enter(f.htmlTextData),t.consume(y),c}function c(y){return y===m.exclamationMark?(t.consume(y),u):y===m.slash?(t.consume(y),P):y===m.questionMark?(t.consume(y),M):wt(y)?(t.consume(y),U):n(y)}function u(y){return y===m.dash?(t.consume(y),l):y===m.leftSquareBracket?(t.consume(y),s=0,x):wt(y)?(t.consume(y),v):n(y)}function l(y){return y===m.dash?(t.consume(y),p):n(y)}function d(y){return y===m.eof?n(y):y===m.dash?(t.consume(y),g):Z(y)?(a=d,se(y)):(t.consume(y),d)}function g(y){return y===m.dash?(t.consume(y),p):d(y)}function p(y){return y===m.greaterThan?ee(y):y===m.dash?g(y):d(y)}function x(y){const Q=$.cdataOpeningString;return y===Q.charCodeAt(s++)?(t.consume(y),s===Q.length?S:x):n(y)}function S(y){return y===m.eof?n(y):y===m.rightSquareBracket?(t.consume(y),N):Z(y)?(a=S,se(y)):(t.consume(y),S)}function N(y){return y===m.rightSquareBracket?(t.consume(y),E):S(y)}function E(y){return y===m.greaterThan?ee(y):y===m.rightSquareBracket?(t.consume(y),E):S(y)}function v(y){return y===m.eof||y===m.greaterThan?ee(y):Z(y)?(a=v,se(y)):(t.consume(y),v)}function M(y){return y===m.eof?n(y):y===m.questionMark?(t.consume(y),O):Z(y)?(a=M,se(y)):(t.consume(y),M)}function O(y){return y===m.greaterThan?ee(y):M(y)}function P(y){return wt(y)?(t.consume(y),b):n(y)}function b(y){return y===m.dash||ot(y)?(t.consume(y),b):z(y)}function z(y){return Z(y)?(a=z,se(y)):Ce(y)?(t.consume(y),z):ee(y)}function U(y){return y===m.dash||ot(y)?(t.consume(y),U):y===m.slash||y===m.greaterThan||nt(y)?W(y):n(y)}function W(y){return y===m.slash?(t.consume(y),ee):y===m.colon||y===m.underscore||wt(y)?(t.consume(y),Y):Z(y)?(a=W,se(y)):Ce(y)?(t.consume(y),W):ee(y)}function Y(y){return y===m.dash||y===m.dot||y===m.colon||y===m.underscore||ot(y)?(t.consume(y),Y):G(y)}function G(y){return y===m.equalsTo?(t.consume(y),H):Z(y)?(a=G,se(y)):Ce(y)?(t.consume(y),G):W(y)}function H(y){return y===m.eof||y===m.lessThan||y===m.equalsTo||y===m.greaterThan||y===m.graveAccent?n(y):y===m.quotationMark||y===m.apostrophe?(t.consume(y),i=y,_):Z(y)?(a=H,se(y)):Ce(y)?(t.consume(y),H):(t.consume(y),L)}function _(y){return y===i?(t.consume(y),i=void 0,F):y===m.eof?n(y):Z(y)?(a=_,se(y)):(t.consume(y),_)}function L(y){return y===m.eof||y===m.quotationMark||y===m.apostrophe||y===m.lessThan||y===m.equalsTo||y===m.graveAccent?n(y):y===m.slash||y===m.greaterThan||nt(y)?W(y):(t.consume(y),L)}function F(y){return y===m.slash||y===m.greaterThan||nt(y)?W(y):n(y)}function ee(y){return y===m.greaterThan?(t.consume(y),t.exit(f.htmlTextData),t.exit(f.htmlText),e):n(y)}function se(y){return T(a,"expected return state"),T(Z(y),"expected eol"),t.exit(f.htmlTextData),t.enter(f.lineEnding),t.consume(y),t.exit(f.lineEnding),pe}function pe(y){return T(r.parser.constructs.disable.null,"expected `disable.null` to be populated"),Ce(y)?ke(t,ge,f.linePrefix,r.parser.constructs.disable.null.includes("codeIndented")?void 0:$.tabSize)(y):ge(y)}function ge(y){return t.enter(f.htmlTextData),a(y)}}const ai={name:"labelEnd",resolveAll:fd,resolveTo:gd,tokenize:md},hd={tokenize:Cd},dd={tokenize:xd},pd={tokenize:yd};function fd(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type===f.labelImage||r.type===f.labelLink||r.type===f.labelEnd){const i=r.type===f.labelImage?4:2;r.type=f.data,e+=i}}return t.length!==n.length&&Tt(t,0,t.length,n),t}function gd(t,e){let n=t.length,r=0,i,s,a,o;for(;n--;)if(i=t[n][1],s){if(i.type===f.link||i.type===f.labelLink&&i._inactive)break;t[n][0]==="enter"&&i.type===f.labelLink&&(i._inactive=!0)}else if(a){if(t[n][0]==="enter"&&(i.type===f.labelImage||i.type===f.labelLink)&&!i._balanced&&(s=n,i.type!==f.labelLink)){r=2;break}}else i.type===f.labelEnd&&(a=n);T(s!==void 0,"`open` is supposed to be found"),T(a!==void 0,"`close` is supposed to be found");const c={type:t[s][1].type===f.labelLink?f.link:f.image,start:{...t[s][1].start},end:{...t[t.length-1][1].end}},u={type:f.label,start:{...t[s][1].start},end:{...t[a][1].end}},l={type:f.labelText,start:{...t[s+r+2][1].end},end:{...t[a-2][1].start}};return o=[["enter",c,e],["enter",u,e]],o=ct(o,t.slice(s+1,s+r+3)),o=ct(o,[["enter",l,e]]),T(e.parser.constructs.insideSpan.null,"expected `insideSpan.null` to be populated"),o=ct(o,si(e.parser.constructs.insideSpan.null,t.slice(s+r+4,a-3),e)),o=ct(o,[["exit",l,e],t[a-2],t[a-1],["exit",u,e]]),o=ct(o,t.slice(a+1)),o=ct(o,[["exit",c,e]]),Tt(t,s,t.length,o),t}function md(t,e,n){const r=this;let i=r.events.length,s,a;for(;i--;)if((r.events[i][1].type===f.labelImage||r.events[i][1].type===f.labelLink)&&!r.events[i][1]._balanced){s=r.events[i][1];break}return o;function o(g){return T(g===m.rightSquareBracket,"expected `]`"),s?s._inactive?d(g):(a=r.parser.defined.includes(Xt(r.sliceSerialize({start:s.end,end:r.now()}))),t.enter(f.labelEnd),t.enter(f.labelMarker),t.consume(g),t.exit(f.labelMarker),t.exit(f.labelEnd),c):n(g)}function c(g){return g===m.leftParenthesis?t.attempt(hd,l,a?l:d)(g):g===m.leftSquareBracket?t.attempt(dd,l,a?u:d)(g):a?l(g):d(g)}function u(g){return t.attempt(pd,l,d)(g)}function l(g){return e(g)}function d(g){return s._balanced=!0,n(g)}}function Cd(t,e,n){return r;function r(d){return T(d===m.leftParenthesis,"expected left paren"),t.enter(f.resource),t.enter(f.resourceMarker),t.consume(d),t.exit(f.resourceMarker),i}function i(d){return nt(d)?Cn(t,s)(d):s(d)}function s(d){return d===m.rightParenthesis?l(d):Ha(t,a,o,f.resourceDestination,f.resourceDestinationLiteral,f.resourceDestinationLiteralMarker,f.resourceDestinationRaw,f.resourceDestinationString,$.linkResourceDestinationBalanceMax)(d)}function a(d){return nt(d)?Cn(t,c)(d):l(d)}function o(d){return n(d)}function c(d){return d===m.quotationMark||d===m.apostrophe||d===m.leftParenthesis?Ua(t,u,n,f.resourceTitle,f.resourceTitleMarker,f.resourceTitleString)(d):l(d)}function u(d){return nt(d)?Cn(t,l)(d):l(d)}function l(d){return d===m.rightParenthesis?(t.enter(f.resourceMarker),t.consume(d),t.exit(f.resourceMarker),t.exit(f.resource),e):n(d)}}function xd(t,e,n){const r=this;return i;function i(o){return T(o===m.leftSquareBracket,"expected left bracket"),za.call(r,t,s,a,f.reference,f.referenceMarker,f.referenceString)(o)}function s(o){return r.parser.defined.includes(Xt(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(o):n(o)}function a(o){return n(o)}}function yd(t,e,n){return r;function r(s){return T(s===m.leftSquareBracket,"expected left bracket"),t.enter(f.reference),t.enter(f.referenceMarker),t.consume(s),t.exit(f.referenceMarker),i}function i(s){return s===m.rightSquareBracket?(t.enter(f.referenceMarker),t.consume(s),t.exit(f.referenceMarker),t.exit(f.reference),e):n(s)}}const Sd={name:"labelStartImage",resolveAll:ai.resolveAll,tokenize:wd};function wd(t,e,n){const r=this;return i;function i(o){return T(o===m.exclamationMark,"expected `!`"),t.enter(f.labelImage),t.enter(f.labelImageMarker),t.consume(o),t.exit(f.labelImageMarker),s}function s(o){return o===m.leftSquareBracket?(t.enter(f.labelMarker),t.consume(o),t.exit(f.labelMarker),t.exit(f.labelImage),a):n(o)}function a(o){return o===m.caret&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const kd={name:"labelStartLink",resolveAll:ai.resolveAll,tokenize:Td};function Td(t,e,n){const r=this;return i;function i(a){return T(a===m.leftSquareBracket,"expected `[`"),t.enter(f.labelLink),t.enter(f.labelMarker),t.consume(a),t.exit(f.labelMarker),t.exit(f.labelLink),s}function s(a){return a===m.caret&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):e(a)}}const xr={name:"lineEnding",tokenize:Ed};function Ed(t,e){return n;function n(r){return T(Z(r),"expected eol"),t.enter(f.lineEnding),t.consume(r),t.exit(f.lineEnding),ke(t,e,f.linePrefix)}}const Un={name:"thematicBreak",tokenize:bd};function bd(t,e,n){let r=0,i;return s;function s(u){return t.enter(f.thematicBreak),a(u)}function a(u){return T(u===m.asterisk||u===m.dash||u===m.underscore,"expected `*`, `-`, or `_`"),i=u,o(u)}function o(u){return u===i?(t.enter(f.thematicBreakSequence),c(u)):r>=$.thematicBreakMarkerCountMin&&(u===m.eof||Z(u))?(t.exit(f.thematicBreak),e(u)):n(u)}function c(u){return u===i?(t.consume(u),r++,c):(t.exit(f.thematicBreakSequence),Ce(u)?ke(t,o,f.whitespace)(u):o(u))}}const et={continuation:{tokenize:Id},exit:Md,name:"list",tokenize:Rd},_d={partial:!0,tokenize:Ad},vd={partial:!0,tokenize:Nd};function Rd(t,e,n){const r=this,i=r.events[r.events.length-1];let s=i&&i[1].type===f.linePrefix?i[2].sliceSerialize(i[1],!0).length:0,a=0;return o;function o(p){T(r.containerState,"expected state");const x=r.containerState.type||(p===m.asterisk||p===m.plusSign||p===m.dash?f.listUnordered:f.listOrdered);if(x===f.listUnordered?!r.containerState.marker||p===r.containerState.marker:Br(p)){if(r.containerState.type||(r.containerState.type=x,t.enter(x,{_container:!0})),x===f.listUnordered)return t.enter(f.listItemPrefix),p===m.asterisk||p===m.dash?t.check(Un,n,u)(p):u(p);if(!r.interrupt||p===m.digit1)return t.enter(f.listItemPrefix),t.enter(f.listItemValue),c(p)}return n(p)}function c(p){return T(r.containerState,"expected state"),Br(p)&&++a<$.listItemValueSizeMax?(t.consume(p),c):(!r.interrupt||a<2)&&(r.containerState.marker?p===r.containerState.marker:p===m.rightParenthesis||p===m.dot)?(t.exit(f.listItemValue),u(p)):n(p)}function u(p){return T(r.containerState,"expected state"),T(p!==m.eof,"eof (`null`) is not a marker"),t.enter(f.listItemMarker),t.consume(p),t.exit(f.listItemMarker),r.containerState.marker=r.containerState.marker||p,t.check(Qn,r.interrupt?n:l,t.attempt(_d,g,d))}function l(p){return T(r.containerState,"expected state"),r.containerState.initialBlankLine=!0,s++,g(p)}function d(p){return Ce(p)?(t.enter(f.listItemPrefixWhitespace),t.consume(p),t.exit(f.listItemPrefixWhitespace),g):n(p)}function g(p){return T(r.containerState,"expected state"),r.containerState.size=s+r.sliceSerialize(t.exit(f.listItemPrefix),!0).length,e(p)}}function Id(t,e,n){const r=this;return T(r.containerState,"expected state"),r.containerState._closeFlow=void 0,t.check(Qn,i,s);function i(o){return T(r.containerState,"expected state"),T(typeof r.containerState.size=="number","expected size"),r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,ke(t,e,f.listItemIndent,r.containerState.size+1)(o)}function s(o){return T(r.containerState,"expected state"),r.containerState.furtherBlankLines||!Ce(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,a(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(vd,e,a)(o))}function a(o){return T(r.containerState,"expected state"),r.containerState._closeFlow=!0,r.interrupt=void 0,T(r.parser.constructs.disable.null,"expected `disable.null` to be populated"),ke(t,t.attempt(et,e,n),f.linePrefix,r.parser.constructs.disable.null.includes("codeIndented")?void 0:$.tabSize)(o)}}function Nd(t,e,n){const r=this;return T(r.containerState,"expected state"),T(typeof r.containerState.size=="number","expected size"),ke(t,i,f.listItemIndent,r.containerState.size+1);function i(s){T(r.containerState,"expected state");const a=r.events[r.events.length-1];return a&&a[1].type===f.listItemIndent&&a[2].sliceSerialize(a[1],!0).length===r.containerState.size?e(s):n(s)}}function Md(t){T(this.containerState,"expected state"),T(typeof this.containerState.type=="string","expected type"),t.exit(this.containerState.type)}function Ad(t,e,n){const r=this;return T(r.parser.constructs.disable.null,"expected `disable.null` to be populated"),ke(t,i,f.listItemPrefixWhitespace,r.parser.constructs.disable.null.includes("codeIndented")?void 0:$.tabSize+1);function i(s){const a=r.events[r.events.length-1];return!Ce(s)&&a&&a[1].type===f.listItemPrefixWhitespace?e(s):n(s)}}const ms={name:"setextUnderline",resolveTo:Od,tokenize:Ld};function Od(t,e){let n=t.length,r,i,s;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type===f.content){r=n;break}t[n][1].type===f.paragraph&&(i=n)}else t[n][1].type===f.content&&t.splice(n,1),!s&&t[n][1].type===f.definition&&(s=n);T(i!==void 0,"expected a `text` index to be found"),T(r!==void 0,"expected a `text` index to be found"),T(t[r][2]===e,"enter context should be same"),T(t[t.length-1][2]===e,"enter context should be same");const a={type:f.setextHeading,start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[i][1].type=f.setextHeadingText,s?(t.splice(i,0,["enter",a,e]),t.splice(s+1,0,["exit",t[r][1],e]),t[r][1].end={...t[s][1].end}):t[r][1]=a,t.push(["exit",a,e]),t}function Ld(t,e,n){const r=this;let i;return s;function s(u){let l=r.events.length,d;for(T(u===m.dash||u===m.equalsTo,"expected `=` or `-`");l--;)if(r.events[l][1].type!==f.lineEnding&&r.events[l][1].type!==f.linePrefix&&r.events[l][1].type!==f.content){d=r.events[l][1].type===f.paragraph;break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(t.enter(f.setextHeadingLine),i=u,a(u)):n(u)}function a(u){return t.enter(f.setextHeadingLineSequence),o(u)}function o(u){return u===i?(t.consume(u),o):(t.exit(f.setextHeadingLineSequence),Ce(u)?ke(t,c,f.lineSuffix)(u):c(u))}function c(u){return u===m.eof||Z(u)?(t.exit(f.setextHeadingLine),e(u)):n(u)}}const Pd={tokenize:Dd};function Dd(t){const e=this,n=t.attempt(Qn,r,t.attempt(this.parser.constructs.flowInitial,i,ke(t,t.attempt(this.parser.constructs.flow,i,t.attempt(Uh,i)),f.linePrefix)));return n;function r(s){if(T(s===m.eof||Z(s),"expected eol or eof"),s===m.eof){t.consume(s);return}return t.enter(f.lineEndingBlank),t.consume(s),t.exit(f.lineEndingBlank),e.currentConstruct=void 0,n}function i(s){if(T(s===m.eof||Z(s),"expected eol or eof"),s===m.eof){t.consume(s);return}return t.enter(f.lineEnding),t.consume(s),t.exit(f.lineEnding),e.currentConstruct=void 0,n}}const jd={resolveAll:$a()},Fd=Ba("string"),Hd=Ba("text");function Ba(t){return{resolveAll:$a(t==="text"?zd:void 0),tokenize:e};function e(n){const r=this,i=this.parser.constructs[t],s=n.attempt(i,a,o);return a;function a(l){return u(l)?s(l):o(l)}function o(l){if(l===m.eof){n.consume(l);return}return n.enter(f.data),n.consume(l),c}function c(l){return u(l)?(n.exit(f.data),s(l)):(n.consume(l),c)}function u(l){if(l===m.eof)return!0;const d=i[l];let g=-1;if(d)for(T(Array.isArray(d),"expected `disable.null` to be populated");++g<d.length;){const p=d[g];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function $a(t){return e;function e(n,r){let i=-1,s;for(;++i<=n.length;)s===void 0?n[i]&&n[i][1].type===f.data&&(s=i,i++):(!n[i]||n[i][1].type!==f.data)&&(i!==s+2&&(n[s][1].end=n[i-1][1].end,n.splice(s+2,i-s-2),i=s+2),s=void 0);return t?t(n,r):n}}function zd(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type===f.lineEnding)&&t[n-1][1].type===f.data){const r=t[n-1][1],i=e.sliceStream(r);let s=i.length,a=-1,o=0,c;for(;s--;){const u=i[s];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===m.space;)o++,a--;if(a)break;a=-1}else if(u===m.horizontalTab)c=!0,o++;else if(u!==m.virtualSpace){s++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(o=0),o){const u={type:n===t.length||c||o<$.hardBreakPrefixSizeMin?f.lineSuffix:f.hardBreakTrailing,start:{_bufferIndex:s?a:r.start._bufferIndex+a,_index:r.start._index+s,line:r.end.line,column:r.end.column-o,offset:r.end.offset-o},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const Ud={[m.asterisk]:et,[m.plusSign]:et,[m.dash]:et,[m.digit0]:et,[m.digit1]:et,[m.digit2]:et,[m.digit3]:et,[m.digit4]:et,[m.digit5]:et,[m.digit6]:et,[m.digit7]:et,[m.digit8]:et,[m.digit9]:et,[m.greaterThan]:La},Bd={[m.leftSquareBracket]:Gh},$d={[m.horizontalTab]:Cr,[m.virtualSpace]:Cr,[m.space]:Cr},Vd={[m.numberSign]:Jh,[m.asterisk]:Un,[m.dash]:[ms,Un],[m.lessThan]:nd,[m.equalsTo]:ms,[m.underscore]:Un,[m.graveAccent]:fs,[m.tilde]:fs},Wd={[m.ampersand]:Da,[m.backslash]:Pa},Gd={[m.carriageReturn]:xr,[m.lineFeed]:xr,[m.carriageReturnLineFeed]:xr,[m.exclamationMark]:Sd,[m.ampersand]:Da,[m.asterisk]:$r,[m.lessThan]:[Th,cd],[m.leftSquareBracket]:kd,[m.backslash]:[Yh,Pa],[m.rightSquareBracket]:ai,[m.underscore]:$r,[m.graveAccent]:Dh},qd={null:[$r,jd]},Kd={null:[m.asterisk,m.underscore]},Zd={null:[]},Yd=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Kd,contentInitial:Bd,disable:Zd,document:Ud,flow:Vd,flowInitial:$d,insideSpan:qd,string:Wd,text:Gd},Symbol.toStringTag,{value:"Module"}));var Vr={exports:{}},yr,Cs;function Xd(){if(Cs)return yr;Cs=1;var t=1e3,e=t*60,n=e*60,r=n*24,i=r*7,s=r*365.25;yr=function(l,d){d=d||{};var g=typeof l;if(g==="string"&&l.length>0)return a(l);if(g==="number"&&isFinite(l))return d.long?c(l):o(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function a(l){if(l=String(l),!(l.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(d){var g=parseFloat(d[1]),p=(d[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return g*s;case"weeks":case"week":case"w":return g*i;case"days":case"day":case"d":return g*r;case"hours":case"hour":case"hrs":case"hr":case"h":return g*n;case"minutes":case"minute":case"mins":case"min":case"m":return g*e;case"seconds":case"second":case"secs":case"sec":case"s":return g*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return g;default:return}}}}function o(l){var d=Math.abs(l);return d>=r?Math.round(l/r)+"d":d>=n?Math.round(l/n)+"h":d>=e?Math.round(l/e)+"m":d>=t?Math.round(l/t)+"s":l+"ms"}function c(l){var d=Math.abs(l);return d>=r?u(l,d,r,"day"):d>=n?u(l,d,n,"hour"):d>=e?u(l,d,e,"minute"):d>=t?u(l,d,t,"second"):l+" ms"}function u(l,d,g,p){var x=d>=g*1.5;return Math.round(l/g)+" "+p+(x?"s":"")}return yr}function Jd(t){n.debug=n,n.default=n,n.coerce=c,n.disable=a,n.enable=i,n.enabled=o,n.humanize=Xd(),n.destroy=u,Object.keys(t).forEach(l=>{n[l]=t[l]}),n.names=[],n.skips=[],n.formatters={};function e(l){let d=0;for(let g=0;g<l.length;g++)d=(d<<5)-d+l.charCodeAt(g),d|=0;return n.colors[Math.abs(d)%n.colors.length]}n.selectColor=e;function n(l){let d,g=null,p,x;function S(...N){if(!S.enabled)return;const E=S,v=Number(new Date),M=v-(d||v);E.diff=M,E.prev=d,E.curr=v,d=v,N[0]=n.coerce(N[0]),typeof N[0]!="string"&&N.unshift("%O");let O=0;N[0]=N[0].replace(/%([a-zA-Z%])/g,(b,z)=>{if(b==="%%")return"%";O++;const U=n.formatters[z];if(typeof U=="function"){const W=N[O];b=U.call(E,W),N.splice(O,1),O--}return b}),n.formatArgs.call(E,N),(E.log||n.log).apply(E,N)}return S.namespace=l,S.useColors=n.useColors(),S.color=n.selectColor(l),S.extend=r,S.destroy=n.destroy,Object.defineProperty(S,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(p!==n.namespaces&&(p=n.namespaces,x=n.enabled(l)),x),set:N=>{g=N}}),typeof n.init=="function"&&n.init(S),S}function r(l,d){const g=n(this.namespace+(typeof d>"u"?":":d)+l);return g.log=this.log,g}function i(l){n.save(l),n.namespaces=l,n.names=[],n.skips=[];const d=(typeof l=="string"?l:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const g of d)g[0]==="-"?n.skips.push(g.slice(1)):n.names.push(g)}function s(l,d){let g=0,p=0,x=-1,S=0;for(;g<l.length;)if(p<d.length&&(d[p]===l[g]||d[p]==="*"))d[p]==="*"?(x=p,S=g,p++):(g++,p++);else if(x!==-1)p=x+1,S++,g=S;else return!1;for(;p<d.length&&d[p]==="*";)p++;return p===d.length}function a(){const l=[...n.names,...n.skips.map(d=>"-"+d)].join(",");return n.enable(""),l}function o(l){for(const d of n.skips)if(s(l,d))return!1;for(const d of n.names)if(s(l,d))return!0;return!1}function c(l){return l instanceof Error?l.stack||l.message:l}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}var Qd=Jd;(function(t,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=n,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function n(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let l=0,d=0;c[0].replace(/%[a-zA-Z%]/g,g=>{g!=="%%"&&(l++,g==="%c"&&(d=l))}),c.splice(d,0,u)}e.log=console.debug||console.log||(()=>{});function i(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function s(){let c;try{c=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function a(){try{return localStorage}catch{}}t.exports=Qd(e);const{formatters:o}=t.exports;o.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Vr,Vr.exports);var e1=Vr.exports;const t1=Zr(e1),zt=t1("micromark");function n1(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const i={},s=[];let a=[],o=[],c=!0;const u={attempt:W(z),check:W(U),consume:O,enter:P,exit:b,interrupt:W(U,{interrupt:!0})},l={code:m.eof,containerState:{},defineSkip:E,events:[],now:N,parser:t,previous:m.eof,sliceSerialize:x,sliceStream:S,write:p};let d=e.tokenize.call(l,u),g;return e.resolveAll&&s.push(e),l;function p(_){return a=ct(a,_),v(),a[a.length-1]!==m.eof?[]:(Y(e,0),l.events=si(s,l.events,l),l.events)}function x(_,L){return i1(S(_),L)}function S(_){return r1(a,_)}function N(){const{_bufferIndex:_,_index:L,line:F,column:ee,offset:se}=r;return{_bufferIndex:_,_index:L,line:F,column:ee,offset:se}}function E(_){i[_.line]=_.column,H(),zt("position: define skip: `%j`",r)}function v(){let _;for(;r._index<a.length;){const L=a[r._index];if(typeof L=="string")for(_=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===_&&r._bufferIndex<L.length;)M(L.charCodeAt(r._bufferIndex));else M(L)}}function M(_){T(c===!0,"expected character to be consumed"),c=void 0,zt("main: passing `%s` to %s",_,d&&d.name),g=_,T(typeof d=="function","expected state"),d=d(_)}function O(_){T(_===g,"expected given code to equal expected code"),zt("consume: `%s`",_),T(c===void 0,"expected code to not have been consumed: this might be because `return x(code)` instead of `return x` was used"),T(_===null?l.events.length===0||l.events[l.events.length-1][0]==="exit":l.events[l.events.length-1][0]==="enter","expected last token to be open"),Z(_)?(r.line++,r.column=1,r.offset+=_===m.carriageReturnLineFeed?2:1,H(),zt("position: after eol: `%j`",r)):_!==m.virtualSpace&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===a[r._index].length&&(r._bufferIndex=-1,r._index++)),l.previous=_,c=!0}function P(_,L){const F=L||{};return F.type=_,F.start=N(),T(typeof _=="string","expected string type"),T(_.length>0,"expected non-empty string"),zt("enter: `%s`",_),l.events.push(["enter",F,l]),o.push(F),F}function b(_){T(typeof _=="string","expected string type"),T(_.length>0,"expected non-empty string");const L=o.pop();return T(L,"cannot close w/o open tokens"),L.end=N(),T(_===L.type,"expected exit token to match current token"),T(!(L.start._index===L.end._index&&L.start._bufferIndex===L.end._bufferIndex),"expected non-empty token (`"+_+"`)"),zt("exit: `%s`",L.type),l.events.push(["exit",L,l]),L}function z(_,L){Y(_,L.from)}function U(_,L){L.restore()}function W(_,L){return F;function F(ee,se,pe){let ge,y,Q,B;return Array.isArray(ee)?ie(ee):"tokenize"in ee?ie([ee]):C(ee);function C(te){return xe;function xe(de){const _e=de!==null&&te[de],Te=de!==null&&te.null,Oe=[...Array.isArray(_e)?_e:_e?[_e]:[],...Array.isArray(Te)?Te:Te?[Te]:[]];return ie(Oe)(de)}}function ie(te){return ge=te,y=0,te.length===0?(T(pe,"expected `bogusState` to be given"),pe):K(te[y])}function K(te){return xe;function xe(de){return B=G(),Q=te,te.partial||(l.currentConstruct=te),T(l.parser.constructs.disable.null,"expected `disable.null` to be populated"),te.name&&l.parser.constructs.disable.null.includes(te.name)?ne(de):te.tokenize.call(L?Object.assign(Object.create(l),L):l,u,oe,ne)(de)}}function oe(te){return T(te===g,"expected code"),c=!0,_(Q,B),se}function ne(te){return T(te===g,"expected code"),c=!0,B.restore(),++y<ge.length?K(ge[y]):pe}}}function Y(_,L){_.resolveAll&&!s.includes(_)&&s.push(_),_.resolve&&Tt(l.events,L,l.events.length-L,_.resolve(l.events.slice(L),l)),_.resolveTo&&(l.events=_.resolveTo(l.events,l)),T(_.partial||l.events.length===0||l.events[l.events.length-1][0]==="exit","expected last token to end")}function G(){const _=N(),L=l.previous,F=l.currentConstruct,ee=l.events.length,se=Array.from(o);return{from:ee,restore:pe};function pe(){r=_,l.previous=L,l.currentConstruct=F,l.events.length=ee,o=se,H(),zt("position: restore: `%j`",r)}}function H(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function r1(t,e){const n=e.start._index,r=e.start._bufferIndex,i=e.end._index,s=e.end._bufferIndex;let a;if(n===i)T(s>-1,"expected non-negative end buffer index"),T(r>-1,"expected non-negative start buffer index"),a=[t[n].slice(r,s)];else{if(a=t.slice(n,i),r>-1){const o=a[0];typeof o=="string"?a[0]=o.slice(r):(T(r===0,"expected `startBufferIndex` to be `0`"),a.shift())}s>0&&a.push(t[i].slice(0,s))}return a}function i1(t,e){let n=-1;const r=[];let i;for(;++n<t.length;){const s=t[n];let a;if(typeof s=="string")a=s;else switch(s){case m.carriageReturn:{a=yt.cr;break}case m.lineFeed:{a=yt.lf;break}case m.carriageReturnLineFeed:{a=yt.cr+yt.lf;break}case m.horizontalTab:{a=e?yt.space:yt.ht;break}case m.virtualSpace:{if(!e&&i)continue;a=yt.space;break}default:T(typeof s=="number","expected number"),a=String.fromCharCode(s)}i=s===m.horizontalTab,r.push(a)}return r.join("")}function s1(t){const r={constructs:lh([Yd,...(t||{}).extensions||[]]),content:i(mh),defined:[],document:i(xh),flow:i(Pd),lazy:{},string:i(Fd),text:i(Hd)};return r;function i(s){return a;function a(o){return n1(r,s,o)}}}function a1(t){for(;!Fa(t););return t}const xs=/[\0\t\n\r]/g;function o1(){let t=1,e="",n=!0,r;return i;function i(s,a,o){const c=[];let u,l,d,g,p;for(s=e+(typeof s=="string"?s.toString():new TextDecoder(a||void 0).decode(s)),d=0,e="",n&&(s.charCodeAt(0)===m.byteOrderMarker&&d++,n=void 0);d<s.length;){if(xs.lastIndex=d,u=xs.exec(s),g=u&&u.index!==void 0?u.index:s.length,p=s.charCodeAt(g),!u){e=s.slice(d);break}if(p===m.lf&&d===g&&r)c.push(m.carriageReturnLineFeed),r=void 0;else switch(r&&(c.push(m.carriageReturn),r=void 0),d<g&&(c.push(s.slice(d,g)),t+=g-d),p){case m.nul:{c.push(m.replacementCharacter),t++;break}case m.ht:{for(l=Math.ceil(t/$.tabSize)*$.tabSize,c.push(m.horizontalTab);t++<l;)c.push(m.virtualSpace);break}case m.lf:{c.push(m.lineFeed),t=1;break}default:r=!0,t=1}d=g+1}return o&&(r&&c.push(m.carriageReturn),e&&c.push(e),c.push(m.eof)),c}}const l1=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function c1(t){return t.replace(l1,u1)}function u1(t,e,n){if(e)return e;if(n.charCodeAt(0)===m.numberSign){const i=n.charCodeAt(1),s=i===m.lowercaseX||i===m.uppercaseX;return Oa(n.slice(s?2:1),s?$.numericBaseHexadecimal:$.numericBaseDecimal)}return ii(n)||t}const Va={}.hasOwnProperty;function h1(t,e,n){return typeof e!="string"&&(n=e,e=void 0),d1(n)(a1(s1(n).document().write(o1()(t,e,!0))))}function d1(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(_t),autolinkProtocol:W,autolinkEmail:W,atxHeading:s(st),blockQuote:s(de),characterEscape:W,characterReference:W,codeFenced:s(_e),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:s(_e,a),codeText:s(Te,a),codeTextData:W,data:W,codeFlowValue:W,definition:s(Oe),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:s(it),hardBreakEscape:s(Et),hardBreakTrailing:s(Et),htmlFlow:s(bt,a),htmlFlowData:W,htmlText:s(bt,a),htmlTextData:W,image:s(gt),label:a,link:s(_t),listItem:s(jt),listItemValue:g,listOrdered:s(mt,d),listUnordered:s(mt),paragraph:s(Ft),reference:C,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:s(st),strong:s(Ht),thematicBreak:s(dt)},exit:{atxHeading:c(),atxHeadingSequence:P,autolink:c(),autolinkEmail:xe,autolinkProtocol:te,blockQuote:c(),characterEscapeValue:Y,characterReferenceMarkerHexadecimal:K,characterReferenceMarkerNumeric:K,characterReferenceValue:oe,characterReference:ne,codeFenced:c(N),codeFencedFence:S,codeFencedFenceInfo:p,codeFencedFenceMeta:x,codeFlowValue:Y,codeIndented:c(E),codeText:c(F),codeTextData:Y,data:Y,definition:c(),definitionDestinationString:O,definitionLabelString:v,definitionTitleString:M,emphasis:c(),hardBreakEscape:c(H),hardBreakTrailing:c(H),htmlFlow:c(_),htmlFlowData:Y,htmlText:c(L),htmlTextData:Y,image:c(se),label:ge,labelText:pe,lineEnding:G,link:c(ee),listItem:c(),listOrdered:c(),listUnordered:c(),paragraph:c(),referenceString:ie,resourceDestinationString:y,resourceTitleString:Q,resource:B,setextHeading:c(U),setextHeadingLineSequence:z,setextHeadingText:b,strong:c(),thematicBreak:c()}};Wa(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(R){let I={type:"root",children:[]};const V={stack:[I],tokenStack:[],config:e,enter:o,exit:u,buffer:a,resume:l,data:n},J=[];let he=-1;for(;++he<R.length;)if(R[he][1].type===f.listOrdered||R[he][1].type===f.listUnordered)if(R[he][0]==="enter")J.push(he);else{const ve=J.pop();T(typeof ve=="number","expected list ot be open"),he=i(R,ve,he)}for(he=-1;++he<R.length;){const ve=e[R[he][0]];Va.call(ve,R[he][1].type)&&ve[R[he][1].type].call(Object.assign({sliceSerialize:R[he][2].sliceSerialize},V),R[he][1])}if(V.tokenStack.length>0){const ve=V.tokenStack[V.tokenStack.length-1];(ve[1]||ys).call(V,void 0,ve[0])}for(I.position={start:Lt(R.length>0?R[0][1].start:{line:1,column:1,offset:0}),end:Lt(R.length>0?R[R.length-2][1].end:{line:1,column:1,offset:0})},he=-1;++he<e.transforms.length;)I=e.transforms[he](I)||I;return I}function i(R,I,V){let J=I-1,he=-1,ve=!1,De,je,Je,Fe;for(;++J<=V;){const ye=R[J];switch(ye[1].type){case f.listUnordered:case f.listOrdered:case f.blockQuote:{ye[0]==="enter"?he++:he--,Fe=void 0;break}case f.lineEndingBlank:{ye[0]==="enter"&&(De&&!Fe&&!he&&!Je&&(Je=J),Fe=void 0);break}case f.linePrefix:case f.listItemValue:case f.listItemMarker:case f.listItemPrefix:case f.listItemPrefixWhitespace:break;default:Fe=void 0}if(!he&&ye[0]==="enter"&&ye[1].type===f.listItemPrefix||he===-1&&ye[0]==="exit"&&(ye[1].type===f.listUnordered||ye[1].type===f.listOrdered)){if(De){let Ge=J;for(je=void 0;Ge--;){const He=R[Ge];if(He[1].type===f.lineEnding||He[1].type===f.lineEndingBlank){if(He[0]==="exit")continue;je&&(R[je][1].type=f.lineEndingBlank,ve=!0),He[1].type=f.lineEnding,je=Ge}else if(!(He[1].type===f.linePrefix||He[1].type===f.blockQuotePrefix||He[1].type===f.blockQuotePrefixWhitespace||He[1].type===f.blockQuoteMarker||He[1].type===f.listItemIndent))break}Je&&(!je||Je<je)&&(De._spread=!0),De.end=Object.assign({},je?R[je][1].start:ye[1].end),R.splice(je||J,0,["exit",De,ye[2]]),J++,V++}if(ye[1].type===f.listItemPrefix){const Ge={type:"listItem",_spread:!1,start:Object.assign({},ye[1].start),end:void 0};De=Ge,R.splice(J,0,["enter",Ge,ye[2]]),J++,V++,Je=void 0,Fe=!0}}}return R[I][1]._spread=ve,V}function s(R,I){return V;function V(J){o.call(this,R(J),J),I&&I.call(this,J)}}function a(){this.stack.push({type:"fragment",children:[]})}function o(R,I,V){const J=this.stack[this.stack.length-1];T(J,"expected `parent`"),T("children"in J,"expected `parent`"),J.children.push(R),this.stack.push(R),this.tokenStack.push([I,V||void 0]),R.position={start:Lt(I.start),end:void 0}}function c(R){return I;function I(V){R&&R.call(this,V),u.call(this,V)}}function u(R,I){const V=this.stack.pop();T(V,"expected `node`");const J=this.tokenStack.pop();if(J)J[0].type!==R.type&&(I?I.call(this,R,J[0]):(J[1]||ys).call(this,R,J[0]));else throw new Error("Cannot close `"+R.type+"` ("+mn({start:R.start,end:R.end})+"): itâ€™s not open");T(V.type!=="fragment","unexpected fragment `exit`ed"),T(V.position,"expected `position` to be defined"),V.position.end=Lt(R.end)}function l(){return ah(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function g(R){if(this.data.expectingFirstListItemValue){const I=this.stack[this.stack.length-2];T(I,"expected nodes on stack"),T(I.type==="list","expected list on stack"),I.start=Number.parseInt(this.sliceSerialize(R),$.numericBaseDecimal),this.data.expectingFirstListItemValue=void 0}}function p(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="code","expected code on stack"),I.lang=R}function x(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="code","expected code on stack"),I.meta=R}function S(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function N(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="code","expected code on stack"),I.value=R.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function E(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="code","expected code on stack"),I.value=R.replace(/(\r?\n|\r)$/g,"")}function v(R){const I=this.resume(),V=this.stack[this.stack.length-1];T(V,"expected node on stack"),T(V.type==="definition","expected definition on stack"),V.label=I,V.identifier=Xt(this.sliceSerialize(R)).toLowerCase()}function M(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="definition","expected definition on stack"),I.title=R}function O(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="definition","expected definition on stack"),I.url=R}function P(R){const I=this.stack[this.stack.length-1];if(T(I,"expected node on stack"),T(I.type==="heading","expected heading on stack"),!I.depth){const V=this.sliceSerialize(R).length;T(V===1||V===2||V===3||V===4||V===5||V===6,"expected `depth` between `1` and `6`"),I.depth=V}}function b(){this.data.setextHeadingSlurpLineEnding=!0}function z(R){const I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="heading","expected heading on stack"),I.depth=this.sliceSerialize(R).codePointAt(0)===m.equalsTo?1:2}function U(){this.data.setextHeadingSlurpLineEnding=void 0}function W(R){const I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T("children"in I,"expected parent on stack");const V=I.children;let J=V[V.length-1];(!J||J.type!=="text")&&(J=ht(),J.position={start:Lt(R.start),end:void 0},V.push(J)),this.stack.push(J)}function Y(R){const I=this.stack.pop();T(I,"expected a `node` to be on the stack"),T("value"in I,"expected a `literal` to be on the stack"),T(I.position,"expected `node` to have an open position"),I.value+=this.sliceSerialize(R),I.position.end=Lt(R.end)}function G(R){const I=this.stack[this.stack.length-1];if(T(I,"expected `node`"),this.data.atHardBreak){T("children"in I,"expected `parent`");const V=I.children[I.children.length-1];T(V.position,"expected tail to have a starting position"),V.position.end=Lt(R.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(I.type)&&(W.call(this,R),Y.call(this,R))}function H(){this.data.atHardBreak=!0}function _(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="html","expected html on stack"),I.value=R}function L(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="html","expected html on stack"),I.value=R}function F(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="inlineCode","expected inline code on stack"),I.value=R}function ee(){const R=this.stack[this.stack.length-1];if(T(R,"expected node on stack"),T(R.type==="link","expected link on stack"),this.data.inReference){const I=this.data.referenceType||"shortcut";R.type+="Reference",R.referenceType=I,delete R.url,delete R.title}else delete R.identifier,delete R.label;this.data.referenceType=void 0}function se(){const R=this.stack[this.stack.length-1];if(T(R,"expected node on stack"),T(R.type==="image","expected image on stack"),this.data.inReference){const I=this.data.referenceType||"shortcut";R.type+="Reference",R.referenceType=I,delete R.url,delete R.title}else delete R.identifier,delete R.label;this.data.referenceType=void 0}function pe(R){const I=this.sliceSerialize(R),V=this.stack[this.stack.length-2];T(V,"expected ancestor on stack"),T(V.type==="image"||V.type==="link","expected image or link on stack"),V.label=c1(I),V.identifier=Xt(I).toLowerCase()}function ge(){const R=this.stack[this.stack.length-1];T(R,"expected node on stack"),T(R.type==="fragment","expected fragment on stack");const I=this.resume(),V=this.stack[this.stack.length-1];if(T(V,"expected node on stack"),T(V.type==="image"||V.type==="link","expected image or link on stack"),this.data.inReference=!0,V.type==="link"){const J=R.children;V.children=J}else V.alt=I}function y(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="image"||I.type==="link","expected image or link on stack"),I.url=R}function Q(){const R=this.resume(),I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="image"||I.type==="link","expected image or link on stack"),I.title=R}function B(){this.data.inReference=void 0}function C(){this.data.referenceType="collapsed"}function ie(R){const I=this.resume(),V=this.stack[this.stack.length-1];T(V,"expected node on stack"),T(V.type==="image"||V.type==="link","expected image reference or link reference on stack"),V.label=I,V.identifier=Xt(this.sliceSerialize(R)).toLowerCase(),this.data.referenceType="full"}function K(R){T(R.type==="characterReferenceMarkerNumeric"||R.type==="characterReferenceMarkerHexadecimal"),this.data.characterReferenceType=R.type}function oe(R){const I=this.sliceSerialize(R),V=this.data.characterReferenceType;let J;if(V)J=Oa(I,V===f.characterReferenceMarkerNumeric?$.numericBaseDecimal:$.numericBaseHexadecimal),this.data.characterReferenceType=void 0;else{const ve=ii(I);T(ve!==!1,"expected reference to decode"),J=ve}const he=this.stack[this.stack.length-1];T(he,"expected `node`"),T("value"in he,"expected `node.value`"),he.value+=J}function ne(R){const I=this.stack.pop();T(I,"expected `node`"),T(I.position,"expected `node.position`"),I.position.end=Lt(R.end)}function te(R){Y.call(this,R);const I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="link","expected link on stack"),I.url=this.sliceSerialize(R)}function xe(R){Y.call(this,R);const I=this.stack[this.stack.length-1];T(I,"expected node on stack"),T(I.type==="link","expected link on stack"),I.url="mailto:"+this.sliceSerialize(R)}function de(){return{type:"blockquote",children:[]}}function _e(){return{type:"code",lang:null,meta:null,value:""}}function Te(){return{type:"inlineCode",value:""}}function Oe(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function it(){return{type:"emphasis",children:[]}}function st(){return{type:"heading",depth:0,children:[]}}function Et(){return{type:"break"}}function bt(){return{type:"html",value:""}}function gt(){return{type:"image",title:null,url:"",alt:null}}function _t(){return{type:"link",title:null,url:"",children:[]}}function mt(R){return{type:"list",ordered:R.type==="listOrdered",start:null,spread:R._spread,children:[]}}function jt(R){return{type:"listItem",spread:R._spread,checked:null,children:[]}}function Ft(){return{type:"paragraph",children:[]}}function Ht(){return{type:"strong",children:[]}}function ht(){return{type:"text",value:""}}function dt(){return{type:"thematicBreak"}}}function Lt(t){return{line:t.line,column:t.column,offset:t.offset}}function Wa(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?Wa(t,r):p1(t,r)}}function p1(t,e){let n;for(n in e)if(Va.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function ys(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+mn({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+mn({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+mn({start:e.start,end:e.end})+") is still open")}function f1(t){const e=this;e.parser=n;function n(r){return h1(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function g1(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function m1(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function C1(t,e){const n=e.value?e.value+`
`:"",r={},i=e.lang?e.lang.split(/\s+/):[];i.length>0&&(r.className=["language-"+i[0]]);let s={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(s.data={meta:e.meta}),t.patch(e,s),s=t.applyData(e,s),s={type:"element",tagName:"pre",properties:{},children:[s]},t.patch(e,s),s}function x1(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function y1(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function S1(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),i=tn(r.toLowerCase()),s=t.footnoteOrder.indexOf(r);let a,o=t.footnoteCounts.get(r);o===void 0?(o=0,t.footnoteOrder.push(r),a=t.footnoteOrder.length):a=s+1,o+=1,t.footnoteCounts.set(r,o);const c={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+i,id:n+"fnref-"+i+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]};t.patch(e,c);const u={type:"element",tagName:"sup",properties:{},children:[c]};return t.patch(e,u),t.applyData(e,u)}function w1(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function k1(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function Ga(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const i=t.all(e),s=i[0];s&&s.type==="text"?s.value="["+s.value:i.unshift({type:"text",value:"["});const a=i[i.length-1];return a&&a.type==="text"?a.value+=r:i.push({type:"text",value:r}),i}function T1(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return Ga(t,e);const i={src:tn(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(i.title=r.title);const s={type:"element",tagName:"img",properties:i,children:[]};return t.patch(e,s),t.applyData(e,s)}function E1(t,e){const n={src:tn(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function b1(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function _1(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return Ga(t,e);const i={href:tn(r.url||"")};r.title!==null&&r.title!==void 0&&(i.title=r.title);const s={type:"element",tagName:"a",properties:i,children:t.all(e)};return t.patch(e,s),t.applyData(e,s)}function v1(t,e){const n={href:tn(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function R1(t,e,n){const r=t.all(e),i=n?I1(n):qa(e),s={},a=[];if(typeof e.checked=="boolean"){const l=r[0];let d;l&&l.type==="element"&&l.tagName==="p"?d=l:(d={type:"element",tagName:"p",properties:{},children:[]},r.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const l=r[o];(i||o!==0||l.type!=="element"||l.tagName!=="p")&&a.push({type:"text",value:`
`}),l.type==="element"&&l.tagName==="p"&&!i?a.push(...l.children):a.push(l)}const c=r[r.length-1];c&&(i||c.type!=="element"||c.tagName!=="p")&&a.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:s,children:a};return t.patch(e,u),t.applyData(e,u)}function I1(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=qa(n[r])}return e}function qa(t){const e=t.spread;return e??t.children.length>1}function N1(t,e){const n={},r=t.all(e);let i=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++i<r.length;){const a=r[i];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const s={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,s),t.applyData(e,s)}function M1(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function A1(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function O1(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function L1(t,e){const n=t.all(e),r=n.shift(),i=[];if(r){const a={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],a),i.push(a)}if(n.length>0){const a={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},o=ei(e.children[1]),c=_a(e.children[e.children.length-1]);o&&c&&(a.position={start:o,end:c}),i.push(a)}const s={type:"element",tagName:"table",properties:{},children:t.wrap(i,!0)};return t.patch(e,s),t.applyData(e,s)}function P1(t,e,n){const r=n?n.children:void 0,s=(r?r.indexOf(e):1)===0?"th":"td",a=n&&n.type==="table"?n.align:void 0,o=a?a.length:e.children.length;let c=-1;const u=[];for(;++c<o;){const d=e.children[c],g={},p=a?a[c]:void 0;p&&(g.align=p);let x={type:"element",tagName:s,properties:g,children:[]};d&&(x.children=t.all(d),t.patch(d,x),x=t.applyData(d,x)),u.push(x)}const l={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,l),t.applyData(e,l)}function D1(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const Ss=9,ws=32;function j1(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),i=0;const s=[];for(;r;)s.push(ks(e.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(e);return s.push(ks(e.slice(i),i>0,!1)),s.join("")}function ks(t,e,n){let r=0,i=t.length;if(e){let s=t.codePointAt(r);for(;s===Ss||s===ws;)r++,s=t.codePointAt(r)}if(n){let s=t.codePointAt(i-1);for(;s===Ss||s===ws;)i--,s=t.codePointAt(i-1)}return i>r?t.slice(r,i):""}function F1(t,e){const n={type:"text",value:j1(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function H1(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const z1={blockquote:g1,break:m1,code:C1,delete:x1,emphasis:y1,footnoteReference:S1,heading:w1,html:k1,imageReference:T1,image:E1,inlineCode:b1,linkReference:_1,link:v1,listItem:R1,list:N1,paragraph:M1,root:A1,strong:O1,table:L1,tableCell:D1,tableRow:P1,text:F1,thematicBreak:H1,toml:Dn,yaml:Dn,definition:Dn,footnoteDefinition:Dn};function Dn(){}const Ka=-1,er=0,xn=1,Zn=2,oi=3,li=4,ci=5,ui=6,Za=7,Ya=8,Ts=typeof self=="object"?self:globalThis,U1=(t,e)=>{const n=(i,s)=>(t.set(s,i),i),r=i=>{if(t.has(i))return t.get(i);const[s,a]=e[i];switch(s){case er:case Ka:return n(a,i);case xn:{const o=n([],i);for(const c of a)o.push(r(c));return o}case Zn:{const o=n({},i);for(const[c,u]of a)o[r(c)]=r(u);return o}case oi:return n(new Date(a),i);case li:{const{source:o,flags:c}=a;return n(new RegExp(o,c),i)}case ci:{const o=n(new Map,i);for(const[c,u]of a)o.set(r(c),r(u));return o}case ui:{const o=n(new Set,i);for(const c of a)o.add(r(c));return o}case Za:{const{name:o,message:c}=a;return n(new Ts[o](c),i)}case Ya:return n(BigInt(a),i);case"BigInt":return n(Object(BigInt(a)),i);case"ArrayBuffer":return n(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:o}=new Uint8Array(a);return n(new DataView(o),a)}}return n(new Ts[s](a),i)};return r},Es=t=>U1(new Map,t)(0),Kt="",{toString:B1}={},{keys:$1}=Object,pn=t=>{const e=typeof t;if(e!=="object"||!t)return[er,e];const n=B1.call(t).slice(8,-1);switch(n){case"Array":return[xn,Kt];case"Object":return[Zn,Kt];case"Date":return[oi,Kt];case"RegExp":return[li,Kt];case"Map":return[ci,Kt];case"Set":return[ui,Kt];case"DataView":return[xn,n]}return n.includes("Array")?[xn,n]:n.includes("Error")?[Za,n]:[Zn,n]},jn=([t,e])=>t===er&&(e==="function"||e==="symbol"),V1=(t,e,n,r)=>{const i=(a,o)=>{const c=r.push(a)-1;return n.set(o,c),c},s=a=>{if(n.has(a))return n.get(a);let[o,c]=pn(a);switch(o){case er:{let l=a;switch(c){case"bigint":o=Ya,l=a.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+c);l=null;break;case"undefined":return i([Ka],a)}return i([o,l],a)}case xn:{if(c){let g=a;return c==="DataView"?g=new Uint8Array(a.buffer):c==="ArrayBuffer"&&(g=new Uint8Array(a)),i([c,[...g]],a)}const l=[],d=i([o,l],a);for(const g of a)l.push(s(g));return d}case Zn:{if(c)switch(c){case"BigInt":return i([c,a.toString()],a);case"Boolean":case"Number":case"String":return i([c,a.valueOf()],a)}if(e&&"toJSON"in a)return s(a.toJSON());const l=[],d=i([o,l],a);for(const g of $1(a))(t||!jn(pn(a[g])))&&l.push([s(g),s(a[g])]);return d}case oi:return i([o,a.toISOString()],a);case li:{const{source:l,flags:d}=a;return i([o,{source:l,flags:d}],a)}case ci:{const l=[],d=i([o,l],a);for(const[g,p]of a)(t||!(jn(pn(g))||jn(pn(p))))&&l.push([s(g),s(p)]);return d}case ui:{const l=[],d=i([o,l],a);for(const g of a)(t||!jn(pn(g)))&&l.push(s(g));return d}}const{message:u}=a;return i([o,{name:c,message:u}],a)};return s},bs=(t,{json:e,lossy:n}={})=>{const r=[];return V1(!(e||n),!!e,new Map,r)(t),r},Yn=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?Es(bs(t,e)):structuredClone(t):(t,e)=>Es(bs(t,e));function W1(t,e){const n=[{type:"text",value:"â†©"}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function G1(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function q1(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||W1,r=t.options.footnoteBackLabel||G1,i=t.options.footnoteLabel||"Footnotes",s=t.options.footnoteLabelTagName||"h2",a=t.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let c=-1;for(;++c<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[c]);if(!u)continue;const l=t.all(u),d=String(u.identifier).toUpperCase(),g=tn(d.toLowerCase());let p=0;const x=[],S=t.footnoteCounts.get(d);for(;S!==void 0&&++p<=S;){x.length>0&&x.push({type:"text",value:" "});let v=typeof n=="string"?n:n(c,p);typeof v=="string"&&(v={type:"text",value:v}),x.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+g+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(c,p),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const N=l[l.length-1];if(N&&N.type==="element"&&N.tagName==="p"){const v=N.children[N.children.length-1];v&&v.type==="text"?v.value+=" ":N.children.push({type:"text",value:" "}),N.children.push(...x)}else l.push(...x);const E={type:"element",tagName:"li",properties:{id:e+"fn-"+g},children:t.wrap(l,!0)};t.patch(u,E),o.push(E)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...Yn(a),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(o,!0)},{type:"text",value:`
`}]}}const hi=function(t){if(t==null)return X1;if(typeof t=="function")return tr(t);if(typeof t=="object")return Array.isArray(t)?K1(t):Z1(t);if(typeof t=="string")return Y1(t);throw new Error("Expected function, string, or object as test")};function K1(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=hi(t[n]);return tr(r);function r(...i){let s=-1;for(;++s<e.length;)if(e[s].apply(this,i))return!0;return!1}}function Z1(t){const e=t;return tr(n);function n(r){const i=r;let s;for(s in t)if(i[s]!==e[s])return!1;return!0}}function Y1(t){return tr(e);function e(n){return n&&n.type===t}}function tr(t){return e;function e(n,r,i){return!!(J1(n)&&t.call(this,n,typeof r=="number"?r:void 0,i||void 0))}}function X1(){return!0}function J1(t){return t!==null&&typeof t=="object"&&"type"in t}const Xa=[],Q1=!0,_s=!1,ep="skip";function Ja(t,e,n,r){let i;typeof e=="function"&&typeof n!="function"?(r=n,n=e):i=e;const s=hi(i),a=r?-1:1;o(t,void 0,[])();function o(c,u,l){const d=c&&typeof c=="object"?c:{};if(typeof d.type=="string"){const p=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(g,"name",{value:"node ("+(c.type+(p?"<"+p+">":""))+")"})}return g;function g(){let p=Xa,x,S,N;if((!e||s(c,u,l[l.length-1]||void 0))&&(p=tp(n(c,l)),p[0]===_s))return p;if("children"in c&&c.children){const E=c;if(E.children&&p[0]!==ep)for(S=(r?E.children.length:-1)+a,N=l.concat(E);S>-1&&S<E.children.length;){const v=E.children[S];if(x=o(v,S,N)(),x[0]===_s)return x;S=typeof x[1]=="number"?x[1]:S+a}}return p}}}function tp(t){return Array.isArray(t)?t:typeof t=="number"?[Q1,t]:t==null?Xa:[t]}function Qa(t,e,n,r){let i,s,a;typeof e=="function"&&typeof n!="function"?(s=void 0,a=e,i=n):(s=e,a=n,i=r),Ja(t,s,o,i);function o(c,u){const l=u[u.length-1],d=l?l.children.indexOf(c):void 0;return a(c,d,l)}}const Wr={}.hasOwnProperty,np={};function rp(t,e){const n=e||np,r=new Map,i=new Map,s=new Map,a={...z1,...n.handlers},o={all:u,applyData:sp,definitionById:r,footnoteById:i,footnoteCounts:s,footnoteOrder:[],handlers:a,one:c,options:n,patch:ip,wrap:op};return Qa(t,function(l){if(l.type==="definition"||l.type==="footnoteDefinition"){const d=l.type==="definition"?r:i,g=String(l.identifier).toUpperCase();d.has(g)||d.set(g,l)}}),o;function c(l,d){const g=l.type,p=o.handlers[g];if(Wr.call(o.handlers,g)&&p)return p(o,l,d);if(o.options.passThrough&&o.options.passThrough.includes(g)){if("children"in l){const{children:S,...N}=l,E=Yn(N);return E.children=o.all(l),E}return Yn(l)}return(o.options.unknownHandler||ap)(o,l,d)}function u(l){const d=[];if("children"in l){const g=l.children;let p=-1;for(;++p<g.length;){const x=o.one(g[p],l);if(x){if(p&&g[p-1].type==="break"&&(!Array.isArray(x)&&x.type==="text"&&(x.value=vs(x.value)),!Array.isArray(x)&&x.type==="element")){const S=x.children[0];S&&S.type==="text"&&(S.value=vs(S.value))}Array.isArray(x)?d.push(...x):d.push(x)}}}return d}}function ip(t,e){t.position&&(e.position=Fu(t))}function sp(t,e){let n=e;if(t&&t.data){const r=t.data.hName,i=t.data.hChildren,s=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const a="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:a}}n.type==="element"&&s&&Object.assign(n.properties,Yn(s)),"children"in n&&n.children&&i!==null&&i!==void 0&&(n.children=i)}return n}function ap(t,e){const n=e.data||{},r="value"in e&&!(Wr.call(n,"hProperties")||Wr.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function op(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function vs(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function Rs(t,e){const n=rp(t,e),r=n.one(t,void 0),i=q1(n),s=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&(T("children"in s),s.children.push({type:"text",value:`
`},i)),s}function lp(t,e){return t&&"run"in t?async function(n,r){const i=Rs(n,{file:r,...e});await t.run(i,r)}:function(n,r){return Rs(n,{file:r,...t||e})}}function Is(t){if(t)throw t}var Bn=Object.prototype.hasOwnProperty,eo=Object.prototype.toString,Ns=Object.defineProperty,Ms=Object.getOwnPropertyDescriptor,As=function(e){return typeof Array.isArray=="function"?Array.isArray(e):eo.call(e)==="[object Array]"},Os=function(e){if(!e||eo.call(e)!=="[object Object]")return!1;var n=Bn.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Bn.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var i;for(i in e);return typeof i>"u"||Bn.call(e,i)},Ls=function(e,n){Ns&&n.name==="__proto__"?Ns(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},Ps=function(e,n){if(n==="__proto__")if(Bn.call(e,n)){if(Ms)return Ms(e,n).value}else return;return e[n]},cp=function t(){var e,n,r,i,s,a,o=arguments[0],c=1,u=arguments.length,l=!1;for(typeof o=="boolean"&&(l=o,o=arguments[1]||{},c=2),(o==null||typeof o!="object"&&typeof o!="function")&&(o={});c<u;++c)if(e=arguments[c],e!=null)for(n in e)r=Ps(o,n),i=Ps(e,n),o!==i&&(l&&i&&(Os(i)||(s=As(i)))?(s?(s=!1,a=r&&As(r)?r:[]):a=r&&Os(r)?r:{},Ls(o,{name:n,newValue:t(l,a,i)})):typeof i<"u"&&Ls(o,{name:n,newValue:i}));return o};const Sr=Zr(cp);function Gr(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function up(){const t=[],e={run:n,use:r};return e;function n(...i){let s=-1;const a=i.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);o(null,...i);function o(c,...u){const l=t[++s];let d=-1;if(c){a(c);return}for(;++d<i.length;)(u[d]===null||u[d]===void 0)&&(u[d]=i[d]);i=u,l?hp(l,o)(...u):a(null,...u)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return t.push(i),e}}function hp(t,e){let n;return r;function r(...a){const o=t.length>a.length;let c;o&&a.push(i);try{c=t.apply(this,a)}catch(u){const l=u;if(o&&n)throw l;return i(l)}o||(c&&c.then&&typeof c.then=="function"?c.then(s,i):c instanceof Error?i(c):s(c))}function i(a,...o){n||(n=!0,e(a,...o))}function s(a){i(null,a)}}const xt={basename:dp,dirname:pp,extname:fp,join:gp,sep:"/"};function dp(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Tn(t);let n=0,r=-1,i=t.length,s;if(e===void 0||e.length===0||e.length>t.length){for(;i--;)if(t.codePointAt(i)===47){if(s){n=i+1;break}}else r<0&&(s=!0,r=i+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let a=-1,o=e.length-1;for(;i--;)if(t.codePointAt(i)===47){if(s){n=i+1;break}}else a<0&&(s=!0,a=i+1),o>-1&&(t.codePointAt(i)===e.codePointAt(o--)?o<0&&(r=i):(o=-1,r=a));return n===r?r=a:r<0&&(r=t.length),t.slice(n,r)}function pp(t){if(Tn(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function fp(t){Tn(t);let e=t.length,n=-1,r=0,i=-1,s=0,a;for(;e--;){const o=t.codePointAt(e);if(o===47){if(a){r=e+1;break}continue}n<0&&(a=!0,n=e+1),o===46?i<0?i=e:s!==1&&(s=1):i>-1&&(s=-1)}return i<0||n<0||s===0||s===1&&i===n-1&&i===r+1?"":t.slice(i,n)}function gp(...t){let e=-1,n;for(;++e<t.length;)Tn(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":mp(n)}function mp(t){Tn(t);const e=t.codePointAt(0)===47;let n=Cp(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function Cp(t,e){let n="",r=0,i=-1,s=0,a=-1,o,c;for(;++a<=t.length;){if(a<t.length)o=t.codePointAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(c=n.lastIndexOf("/"),c!==n.length-1){c<0?(n="",r=0):(n=n.slice(0,c),r=n.length-1-n.lastIndexOf("/")),i=a,s=0;continue}}else if(n.length>0){n="",r=0,i=a,s=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(i+1,a):n=t.slice(i+1,a),r=a-i-1;i=a,s=0}else o===46&&s>-1?s++:s=-1}return n}function Tn(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const xp={cwd:yp};function yp(){return"/"}function qr(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function Sp(t){if(typeof t=="string")t=new URL(t);else if(!qr(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return wp(t)}function wp(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(e)}const wr=["history","path","basename","stem","extname","dirname"];class to{constructor(e){let n;e?qr(e)?n={path:e}:typeof e=="string"||kp(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":xp.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<wr.length;){const s=wr[r];s in n&&n[s]!==void 0&&n[s]!==null&&(this[s]=s==="history"?[...n[s]]:n[s])}let i;for(i in n)wr.includes(i)||(this[i]=n[i])}get basename(){return typeof this.path=="string"?xt.basename(this.path):void 0}set basename(e){Tr(e,"basename"),kr(e,"basename"),this.path=xt.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?xt.dirname(this.path):void 0}set dirname(e){Ds(this.basename,"dirname"),this.path=xt.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?xt.extname(this.path):void 0}set extname(e){if(kr(e,"extname"),Ds(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=xt.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){qr(e)&&(e=Sp(e)),Tr(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?xt.basename(this.path,this.extname):void 0}set stem(e){Tr(e,"stem"),kr(e,"stem"),this.path=xt.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const i=this.message(e,n,r);throw i.fatal=!0,i}info(e,n,r){const i=this.message(e,n,r);return i.fatal=void 0,i}message(e,n,r){const i=new We(e,n,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function kr(t,e){if(t&&t.includes(xt.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+xt.sep+"`")}function Tr(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function Ds(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function kp(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const Tp=function(t){const r=this.constructor.prototype,i=r[t],s=function(){return i.apply(s,arguments)};return Object.setPrototypeOf(s,r),s},Ep={}.hasOwnProperty;class di extends Tp{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=up()}copy(){const e=new di;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(Sr(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(_r("data",this.frozen),this.namespace[e]=n,this):Ep.call(this.namespace,e)&&this.namespace[e]||void 0:e?(_r("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=n.call(e,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Fn(e),r=this.parser||this.Parser;return Er("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),Er("process",this.parser||this.Parser),br("process",this.compiler||this.Compiler),n?i(void 0,n):new Promise(i);function i(s,a){const o=Fn(e),c=r.parse(o);r.run(c,o,function(l,d,g){if(l||!d||!g)return u(l);const p=d,x=r.stringify(p,g);vp(x)?g.value=x:g.result=x,u(l,g)});function u(l,d){l||!d?a(l):s?s(d):(T(n,"`done` is defined if `resolve` is not"),n(void 0,d))}}}processSync(e){let n=!1,r;return this.freeze(),Er("processSync",this.parser||this.Parser),br("processSync",this.compiler||this.Compiler),this.process(e,i),Fs("processSync","process",n),T(r,"we either bailed on an error or have a tree"),r;function i(s,a){n=!0,Is(s),r=a}}run(e,n,r){js(e),this.freeze();const i=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?s(void 0,r):new Promise(s);function s(a,o){T(typeof n!="function","`file` canâ€™t be a `done` anymore, we checked");const c=Fn(n);i.run(e,c,u);function u(l,d,g){const p=d||e;l?o(l):a?a(p):(T(r,"`done` is defined if `resolve` is not"),r(void 0,p,g))}}}runSync(e,n){let r=!1,i;return this.run(e,n,s),Fs("runSync","run",r),T(i,"we either bailed on an error or have a tree"),i;function s(a,o){Is(a),i=o,r=!0}}stringify(e,n){this.freeze();const r=Fn(n),i=this.compiler||this.Compiler;return br("stringify",i),js(e),i(e,r)}use(e,...n){const r=this.attachers,i=this.namespace;if(_r("use",this.frozen),e!=null)if(typeof e=="function")c(e,n);else if(typeof e=="object")Array.isArray(e)?o(e):a(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function s(u){if(typeof u=="function")c(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[l,...d]=u;c(l,d)}else a(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function a(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(u.plugins),u.settings&&(i.settings=Sr(!0,i.settings,u.settings))}function o(u){let l=-1;if(u!=null)if(Array.isArray(u))for(;++l<u.length;){const d=u[l];s(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function c(u,l){let d=-1,g=-1;for(;++d<r.length;)if(r[d][0]===u){g=d;break}if(g===-1)r.push([u,...l]);else if(l.length>0){let[p,...x]=l;const S=r[g][1];Gr(S)&&Gr(p)&&(p=Sr(!0,S,p)),r[g]=[u,p,...x]}}}}const bp=new di().freeze();function Er(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function br(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function _r(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function js(t){if(!Gr(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function Fs(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Fn(t){return _p(t)?t:new to(t)}function _p(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function vp(t){return typeof t=="string"||Rp(t)}function Rp(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const Ip="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Hs=[],zs={allowDangerousHtml:!0},Np=/^(https?|ircs?|mailto|xmpp)$/i,Mp=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function Us(t){const e=Ap(t),n=Op(t);return Lp(e.runSync(e.parse(n),n),t)}function Ap(t){const e=t.rehypePlugins||Hs,n=t.remarkPlugins||Hs,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...zs}:zs;return bp().use(f1).use(n).use(lp,r).use(e)}function Op(t){const e=t.children||"",n=new to;return typeof e=="string"?n.value=e:Pr("Unexpected value `"+e+"` for `children` prop, expected `string`"),n}function Lp(t,e){const n=e.allowedElements,r=e.allowElement,i=e.components,s=e.disallowedElements,a=e.skipHtml,o=e.unwrapDisallowed,c=e.urlTransform||Pp;for(const l of Mp)Object.hasOwn(e,l.from)&&Pr("Unexpected `"+l.from+"` prop, "+(l.to?"use `"+l.to+"` instead":"remove it")+" (see <"+Ip+"#"+l.id+"> for more info)");return n&&s&&Pr("Unexpected combined `allowedElements` and `disallowedElements`, expected one or the other"),Qa(t,u),$u(t,{Fragment:h.Fragment,components:i,ignoreInvalidStyle:!0,jsx:h.jsx,jsxs:h.jsxs,passKeys:!0,passNode:!0});function u(l,d,g){if(l.type==="raw"&&g&&typeof d=="number")return a?g.children.splice(d,1):g.children[d]={type:"text",value:l.value},d;if(l.type==="element"){let p;for(p in mr)if(Object.hasOwn(mr,p)&&Object.hasOwn(l.properties,p)){const x=l.properties[p],S=mr[p];(S===null||S.includes(l.tagName))&&(l.properties[p]=c(String(x||""),p,l))}}if(l.type==="element"){let p=n?!n.includes(l.tagName):s?s.includes(l.tagName):!1;if(!p&&r&&typeof d=="number"&&(p=!r(l,d,g)),p&&g&&typeof d=="number")return o&&l.children?g.children.splice(d,1,...l.children):g.children.splice(d,1),d}}}function Pp(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),i=t.indexOf("/");return e===-1||i!==-1&&e>i||n!==-1&&e>n||r!==-1&&e>r||Np.test(t.slice(0,e))?t:""}function Dp(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function jp(t,e,n){const i=hi({}.ignore||[]),s=Fp(e);let a=-1;for(;++a<s.length;)Ja(t,"text",o);function o(u,l){let d=-1,g;for(;++d<l.length;){const p=l[d],x=g?g.children:void 0;if(i(p,x?x.indexOf(p):void 0,g))return;g=p}if(g)return c(u,l)}function c(u,l){const d=l[l.length-1],g=s[a][0],p=s[a][1];let x=0;const N=d.children.indexOf(u);let E=!1,v=[];g.lastIndex=0;let M=g.exec(u.value);for(;M;){const O=M.index,P={index:M.index,input:M.input,stack:[...l,u]};let b=p(...M,P);if(typeof b=="string"&&(b=b.length>0?{type:"text",value:b}:void 0),b===!1?g.lastIndex=O+1:(x!==O&&v.push({type:"text",value:u.value.slice(x,O)}),Array.isArray(b)?v.push(...b):b&&v.push(b),x=O+M[0].length,E=!0),!g.global)break;M=g.exec(u.value)}return E?(x<u.value.length&&v.push({type:"text",value:u.value.slice(x)}),d.children.splice(N,1,...v)):v=[u],N+v.length}}function Fp(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let r=-1;for(;++r<n.length;){const i=n[r];e.push([Hp(i[0]),zp(i[1])])}return e}function Hp(t){return typeof t=="string"?new RegExp(Dp(t),"g"):t}function zp(t){return typeof t=="function"?t:function(){return t}}function Up(t){jp(t,[/\r?\n|\r/g,Bp])}function Bp(){return{type:"break"}}function Bs(){return function(t){Up(t)}}function no({children:t,isStreaming:e}){const[n,r]=k.useState(!0),[i,s]=k.useState(!1),[a,o]=k.useState("");k.useEffect(()=>{!e&&!i?(s(!0),r(!1)):e&&(s(!1),r(!0))},[e,i]);const c=()=>{e||r(!n)},u=k.Children.map(t,l=>{if(k.isValidElement(l)){if(l.type===pi){const d=l.props;return d.title&&d.title!==a&&o(d.title),k.cloneElement(l,{onToggle:c,isExpanded:n})}if(l.type===fi)return k.cloneElement(l,{isVisible:n,title:a})}return l});return h.jsx("div",{className:"chat-wrapper__reasoning",children:u})}function pi({title:t,status:e="processing",duration:n,onToggle:r,isExpanded:i=!0}){const{t:s}=Mt(),a=()=>h.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_64_36210",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"16",children:h.jsx("rect",{width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_64_36210)",children:h.jsx("path",{d:"M6.79576 11.9996C6.46532 11.9996 6.18343 11.8821 5.9501 11.6471C5.71676 11.4121 5.6001 11.1296 5.6001 10.7996V9.68294C4.96676 9.2685 4.4751 8.73711 4.1251 8.08878C3.7751 7.44044 3.6001 6.74405 3.6001 5.99961C3.6001 4.77394 4.02665 3.73417 4.87976 2.88028C5.73288 2.0265 6.77176 1.59961 7.99643 1.59961C9.2211 1.59961 10.2612 2.0265 11.1168 2.88028C11.9723 3.73417 12.4001 4.77394 12.4001 5.99961C12.4001 6.74205 12.2251 7.43878 11.8751 8.08978C11.5251 8.74078 11.0334 9.27183 10.4001 9.68294V10.7996C10.4001 11.1296 10.2824 11.4121 10.0471 11.6471C9.81188 11.8821 9.52904 11.9996 9.1986 11.9996H6.79576ZM6.8001 10.7996H9.2001V9.03294L9.7501 8.68294C10.2057 8.39405 10.5612 8.00972 10.8168 7.52994C11.0723 7.05017 11.2001 6.54005 11.2001 5.99961C11.2001 5.11428 10.8877 4.35961 10.2629 3.73561C9.63826 3.11161 8.88271 2.79961 7.99626 2.79961C7.10993 2.79961 6.35565 3.11161 5.73343 3.73561C5.11121 4.35961 4.8001 5.11428 4.8001 5.99961C4.8001 6.54005 4.92788 7.05017 5.18343 7.52994C5.43899 8.00972 5.79454 8.39405 6.2501 8.68294L6.8001 9.03294V10.7996ZM6.8001 14.3996C6.57343 14.3996 6.38343 14.3229 6.2301 14.1696C6.07676 14.0163 6.0001 13.8263 6.0001 13.5996V13.1996H10.0001V13.5996C10.0001 13.8263 9.92343 14.0163 9.7701 14.1696C9.61676 14.3229 9.42676 14.3996 9.2001 14.3996H6.8001Z",fill:"#637381"})})]}),o=e==="completed"||t.includes(s("chat.reasoning.thinking"))||t.includes(s("chat.reasoning.processing"));return h.jsxs("div",{className:`chat-wrapper__reasoning-trigger ${o?"chat-wrapper__reasoning-trigger--clickable":""}`,onClick:o?r:void 0,style:{cursor:o?"pointer":"default"},children:[h.jsx("div",{className:"chat-wrapper__reasoning-icon",children:a()}),h.jsxs("span",{className:"chat-wrapper__reasoning-title",children:[t,n&&e==="completed"&&h.jsx("span",{className:"chat-wrapper__reasoning-duration",children:n})]}),o&&h.jsx("div",{className:`chat-wrapper__reasoning-arrow ${i?"":"chat-wrapper__reasoning-arrow--collapsed"}`,children:h.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_44_18068",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.000488281",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_44_18068)",children:h.jsx("path",{d:"M8 10.4506L4 6.45059L4.85 5.60059L8 8.75059L11.15 5.60059L12 6.45059L8 10.4506Z",fill:"#637381"})})]})})]})}function fi({children:t,isVisible:e=!0,title:n=""}){return!e||!(n.toLowerCase().includes("thinking")||n.toLowerCase().includes("thought"))?null:h.jsx("div",{className:"chat-wrapper__reasoning-content",children:h.jsx("div",{className:"chat-wrapper__reasoning-text",children:t})})}function $p({children:t}){return h.jsx("div",{className:"chat-wrapper__tooling-handle",children:t})}function Vp({title:t,status:e="processing",toolData:n,toolName:r,clientTools:i}){var u,l;const{t:s}=Mt(),a=()=>{if(!r||!i)return null;const d=i.find(g=>g.name===r);return(d==null?void 0:d.description)||null};let o;if(r!=null&&r.startsWith("lat_")){const d=(u=n==null?void 0:n.parameters)==null?void 0:u.query,g=(l=n==null?void 0:n.parameters)==null?void 0:l.url;o=d||g||s("chat.tools.executing")}else o=a();o&&(o.startsWith("http://")||o.startsWith("https://")||(o=o.charAt(0).toUpperCase()+o.slice(1)));const c=()=>{switch(e){case"processing":return h.jsxs("div",{className:"chat-wrapper__tooling-handle-trigger-content",children:[h.jsx("div",{className:"chat-wrapper__thinking-icon",children:r!=null&&r.startsWith("lat_tool_web_")?h.jsxs("svg",{width:"20",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_210_25142",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"16",children:h.jsx("rect",{width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_210_25142)",children:h.jsx("path",{d:"M8.00001 14.4001C7.12223 14.4001 6.29445 14.2334 5.51667 13.9001C4.7389 13.5668 4.05834 13.1084 3.47501 12.5251C2.89167 11.9418 2.43334 11.2612 2.10001 10.4834C1.76667 9.70565 1.60001 8.87788 1.60001 8.0001C1.60001 7.11121 1.76667 6.28065 2.10001 5.50843C2.43334 4.73621 2.89167 4.05843 3.47501 3.4751C4.05834 2.89176 4.7389 2.43343 5.51667 2.1001C6.29445 1.76676 7.12223 1.6001 8.00001 1.6001C8.8889 1.6001 9.71945 1.76676 10.4917 2.1001C11.2639 2.43343 11.9417 2.89176 12.525 3.4751C13.1083 4.05843 13.5667 4.73621 13.9 5.50843C14.2333 6.28065 14.4 7.11121 14.4 8.0001C14.4 8.87788 14.2333 9.70565 13.9 10.4834C13.5667 11.2612 13.1083 11.9418 12.525 12.5251C11.9417 13.1084 11.2639 13.5668 10.4917 13.9001C9.71945 14.2334 8.8889 14.4001 8.00001 14.4001ZM8.00001 13.1501C8.1889 12.9612 8.37778 12.6084 8.56667 12.0918C8.75556 11.5751 8.90001 11.0112 9.00001 10.4001H7.00001C7.10001 11.0112 7.24445 11.5751 7.43334 12.0918C7.62223 12.6084 7.81112 12.9612 8.00001 13.1501ZM6.48334 12.9834C6.32778 12.6501 6.19167 12.2668 6.07501 11.8334C5.95834 11.4001 5.86112 10.9223 5.78334 10.4001H3.40001C3.72223 11.0334 4.15001 11.5751 4.68334 12.0251C5.21667 12.4751 5.81667 12.7945 6.48334 12.9834ZM9.51667 12.9834C10.1833 12.7945 10.7833 12.4751 11.3167 12.0251C11.85 11.5751 12.2778 11.0334 12.6 10.4001H10.2167C10.1389 10.9223 10.0417 11.4001 9.92501 11.8334C9.80834 12.2668 9.67223 12.6501 9.51667 12.9834ZM2.95001 9.2001H5.63334C5.61112 8.98899 5.59723 8.78065 5.59167 8.5751C5.58612 8.36954 5.58334 8.16676 5.58334 7.96676C5.58334 7.76676 5.58612 7.56954 5.59167 7.3751C5.59723 7.18065 5.61112 6.98899 5.63334 6.8001H2.95001C2.89445 7.01121 2.85556 7.21399 2.83334 7.40843C2.81112 7.60288 2.80001 7.8001 2.80001 8.0001C2.80001 8.2001 2.81112 8.39732 2.83334 8.59176C2.85556 8.78621 2.89445 8.98899 2.95001 9.2001ZM6.85001 9.2001H9.15001C9.17223 8.97788 9.18612 8.76954 9.19167 8.5751C9.19723 8.38065 9.20001 8.18899 9.20001 8.0001C9.20001 7.81121 9.19723 7.61676 9.19167 7.41676C9.18612 7.21676 9.17223 7.01121 9.15001 6.8001H6.85001C6.82778 7.01121 6.8139 7.21676 6.80834 7.41676C6.80278 7.61676 6.80001 7.81121 6.80001 8.0001C6.80001 8.18899 6.80278 8.38343 6.80834 8.58343C6.8139 8.78343 6.82778 8.98899 6.85001 9.2001ZM10.3667 9.2001H13.05C13.1056 8.98899 13.1445 8.78621 13.1667 8.59176C13.1889 8.39732 13.2 8.2001 13.2 8.0001C13.2 7.8001 13.1889 7.6001 13.1667 7.4001C13.1445 7.2001 13.1056 7.0001 13.05 6.8001H10.3667C10.3889 7.01121 10.4028 7.21954 10.4083 7.4251C10.4139 7.63065 10.4167 7.83343 10.4167 8.03343C10.4167 8.23343 10.4139 8.43065 10.4083 8.6251C10.4028 8.81954 10.3889 9.01121 10.3667 9.2001ZM10.2167 5.6001H12.6C12.2778 4.96676 11.85 4.4251 11.3167 3.9751C10.7833 3.5251 10.1833 3.20565 9.51667 3.01676C9.67223 3.3501 9.80834 3.73343 9.92501 4.16676C10.0417 4.6001 10.1389 5.07788 10.2167 5.6001ZM7.00001 5.6001H9.00001C8.90001 4.98899 8.75556 4.4251 8.56667 3.90843C8.37778 3.39176 8.1889 3.03899 8.00001 2.8501C7.81112 3.03899 7.62223 3.39176 7.43334 3.90843C7.24445 4.4251 7.10001 4.98899 7.00001 5.6001ZM3.40001 5.6001H5.78334C5.86112 5.07788 5.95834 4.6001 6.07501 4.16676C6.19167 3.73343 6.32778 3.3501 6.48334 3.01676C5.81667 3.20565 5.21667 3.5251 4.68334 3.9751C4.15001 4.4251 3.72223 4.96676 3.40001 5.6001Z",fill:"#637381"})})]}):h.jsxs("svg",{width:"20",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_64_36257",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.381836",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_64_36257)",children:h.jsx("path",{d:"M11.0999 13.6651L7.91657 10.4817C7.69435 10.5706 7.45268 10.6401 7.19157 10.6901C6.93046 10.7401 6.66657 10.7651 6.3999 10.7651C5.2999 10.7651 4.35824 10.3762 3.5749 9.5984C2.79157 8.82063 2.3999 7.88174 2.3999 6.78174C2.3999 6.36196 2.45268 5.96257 2.55824 5.58357C2.66379 5.20457 2.82212 4.85396 3.03324 4.53174L5.43324 6.93174L6.5999 5.76507L4.1999 3.36507C4.52212 3.17618 4.86935 3.03174 5.24157 2.93174C5.61379 2.83174 5.9999 2.78174 6.3999 2.78174C7.51101 2.78174 8.45546 3.17618 9.23324 3.96507C10.011 4.75396 10.3999 5.69946 10.3999 6.80157C10.3999 7.05502 10.3749 7.29007 10.3249 7.50674C10.2749 7.7234 10.2055 7.94285 10.1166 8.16507L13.3666 11.3984C13.5221 11.5578 13.5999 11.7505 13.5999 11.9762C13.5999 12.2021 13.5221 12.3928 13.3666 12.5484L12.2332 13.6651C12.0767 13.8206 11.8876 13.8984 11.6659 13.8984C11.4441 13.8984 11.2555 13.8206 11.0999 13.6651ZM11.6666 12.5317L12.2499 11.9651L8.66657 8.41507C8.88879 8.14841 9.03324 7.85674 9.0999 7.54007C9.16657 7.2234 9.1999 6.97618 9.1999 6.7984C9.1999 6.05563 8.93601 5.40885 8.40824 4.85807C7.88046 4.30718 7.24435 4.01507 6.4999 3.98174L7.86657 5.33174C7.98879 5.45596 8.0499 5.60091 8.0499 5.76657C8.0499 5.93224 7.98718 6.07735 7.86174 6.20191L5.85474 8.1949C5.72929 8.31946 5.58779 8.38174 5.43024 8.38174C5.27268 8.38174 5.13479 8.32063 5.01657 8.1984L3.5999 6.78174C3.5999 7.5484 3.8749 8.20396 4.4249 8.7484C4.9749 9.29285 5.63324 9.56507 6.3999 9.56507C6.58879 9.56507 6.8499 9.52618 7.18324 9.44841C7.51657 9.37063 7.82768 9.21507 8.11657 8.98174L11.6666 12.5317Z",fill:"#637381"})})]})}),h.jsx("span",{children:o}),h.jsxs("div",{className:"chat-wrapper__status-group",children:[h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsxs("svg",{width:"20",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_64_36278",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.381836",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_64_36278)",children:h.jsx("path",{d:"M6.7966 7.78193C6.9656 7.78193 7.10843 7.72477 7.2251 7.61043C7.34176 7.4961 7.4001 7.35443 7.4001 7.18543C7.4001 7.01643 7.34293 6.8736 7.2286 6.75693C7.11426 6.64027 6.9726 6.58193 6.8036 6.58193C6.6346 6.58193 6.49176 6.6391 6.3751 6.75343C6.25843 6.86777 6.2001 7.00943 6.2001 7.17843C6.2001 7.34743 6.25726 7.49027 6.3716 7.60693C6.48593 7.7236 6.6276 7.78193 6.7966 7.78193ZM6.7966 10.1819C6.9656 10.1819 7.10843 10.1248 7.2251 10.0104C7.34176 9.8961 7.4001 9.75443 7.4001 9.58543C7.4001 9.41643 7.34293 9.2736 7.2286 9.15693C7.11426 9.04027 6.9726 8.98193 6.8036 8.98193C6.6346 8.98193 6.49176 9.0391 6.3751 9.15343C6.25843 9.26777 6.2001 9.40943 6.2001 9.57843C6.2001 9.74743 6.25726 9.89027 6.3716 10.0069C6.48593 10.1236 6.6276 10.1819 6.7966 10.1819ZM4.8001 7.58193C4.90676 7.58193 5.0001 7.54193 5.0801 7.46193C5.1601 7.38193 5.2001 7.2886 5.2001 7.18193C5.2001 7.07527 5.1601 6.98193 5.0801 6.90193C5.0001 6.82193 4.90676 6.78193 4.8001 6.78193C4.69343 6.78193 4.6001 6.82193 4.5201 6.90193C4.4401 6.98193 4.4001 7.07527 4.4001 7.18193C4.4001 7.2886 4.4401 7.38193 4.5201 7.46193C4.6001 7.54193 4.69343 7.58193 4.8001 7.58193ZM6.8001 11.9819C6.90676 11.9819 7.0001 11.9419 7.0801 11.8619C7.1601 11.7819 7.2001 11.6886 7.2001 11.5819C7.2001 11.4753 7.1601 11.3819 7.0801 11.3019C7.0001 11.2219 6.90676 11.1819 6.8001 11.1819C6.69343 11.1819 6.6001 11.2219 6.5201 11.3019C6.4401 11.3819 6.4001 11.4753 6.4001 11.5819C6.4001 11.6886 6.4401 11.7819 6.5201 11.8619C6.6001 11.9419 6.69343 11.9819 6.8001 11.9819ZM4.8001 9.98193C4.90676 9.98193 5.0001 9.94193 5.0801 9.86193C5.1601 9.78193 5.2001 9.6886 5.2001 9.58193C5.2001 9.47527 5.1601 9.38193 5.0801 9.30193C5.0001 9.22193 4.90676 9.18193 4.8001 9.18193C4.69343 9.18193 4.6001 9.22193 4.5201 9.30193C4.4401 9.38193 4.4001 9.47527 4.4001 9.58193C4.4001 9.6886 4.4401 9.78193 4.5201 9.86193C4.6001 9.94193 4.69343 9.98193 4.8001 9.98193ZM6.8001 5.58193C6.90676 5.58193 7.0001 5.54193 7.0801 5.46193C7.1601 5.38193 7.2001 5.2886 7.2001 5.18193C7.2001 5.07527 7.1601 4.98193 7.0801 4.90193C7.0001 4.82193 6.90676 4.78193 6.8001 4.78193C6.69343 4.78193 6.6001 4.82193 6.5201 4.90193C6.4401 4.98193 6.4001 5.07527 6.4001 5.18193C6.4001 5.2886 6.4401 5.38193 6.5201 5.46193C6.6001 5.54193 6.69343 5.58193 6.8001 5.58193ZM9.1966 7.78193C9.3656 7.78193 9.50843 7.72477 9.6251 7.61043C9.74176 7.4961 9.8001 7.35443 9.8001 7.18543C9.8001 7.01643 9.74293 6.8736 9.6286 6.75693C9.51426 6.64027 9.3726 6.58193 9.2036 6.58193C9.0346 6.58193 8.89176 6.6391 8.7751 6.75343C8.65843 6.86777 8.6001 7.00943 8.6001 7.17843C8.6001 7.34743 8.65726 7.49027 8.7716 7.60693C8.88593 7.7236 9.0276 7.78193 9.1966 7.78193ZM9.2001 5.58193C9.30676 5.58193 9.4001 5.54193 9.4801 5.46193C9.5601 5.38193 9.6001 5.2886 9.6001 5.18193C9.6001 5.07527 9.5601 4.98193 9.4801 4.90193C9.4001 4.82193 9.30676 4.78193 9.2001 4.78193C9.09343 4.78193 9.0001 4.82193 8.9201 4.90193C8.8401 4.98193 8.8001 5.07527 8.8001 5.18193C8.8001 5.2886 8.8401 5.38193 8.9201 5.46193C9.0001 5.54193 9.09343 5.58193 9.2001 5.58193ZM11.2001 9.98193C11.3068 9.98193 11.4001 9.94193 11.4801 9.86193C11.5601 9.78193 11.6001 9.6886 11.6001 9.58193C11.6001 9.47527 11.5601 9.38193 11.4801 9.30193C11.4001 9.22193 11.3068 9.18193 11.2001 9.18193C11.0934 9.18193 11.0001 9.22193 10.9201 9.30193C10.8401 9.38193 10.8001 9.47527 10.8001 9.58193C10.8001 9.6886 10.8401 9.78193 10.9201 9.86193C11.0001 9.94193 11.0934 9.98193 11.2001 9.98193ZM11.2001 7.58193C11.3068 7.58193 11.4001 7.54193 11.4801 7.46193C11.5601 7.38193 11.6001 7.2886 11.6001 7.18193C11.6001 7.07527 11.5601 6.98193 11.4801 6.90193C11.4001 6.82193 11.3068 6.78193 11.2001 6.78193C11.0934 6.78193 11.0001 6.82193 10.9201 6.90193C10.8401 6.98193 10.8001 7.07527 10.8001 7.18193C10.8001 7.2886 10.8401 7.38193 10.9201 7.46193C11.0001 7.54193 11.0934 7.58193 11.2001 7.58193ZM8.00476 14.7819C7.12388 14.7819 6.29454 14.6153 5.51676 14.2819C4.73899 13.9486 4.05843 13.4903 3.4751 12.9069C2.89176 12.3236 2.43343 11.6433 2.1001 10.8659C1.76676 10.0886 1.6001 9.25805 1.6001 8.37427C1.6001 7.49049 1.76676 6.66249 2.1001 5.89027C2.43343 5.11805 2.89176 4.44027 3.4751 3.85693C4.05843 3.2736 4.73876 2.81527 5.5161 2.48193C6.29343 2.1486 7.12399 1.98193 8.00776 1.98193C8.89154 1.98193 9.71954 2.1486 10.4918 2.48193C11.264 2.81527 11.9418 3.2736 12.5251 3.85693C13.1084 4.44027 13.5668 5.11927 13.9001 5.89393C14.2334 6.66871 14.4001 7.49649 14.4001 8.37727C14.4001 9.25816 14.2334 10.0875 13.9001 10.8653C13.5668 11.643 13.1084 12.3236 12.5251 12.9069C11.9418 13.4903 11.2628 13.9486 10.4881 14.2819C9.71332 14.6153 8.88554 14.7819 8.00476 14.7819ZM8.0001 13.5819C9.44454 13.5819 10.6723 13.0764 11.6834 12.0653C12.6945 11.0542 13.2001 9.82638 13.2001 8.38193C13.2001 6.93749 12.6945 5.70971 11.6834 4.6986C10.6723 3.68749 9.44454 3.18193 8.0001 3.18193C6.55565 3.18193 5.32788 3.68749 4.31676 4.6986C3.30565 5.70971 2.8001 6.93749 2.8001 8.38193C2.8001 9.82638 3.30565 11.0542 4.31676 12.0653C5.32788 13.0764 6.55565 13.5819 8.0001 13.5819ZM9.2001 11.9819C9.30676 11.9819 9.4001 11.9419 9.4801 11.8619C9.5601 11.7819 9.6001 11.6886 9.6001 11.5819C9.6001 11.4753 9.5601 11.3819 9.4801 11.3019C9.4001 11.2219 9.30676 11.1819 9.2001 11.1819C9.09343 11.1819 9.0001 11.2219 8.9201 11.3019C8.8401 11.3819 8.8001 11.4753 8.8001 11.5819C8.8001 11.6886 8.8401 11.7819 8.9201 11.8619C9.0001 11.9419 9.09343 11.9819 9.2001 11.9819ZM9.1966 10.1819C9.3656 10.1819 9.50843 10.1248 9.6251 10.0104C9.74176 9.8961 9.8001 9.75443 9.8001 9.58543C9.8001 9.41643 9.74293 9.2736 9.6286 9.15693C9.51426 9.04027 9.3726 8.98193 9.2036 8.98193C9.0346 8.98193 8.89176 9.0391 8.7751 9.15343C8.65843 9.26777 8.6001 9.40943 8.6001 9.57843C8.6001 9.74743 8.65726 9.89027 8.7716 10.0069C8.88593 10.1236 9.0276 10.1819 9.1966 10.1819Z",fill:"#637381"})})]})})}),h.jsx("span",{children:s("chat.tools.executing")})]})]});case"completed":return h.jsxs("div",{className:"chat-wrapper__tooling-handle-trigger-content",children:[h.jsx("div",{className:"chat-wrapper__thinking-icon",children:r!=null&&r.startsWith("lat_tool_web_")?h.jsxs("svg",{width:"20",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_210_25142",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"16",children:h.jsx("rect",{width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_210_25142)",children:h.jsx("path",{d:"M8.00001 14.4001C7.12223 14.4001 6.29445 14.2334 5.51667 13.9001C4.7389 13.5668 4.05834 13.1084 3.47501 12.5251C2.89167 11.9418 2.43334 11.2612 2.10001 10.4834C1.76667 9.70565 1.60001 8.87788 1.60001 8.0001C1.60001 7.11121 1.76667 6.28065 2.10001 5.50843C2.43334 4.73621 2.89167 4.05843 3.47501 3.4751C4.05834 2.89176 4.7389 2.43343 5.51667 2.1001C6.29445 1.76676 7.12223 1.6001 8.00001 1.6001C8.8889 1.6001 9.71945 1.76676 10.4917 2.1001C11.2639 2.43343 11.9417 2.89176 12.525 3.4751C13.1083 4.05843 13.5667 4.73621 13.9 5.50843C14.2333 6.28065 14.4 7.11121 14.4 8.0001C14.4 8.87788 14.2333 9.70565 13.9 10.4834C13.5667 11.2612 13.1083 11.9418 12.525 12.5251C11.9417 13.1084 11.2639 13.5668 10.4917 13.9001C9.71945 14.2334 8.8889 14.4001 8.00001 14.4001ZM8.00001 13.1501C8.1889 12.9612 8.37778 12.6084 8.56667 12.0918C8.75556 11.5751 8.90001 11.0112 9.00001 10.4001H7.00001C7.10001 11.0112 7.24445 11.5751 7.43334 12.0918C7.62223 12.6084 7.81112 12.9612 8.00001 13.1501ZM6.48334 12.9834C6.32778 12.6501 6.19167 12.2668 6.07501 11.8334C5.95834 11.4001 5.86112 10.9223 5.78334 10.4001H3.40001C3.72223 11.0334 4.15001 11.5751 4.68334 12.0251C5.21667 12.4751 5.81667 12.7945 6.48334 12.9834ZM9.51667 12.9834C10.1833 12.7945 10.7833 12.4751 11.3167 12.0251C11.85 11.5751 12.2778 11.0334 12.6 10.4001H10.2167C10.1389 10.9223 10.0417 11.4001 9.92501 11.8334C9.80834 12.2668 9.67223 12.6501 9.51667 12.9834ZM2.95001 9.2001H5.63334C5.61112 8.98899 5.59723 8.78065 5.59167 8.5751C5.58612 8.36954 5.58334 8.16676 5.58334 7.96676C5.58334 7.76676 5.58612 7.56954 5.59167 7.3751C5.59723 7.18065 5.61112 6.98899 5.63334 6.8001H2.95001C2.89445 7.01121 2.85556 7.21399 2.83334 7.40843C2.81112 7.60288 2.80001 7.8001 2.80001 8.0001C2.80001 8.2001 2.81112 8.39732 2.83334 8.59176C2.85556 8.78621 2.89445 8.98899 2.95001 9.2001ZM6.85001 9.2001H9.15001C9.17223 8.97788 9.18612 8.76954 9.19167 8.5751C9.19723 8.38065 9.20001 8.18899 9.20001 8.0001C9.20001 7.81121 9.19723 7.61676 9.19167 7.41676C9.18612 7.21676 9.17223 7.01121 9.15001 6.8001H6.85001C6.82778 7.01121 6.8139 7.21676 6.80834 7.41676C6.80278 7.61676 6.80001 7.81121 6.80001 8.0001C6.80001 8.18899 6.80278 8.38343 6.80834 8.58343C6.8139 8.78343 6.82778 8.98899 6.85001 9.2001ZM10.3667 9.2001H13.05C13.1056 8.98899 13.1445 8.78621 13.1667 8.59176C13.1889 8.39732 13.2 8.2001 13.2 8.0001C13.2 7.8001 13.1889 7.6001 13.1667 7.4001C13.1445 7.2001 13.1056 7.0001 13.05 6.8001H10.3667C10.3889 7.01121 10.4028 7.21954 10.4083 7.4251C10.4139 7.63065 10.4167 7.83343 10.4167 8.03343C10.4167 8.23343 10.4139 8.43065 10.4083 8.6251C10.4028 8.81954 10.3889 9.01121 10.3667 9.2001ZM10.2167 5.6001H12.6C12.2778 4.96676 11.85 4.4251 11.3167 3.9751C10.7833 3.5251 10.1833 3.20565 9.51667 3.01676C9.67223 3.3501 9.80834 3.73343 9.92501 4.16676C10.0417 4.6001 10.1389 5.07788 10.2167 5.6001ZM7.00001 5.6001H9.00001C8.90001 4.98899 8.75556 4.4251 8.56667 3.90843C8.37778 3.39176 8.1889 3.03899 8.00001 2.8501C7.81112 3.03899 7.62223 3.39176 7.43334 3.90843C7.24445 4.4251 7.10001 4.98899 7.00001 5.6001ZM3.40001 5.6001H5.78334C5.86112 5.07788 5.95834 4.6001 6.07501 4.16676C6.19167 3.73343 6.32778 3.3501 6.48334 3.01676C5.81667 3.20565 5.21667 3.5251 4.68334 3.9751C4.15001 4.4251 3.72223 4.96676 3.40001 5.6001Z",fill:"#637381"})})]}):h.jsxs("svg",{width:"20",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_64_36257",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.381836",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_64_36257)",children:h.jsx("path",{d:"M11.0999 13.6651L7.91657 10.4817C7.69435 10.5706 7.45268 10.6401 7.19157 10.6901C6.93046 10.7401 6.66657 10.7651 6.3999 10.7651C5.2999 10.7651 4.35824 10.3762 3.5749 9.5984C2.79157 8.82063 2.3999 7.88174 2.3999 6.78174C2.3999 6.36196 2.45268 5.96257 2.55824 5.58357C2.66379 5.20457 2.82212 4.85396 3.03324 4.53174L5.43324 6.93174L6.5999 5.76507L4.1999 3.36507C4.52212 3.17618 4.86935 3.03174 5.24157 2.93174C5.61379 2.83174 5.9999 2.78174 6.3999 2.78174C7.51101 2.78174 8.45546 3.17618 9.23324 3.96507C10.011 4.75396 10.3999 5.69946 10.3999 6.80157C10.3999 7.05502 10.3749 7.29007 10.3249 7.50674C10.2749 7.7234 10.2055 7.94285 10.1166 8.16507L13.3666 11.3984C13.5221 11.5578 13.5999 11.7505 13.5999 11.9762C13.5999 12.2021 13.5221 12.3928 13.3666 12.5484L12.2332 13.6651C12.0767 13.8206 11.8876 13.8984 11.6659 13.8984C11.4441 13.8984 11.2555 13.8206 11.0999 13.6651ZM11.6666 12.5317L12.2499 11.9651L8.66657 8.41507C8.88879 8.14841 9.03324 7.85674 9.0999 7.54007C9.16657 7.2234 9.1999 6.97618 9.1999 6.7984C9.1999 6.05563 8.93601 5.40885 8.40824 4.85807C7.88046 4.30718 7.24435 4.01507 6.4999 3.98174L7.86657 5.33174C7.98879 5.45596 8.0499 5.60091 8.0499 5.76657C8.0499 5.93224 7.98718 6.07735 7.86174 6.20191L5.85474 8.1949C5.72929 8.31946 5.58779 8.38174 5.43024 8.38174C5.27268 8.38174 5.13479 8.32063 5.01657 8.1984L3.5999 6.78174C3.5999 7.5484 3.8749 8.20396 4.4249 8.7484C4.9749 9.29285 5.63324 9.56507 6.3999 9.56507C6.58879 9.56507 6.8499 9.52618 7.18324 9.44841C7.51657 9.37063 7.82768 9.21507 8.11657 8.98174L11.6666 12.5317Z",fill:"#637381"})})]})}),h.jsx("span",{children:o}),h.jsxs("div",{className:"chat-wrapper__status-group",children:[h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsxs("svg",{width:"20",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_64_36345",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.381836",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_64_36345)",children:h.jsx("path",{d:"M7.1501 10.7819L11.1168 6.83193L10.2668 5.98193L7.1501 9.08193L5.73343 7.68193L4.88343 8.53193L7.1501 10.7819ZM8.0001 14.7819C7.12232 14.7819 6.29454 14.6153 5.51676 14.2819C4.73899 13.9486 4.05843 13.4903 3.4751 12.9069C2.89176 12.3236 2.43343 11.643 2.1001 10.8653C1.76676 10.0875 1.6001 9.25971 1.6001 8.38193C1.6001 7.49304 1.76676 6.66249 2.1001 5.89027C2.43343 5.11805 2.89176 4.44027 3.4751 3.85693C4.05843 3.2736 4.73899 2.81527 5.51676 2.48193C6.29454 2.1486 7.12232 1.98193 8.0001 1.98193C8.88899 1.98193 9.71954 2.1486 10.4918 2.48193C11.264 2.81527 11.9418 3.2736 12.5251 3.85693C13.1084 4.44027 13.5668 5.11805 13.9001 5.89027C14.2334 6.66249 14.4001 7.49304 14.4001 8.38193C14.4001 9.25971 14.2334 10.0875 13.9001 10.8653C13.5668 11.643 13.1084 12.3236 12.5251 12.9069C11.9418 13.4903 11.264 13.9486 10.4918 14.2819C9.71954 14.6153 8.88899 14.7819 8.0001 14.7819ZM8.0001 13.5819C9.44454 13.5819 10.6723 13.0764 11.6834 12.0653C12.6945 11.0542 13.2001 9.82638 13.2001 8.38193C13.2001 6.93749 12.6945 5.70971 11.6834 4.6986C10.6723 3.68749 9.44454 3.18193 8.0001 3.18193C6.55565 3.18193 5.32788 3.68749 4.31676 4.6986C3.30565 5.70971 2.8001 6.93749 2.8001 8.38193C2.8001 9.82638 3.30565 11.0542 4.31676 12.0653C5.32788 13.0764 6.55565 13.5819 8.0001 13.5819Z",fill:"#4EAD13"})})]})})}),h.jsx("span",{children:s("chat.tools.completed")})]})]});case"error":return h.jsxs("div",{className:"chat-wrapper__tooling-handle-trigger-content",children:[h.jsx("div",{className:"chat-wrapper__tooling-handle-error",children:h.jsx("svg",{width:"20",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:h.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),h.jsx("span",{className:"chat-wrapper__tooling-handle-title",children:t})]});default:return h.jsxs("div",{className:"chat-wrapper__tooling-handle-trigger-content",children:[h.jsx("div",{className:"chat-wrapper__thinking-icon",children:r!=null&&r.startsWith("lat_tool_web_")?h.jsxs("svg",{width:"20",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_210_25142",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"16",children:h.jsx("rect",{width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_210_25142)",children:h.jsx("path",{d:"M8.00001 14.4001C7.12223 14.4001 6.29445 14.2334 5.51667 13.9001C4.7389 13.5668 4.05834 13.1084 3.47501 12.5251C2.89167 11.9418 2.43334 11.2612 2.10001 10.4834C1.76667 9.70565 1.60001 8.87788 1.60001 8.0001C1.60001 7.11121 1.76667 6.28065 2.10001 5.50843C2.43334 4.73621 2.89167 4.05843 3.47501 3.4751C4.05834 2.89176 4.7389 2.43343 5.51667 2.1001C6.29445 1.76676 7.12223 1.6001 8.00001 1.6001C8.8889 1.6001 9.71945 1.76676 10.4917 2.1001C11.2639 2.43343 11.9417 2.89176 12.525 3.4751C13.1083 4.05843 13.5667 4.73621 13.9 5.50843C14.2333 6.28065 14.4 7.11121 14.4 8.0001C14.4 8.87788 14.2333 9.70565 13.9 10.4834C13.5667 11.2612 13.1083 11.9418 12.525 12.5251C11.9417 13.1084 11.2639 13.5668 10.4917 13.9001C9.71945 14.2334 8.8889 14.4001 8.00001 14.4001ZM8.00001 13.1501C8.1889 12.9612 8.37778 12.6084 8.56667 12.0918C8.75556 11.5751 8.90001 11.0112 9.00001 10.4001H7.00001C7.10001 11.0112 7.24445 11.5751 7.43334 12.0918C7.62223 12.6084 7.81112 12.9612 8.00001 13.1501ZM6.48334 12.9834C6.32778 12.6501 6.19167 12.2668 6.07501 11.8334C5.95834 11.4001 5.86112 10.9223 5.78334 10.4001H3.40001C3.72223 11.0334 4.15001 11.5751 4.68334 12.0251C5.21667 12.4751 5.81667 12.7945 6.48334 12.9834ZM9.51667 12.9834C10.1833 12.7945 10.7833 12.4751 11.3167 12.0251C11.85 11.5751 12.2778 11.0334 12.6 10.4001H10.2167C10.1389 10.9223 10.0417 11.4001 9.92501 11.8334C9.80834 12.2668 9.67223 12.6501 9.51667 12.9834ZM2.95001 9.2001H5.63334C5.61112 8.98899 5.59723 8.78065 5.59167 8.5751C5.58612 8.36954 5.58334 8.16676 5.58334 7.96676C5.58334 7.76676 5.58612 7.56954 5.59167 7.3751C5.59723 7.18065 5.61112 6.98899 5.63334 6.8001H2.95001C2.89445 7.01121 2.85556 7.21399 2.83334 7.40843C2.81112 7.60288 2.80001 7.8001 2.80001 8.0001C2.80001 8.2001 2.81112 8.39732 2.83334 8.59176C2.85556 8.78621 2.89445 8.98899 2.95001 9.2001ZM6.85001 9.2001H9.15001C9.17223 8.97788 9.18612 8.76954 9.19167 8.5751C9.19723 8.38065 9.20001 8.18899 9.20001 8.0001C9.20001 7.81121 9.19723 7.61676 9.19167 7.41676C9.18612 7.21676 9.17223 7.01121 9.15001 6.8001H6.85001C6.82778 7.01121 6.8139 7.21676 6.80834 7.41676C6.80278 7.61676 6.80001 7.81121 6.80001 8.0001C6.80001 8.18899 6.80278 8.38343 6.80834 8.58343C6.8139 8.78343 6.82778 8.98899 6.85001 9.2001ZM10.3667 9.2001H13.05C13.1056 8.98899 13.1445 8.78621 13.1667 8.59176C13.1889 8.39732 13.2 8.2001 13.2 8.0001C13.2 7.8001 13.1889 7.6001 13.1667 7.4001C13.1445 7.2001 13.1056 7.0001 13.05 6.8001H10.3667C10.3889 7.01121 10.4028 7.21954 10.4083 7.4251C10.4139 7.63065 10.4167 7.83343 10.4167 8.03343C10.4167 8.23343 10.4139 8.43065 10.4083 8.6251C10.4028 8.81954 10.3889 9.01121 10.3667 9.2001ZM10.2167 5.6001H12.6C12.2778 4.96676 11.85 4.4251 11.3167 3.9751C10.7833 3.5251 10.1833 3.20565 9.51667 3.01676C9.67223 3.3501 9.80834 3.73343 9.92501 4.16676C10.0417 4.6001 10.1389 5.07788 10.2167 5.6001ZM7.00001 5.6001H9.00001C8.90001 4.98899 8.75556 4.4251 8.56667 3.90843C8.37778 3.39176 8.1889 3.03899 8.00001 2.8501C7.81112 3.03899 7.62223 3.39176 7.43334 3.90843C7.24445 4.4251 7.10001 4.98899 7.00001 5.6001ZM3.40001 5.6001H5.78334C5.86112 5.07788 5.95834 4.6001 6.07501 4.16676C6.19167 3.73343 6.32778 3.3501 6.48334 3.01676C5.81667 3.20565 5.21667 3.5251 4.68334 3.9751C4.15001 4.4251 3.72223 4.96676 3.40001 5.6001Z",fill:"#637381"})})]}):h.jsxs("svg",{width:"20",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_64_36257",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.381836",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_64_36257)",children:h.jsx("path",{d:"M11.0999 13.6651L7.91657 10.4817C7.69435 10.5706 7.45268 10.6401 7.19157 10.6901C6.93046 10.7401 6.66657 10.7651 6.3999 10.7651C5.2999 10.7651 4.35824 10.3762 3.5749 9.5984C2.79157 8.82063 2.3999 7.88174 2.3999 6.78174C2.3999 6.36196 2.45268 5.96257 2.55824 5.58357C2.66379 5.20457 2.82212 4.85396 3.03324 4.53174L5.43324 6.93174L6.5999 5.76507L4.1999 3.36507C4.52212 3.17618 4.86935 3.03174 5.24157 2.93174C5.61379 2.83174 5.9999 2.78174 6.3999 2.78174C7.51101 2.78174 8.45546 3.17618 9.23324 3.96507C10.011 4.75396 10.3999 5.69946 10.3999 6.80157C10.3999 7.05502 10.3749 7.29007 10.3249 7.50674C10.2749 7.7234 10.2055 7.94285 10.1166 8.16507L13.3666 11.3984C13.5221 11.5578 13.5999 11.7505 13.5999 11.9762C13.5999 12.2021 13.5221 12.3928 13.3666 12.5484L12.2332 13.6651C12.0767 13.8206 11.8876 13.8984 11.6659 13.8984C11.4441 13.8984 11.2555 13.8206 11.0999 13.6651ZM11.6666 12.5317L12.2499 11.9651L8.66657 8.41507C8.88879 8.14841 9.03324 7.85674 9.0999 7.54007C9.16657 7.2234 9.1999 6.97618 9.1999 6.7984C9.1999 6.05563 8.93601 5.40885 8.40824 4.85807C7.88046 4.30718 7.24435 4.01507 6.4999 3.98174L7.86657 5.33174C7.98879 5.45596 8.0499 5.60091 8.0499 5.76657C8.0499 5.93224 7.98718 6.07735 7.86174 6.20191L5.85474 8.1949C5.72929 8.31946 5.58779 8.38174 5.43024 8.38174C5.27268 8.38174 5.13479 8.32063 5.01657 8.1984L3.5999 6.78174C3.5999 7.5484 3.8749 8.20396 4.4249 8.7484C4.9749 9.29285 5.63324 9.56507 6.3999 9.56507C6.58879 9.56507 6.8499 9.52618 7.18324 9.44841C7.51657 9.37063 7.82768 9.21507 8.11657 8.98174L11.6666 12.5317Z",fill:"#637381"})})]})}),h.jsxs("span",{children:[`AI text input${r?` <${r}>`:""}`,"..."]}),h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsxs("svg",{width:"20",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_44_18068",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.000488281",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_44_18068)",children:h.jsx("path",{d:"M8 10.4506L4 6.45059L4.85 5.60059L8 8.75059L11.15 5.60059L12 6.45059L8 10.4506Z",fill:"#637381"})})]})})}),h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsxs("svg",{width:"20",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_64_36278",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.381836",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_64_36278)",children:h.jsx("path",{d:"M6.7966 7.78193C6.9656 7.78193 7.10843 7.72477 7.2251 7.61043C7.34176 7.4961 7.4001 7.35443 7.4001 7.18543C7.4001 7.01643 7.34293 6.8736 7.2286 6.75693C7.11426 6.64027 6.9726 6.58193 6.8036 6.58193C6.6346 6.58193 6.49176 6.6391 6.3751 6.75343C6.25843 6.86777 6.2001 7.00943 6.2001 7.17843C6.2001 7.34743 6.25726 7.49027 6.3716 7.60693C6.48593 7.7236 6.6276 7.78193 6.7966 7.78193ZM6.7966 10.1819C6.9656 10.1819 7.10843 10.1248 7.2251 10.0104C7.34176 9.8961 7.4001 9.75443 7.4001 9.58543C7.4001 9.41643 7.34293 9.2736 7.2286 9.15693C7.11426 9.04027 6.9726 8.98193 6.8036 8.98193C6.6346 8.98193 6.49176 9.0391 6.3751 9.15343C6.25843 9.26777 6.2001 9.40943 6.2001 9.57843C6.2001 9.74743 6.25726 9.89027 6.3716 10.0069C6.48593 10.1236 6.6276 10.1819 6.7966 10.1819ZM4.8001 7.58193C4.90676 7.58193 5.0001 7.54193 5.0801 7.46193C5.1601 7.38193 5.2001 7.2886 5.2001 7.18193C5.2001 7.07527 5.1601 6.98193 5.0801 6.90193C5.0001 6.82193 4.90676 6.78193 4.8001 6.78193C4.69343 6.78193 4.6001 6.82193 4.5201 6.90193C4.4401 6.98193 4.4001 7.07527 4.4001 7.18193C4.4001 7.2886 4.4401 7.38193 4.5201 7.46193C4.6001 7.54193 4.69343 7.58193 4.8001 7.58193ZM6.8001 11.9819C6.90676 11.9819 7.0001 11.9419 7.0801 11.8619C7.1601 11.7819 7.2001 11.6886 7.2001 11.5819C7.2001 11.4753 7.1601 11.3819 7.0801 11.3019C7.0001 11.2219 6.90676 11.1819 6.8001 11.1819C6.69343 11.1819 6.6001 11.2219 6.5201 11.3019C6.4401 11.3819 6.4001 11.4753 6.4001 11.5819C6.4001 11.6886 6.4401 11.7819 6.5201 11.8619C6.6001 11.9419 6.69343 11.9819 6.8001 11.9819ZM4.8001 9.98193C4.90676 9.98193 5.0001 9.94193 5.0801 9.86193C5.1601 9.78193 5.2001 9.6886 5.2001 9.58193C5.2001 9.47527 5.1601 9.38193 5.0801 9.30193C5.0001 9.22193 4.90676 9.18193 4.8001 9.18193C4.69343 9.18193 4.6001 9.22193 4.5201 9.30193C4.4401 9.38193 4.4001 9.47527 4.4001 9.58193C4.4001 9.6886 4.4401 9.78193 4.5201 9.86193C4.6001 9.94193 4.69343 9.98193 4.8001 9.98193ZM6.8001 5.58193C6.90676 5.58193 7.0001 5.54193 7.0801 5.46193C7.1601 5.38193 7.2001 5.2886 7.2001 5.18193C7.2001 5.07527 7.1601 4.98193 7.0801 4.90193C7.0001 4.82193 6.90676 4.78193 6.8001 4.78193C6.69343 4.78193 6.6001 4.82193 6.5201 4.90193C6.4401 4.98193 6.4001 5.07527 6.4001 5.18193C6.4001 5.2886 6.4401 5.38193 6.5201 5.46193C6.6001 5.54193 6.69343 5.58193 6.8001 5.58193ZM9.1966 7.78193C9.3656 7.78193 9.50843 7.72477 9.6251 7.61043C9.74176 7.4961 9.8001 7.35443 9.8001 7.18543C9.8001 7.01643 9.74293 6.8736 9.6286 6.75693C9.51426 6.64027 9.3726 6.58193 9.2036 6.58193C9.0346 6.58193 8.89176 6.6391 8.7751 6.75343C8.65843 6.86777 8.6001 7.00943 8.6001 7.17843C8.6001 7.34743 8.65726 7.49027 8.7716 7.60693C8.88593 7.7236 9.0276 7.78193 9.1966 7.78193ZM9.2001 5.58193C9.30676 5.58193 9.4001 5.54193 9.4801 5.46193C9.5601 5.38193 9.6001 5.2886 9.6001 5.18193C9.6001 5.07527 9.5601 4.98193 9.4801 4.90193C9.4001 4.82193 9.30676 4.78193 9.2001 4.78193C9.09343 4.78193 9.0001 4.82193 8.9201 4.90193C8.8401 4.98193 8.8001 5.07527 8.8001 5.18193C8.8001 5.2886 8.8401 5.38193 8.9201 5.46193C9.0001 5.54193 9.09343 5.58193 9.2001 5.58193ZM11.2001 9.98193C11.3068 9.98193 11.4001 9.94193 11.4801 9.86193C11.5601 9.78193 11.6001 9.6886 11.6001 9.58193C11.6001 9.47527 11.5601 9.38193 11.4801 9.30193C11.4001 9.22193 11.3068 9.18193 11.2001 9.18193C11.0934 9.18193 11.0001 9.22193 10.9201 9.30193C10.8401 9.38193 10.8001 9.47527 10.8001 9.58193C10.8001 9.6886 10.8401 9.78193 10.9201 9.86193C11.0001 9.94193 11.0934 9.98193 11.2001 9.98193ZM11.2001 7.58193C11.3068 7.58193 11.4001 7.54193 11.4801 7.46193C11.5601 7.38193 11.6001 7.2886 11.6001 7.18193C11.6001 7.07527 11.5601 6.98193 11.4801 6.90193C11.4001 6.82193 11.3068 6.78193 11.2001 6.78193C11.0934 6.78193 11.0001 6.82193 10.9201 6.90193C10.8401 6.98193 10.8001 7.07527 10.8001 7.18193C10.8001 7.2886 10.8401 7.38193 10.9201 7.46193C11.0001 7.54193 11.0934 7.58193 11.2001 7.58193ZM8.00476 14.7819C7.12388 14.7819 6.29454 14.6153 5.51676 14.2819C4.73899 13.9486 4.05843 13.4903 3.4751 12.9069C2.89176 12.3236 2.43343 11.6433 2.1001 10.8659C1.76676 10.0886 1.6001 9.25805 1.6001 8.37427C1.6001 7.49049 1.76676 6.66249 2.1001 5.89027C2.43343 5.11805 2.89176 4.44027 3.4751 3.85693C4.05843 3.2736 4.73876 2.81527 5.5161 2.48193C6.29343 2.1486 7.12399 1.98193 8.00776 1.98193C8.89154 1.98193 9.71954 2.1486 10.4918 2.48193C11.264 2.81527 11.9418 3.2736 12.5251 3.85693C13.1084 4.44027 13.5668 5.11927 13.9001 5.89393C14.2334 6.66871 14.4001 7.49649 14.4001 8.37727C14.4001 9.25816 14.2334 10.0875 13.9001 10.8653C13.5668 11.643 13.1084 12.3236 12.5251 12.9069C11.9418 13.4903 11.2628 13.9486 10.4881 14.2819C9.71332 14.6153 8.88554 14.7819 8.00476 14.7819ZM8.0001 13.5819C9.44454 13.5819 10.6723 13.0764 11.6834 12.0653C12.6945 11.0542 13.2001 9.82638 13.2001 8.38193C13.2001 6.93749 12.6945 5.70971 11.6834 4.6986C10.6723 3.68749 9.44454 3.18193 8.0001 3.18193C6.55565 3.18193 5.32788 3.68749 4.31676 4.6986C3.30565 5.70971 2.8001 6.93749 2.8001 8.38193C2.8001 9.82638 3.30565 11.0542 4.31676 12.0653C5.32788 13.0764 6.55565 13.5819 8.0001 13.5819ZM9.2001 11.9819C9.30676 11.9819 9.4001 11.9419 9.4801 11.8619C9.5601 11.7819 9.6001 11.6886 9.6001 11.5819C9.6001 11.4753 9.5601 11.3819 9.4801 11.3019C9.4001 11.2219 9.30676 11.1819 9.2001 11.1819C9.09343 11.1819 9.0001 11.2219 8.9201 11.3019C8.8401 11.3819 8.8001 11.4753 8.8001 11.5819C8.8001 11.6886 8.8401 11.7819 8.9201 11.8619C9.0001 11.9419 9.09343 11.9819 9.2001 11.9819ZM9.1966 10.1819C9.3656 10.1819 9.50843 10.1248 9.6251 10.0104C9.74176 9.8961 9.8001 9.75443 9.8001 9.58543C9.8001 9.41643 9.74293 9.2736 9.6286 9.15693C9.51426 9.04027 9.3726 8.98193 9.2036 8.98193C9.0346 8.98193 8.89176 9.0391 8.7751 9.15343C8.65843 9.26777 8.6001 9.40943 8.6001 9.57843C8.6001 9.74743 8.65726 9.89027 8.7716 10.0069C8.88593 10.1236 9.0276 10.1819 9.1966 10.1819Z",fill:"#637381"})})]})})}),h.jsx("span",{children:s("chat.tools.executing")})]})}};return h.jsx("div",{className:"chat-wrapper__tooling-handle-trigger",children:c()})}function gi({size:t=16,variant:e="dots"}){return e==="dots"?h.jsxs("div",{className:"chat-wrapper__loader-dots",style:{fontSize:t},children:[h.jsx("span",{}),h.jsx("span",{}),h.jsx("span",{})]}):e==="pulse"?h.jsx("div",{className:"chat-wrapper__loader-pulse",style:{width:t,height:t}}):h.jsx("div",{className:"chat-wrapper__loader-spinner",style:{width:t,height:t}})}const Wp=({message:t})=>{const[e,n]=k.useState(!0),r=()=>t.role==="system"?h.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsxs("svg",{width:"20",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_64_36257",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.381836",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_64_36257)",children:h.jsx("path",{d:"M11.0999 13.6651L7.91657 10.4817C7.69435 10.5706 7.45268 10.6401 7.19157 10.6901C6.93046 10.7401 6.66657 10.7651 6.3999 10.7651C5.2999 10.7651 4.35824 10.3762 3.5749 9.5984C2.79157 8.82063 2.3999 7.88174 2.3999 6.78174C2.3999 6.36196 2.45268 5.96257 2.55824 5.58357C2.66379 5.20457 2.82212 4.85396 3.03324 4.53174L5.43324 6.93174L6.5999 5.76507L4.1999 3.36507C4.52212 3.17618 4.86935 3.03174 5.24157 2.93174C5.61379 2.83174 5.9999 2.78174 6.3999 2.78174C7.51101 2.78174 8.45546 3.17618 9.23324 3.96507C10.011 4.75396 10.3999 5.69946 10.3999 6.80157C10.3999 7.05502 10.3749 7.29007 10.3249 7.50674C10.2749 7.7234 10.2055 7.94285 10.1166 8.16507L13.3666 11.3984C13.5221 11.5578 13.5999 11.7505 13.5999 11.9762C13.5999 12.2021 13.5221 12.3928 13.3666 12.5484L12.2332 13.6651C12.0767 13.8206 11.8876 13.8984 11.6659 13.8984C11.4441 13.8984 11.2555 13.8206 11.0999 13.6651ZM11.6666 12.5317L12.2499 11.9651L8.66657 8.41507C8.88879 8.14841 9.03324 7.85674 9.0999 7.54007C9.16657 7.2234 9.1999 6.97618 9.1999 6.7984C9.1999 6.05563 8.93601 5.40885 8.40824 4.85807C7.88046 4.30718 7.24435 4.01507 6.4999 3.98174L7.86657 5.33174C7.98879 5.45596 8.0499 5.60091 8.0499 5.76657C8.0499 5.93224 7.98718 6.07735 7.86174 6.20191L5.85474 8.1949C5.72929 8.31946 5.58779 8.38174 5.43024 8.38174C5.27268 8.38174 5.13479 8.32063 5.01657 8.1984L3.5999 6.78174C3.5999 7.5484 3.8749 8.20396 4.4249 8.7484C4.9749 9.29285 5.63324 9.56507 6.3999 9.56507C6.58879 9.56507 6.8499 9.52618 7.18324 9.44841C7.51657 9.37063 7.82768 9.21507 8.11657 8.98174L11.6666 12.5317Z",fill:"#637381"})})]})}),h.jsx("span",{children:"AI text input <show-toolname>..."})]}):h.jsx("span",{children:"System Message"});return h.jsxs("div",{className:"chat-wrapper__system-message",children:[h.jsxs("div",{className:"chat-wrapper__system-message-header",onClick:()=>n(!e),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[r(),h.jsx("div",{className:"chat-wrapper__thinking-icon",children:h.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{transform:e?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s ease"},children:[h.jsx("mask",{id:"mask0_44_18068",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"16",height:"17",children:h.jsx("rect",{y:"0.000488281",width:"16",height:"16",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_44_18068)",children:h.jsx("path",{d:"M8 10.4506L4 6.45059L4.85 5.60059L8 8.75059L11.15 5.60059L12 6.45059L8 10.4506Z",fill:"#637381"})})]})})]}),e&&h.jsx("div",{className:"chat-wrapper__system-message-content",children:h.jsx("span",{children:t.content})})]})};function ro({imageUrl:t,isOpen:e,onClose:n,alt:r="Image preview"}){const i=k.useCallback(a=>{a.key==="Escape"&&n()},[n]),s=k.useCallback(a=>{a.target===a.currentTarget&&n()},[n]);return k.useEffect(()=>(e?(document.addEventListener("keydown",i),document.body.style.overflow="hidden"):(document.removeEventListener("keydown",i),document.body.style.overflow=""),()=>{document.removeEventListener("keydown",i),document.body.style.overflow=""}),[e,i]),!e||!t?null:h.jsxs("div",{className:"image-preview-modal__backdrop",onClick:s,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,cursor:"zoom-out"},children:[h.jsx("button",{onClick:n,style:{position:"absolute",top:"20px",right:"20px",background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"40px",height:"40px",color:"white",fontSize:"20px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background-color 0.2s",zIndex:1e4},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.3)"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.2)"},title:"Close (Esc)",children:"Ã—"}),h.jsx("div",{style:{maxWidth:"90vw",maxHeight:"90vh",display:"flex",alignItems:"center",justifyContent:"center",cursor:"default"},onClick:a=>a.stopPropagation(),children:h.jsx("img",{src:t,alt:r,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:"8px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",opacity:1},onLoad:a=>{a.currentTarget.style.opacity="1",a.currentTarget.style.transition="opacity 0.2s"}})}),h.jsx("div",{style:{position:"absolute",bottom:"20px",left:"0",right:"0",width:"100%",color:"rgba(255, 255, 255, 0.7)",fontSize:"14px",textAlign:"center",pointerEvents:"none"},children:"Press Esc or click outside to close"})]})}const io=k.createContext(null);function Gp({children:t,value:e}){return h.jsx(io.Provider,{value:e,children:t})}function En(){const t=k.useContext(io);if(!t)throw new Error("useChatContext must be used within ChatProvider. Make sure your component is wrapped with <ChatProvider>.");return t}const so={p:({children:t,...e})=>h.jsx("p",{className:"chat-wrapper__paragraph",...e,children:t}),br:({...t})=>h.jsx("br",{...t}),pre:({children:t,...e})=>h.jsx("pre",{className:"chat-wrapper__code-block",...e,children:t}),code:({children:t,className:e,...n})=>!e?h.jsx("code",{className:"chat-wrapper__inline-code",...n,children:t}):h.jsx("code",{className:"chat-wrapper__code",...n,children:t}),ul:({children:t,...e})=>h.jsx("ul",{className:"chat-wrapper__list",...e,children:t}),ol:({children:t,...e})=>h.jsx("ol",{className:"chat-wrapper__ordered-list",...e,children:t}),li:({children:t,...e})=>h.jsx("li",{className:"chat-wrapper__list-item",...e,children:t}),hr:({...t})=>h.jsx("hr",{className:"chat-wrapper__hr",...t})},qp={...so,code:({children:t,className:e,...n})=>!e?h.jsx("code",{className:"chat-wrapper__inline-code",...n,children:t}):h.jsx("code",{className:"chat-wrapper__code",...n,children:t})},ao=k.memo(({message:t})=>{const{getReasoningTitle:e,getReasoningStatus:n,getReasoningDuration:r,getReasoningContentOnly:i,getToolingTitle:s,getToolingStatus:a,clientTools:o,currentAssistantMessageIdRef:c,onRetryMessage:u}=En(),{t:l}=Mt(),[d,g]=k.useState(!1),[p,x]=k.useState(!1),[S,N]=k.useState(null),E=k.useCallback(async()=>{try{await navigator.clipboard.writeText(t.content),g(!0),setTimeout(()=>g(!1),2e3)}catch(_){console.error("Failed to copy message:",_)}},[t.content]),v=k.useCallback(()=>{u&&u(t.id)},[u,t.id]),M=k.useCallback(_=>{N(_)},[]),O=k.useCallback(()=>{N(null)},[]),P=()=>h.jsxs("div",{className:"chat-wrapper__streaming-placeholder",children:[h.jsx(gi,{size:16,variant:"dots"}),h.jsx("span",{children:l("chat.reasoning.thinking")})]}),b=()=>u&&h.jsx("button",{className:"chat-wrapper__retry-button",onClick:v,children:l("chat.errors.retry")}),z=()=>h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"chat-wrapper__copy-button-container",children:h.jsx("button",{className:`chat-wrapper__copy-button ${p?"chat-wrapper__copy-button--visible":"chat-wrapper__copy-button--hidden"}`,onClick:E,title:"Copy message",children:h.jsx(Ca,{})})}),d&&h.jsx("div",{className:"chat-wrapper__copied-notification",children:"Copied!"})]}),U=()=>h.jsx("div",{className:"chat-wrapper__regular-message chat-wrapper__assistant-message-container",children:h.jsxs("div",{className:"chat-wrapper__assistant-content-wrapper",children:[h.jsx("div",{className:"chat-wrapper__markdown-content",children:h.jsx(Us,{components:so,remarkPlugins:[Bs],children:t.content},`${t.id}-${t.isStreaming?"streaming":"final"}`)}),z()]})}),W=()=>h.jsxs("div",{className:"chat-wrapper__regular-message",children:[h.jsx("div",{className:"chat-wrapper__markdown-content",children:h.jsx(Us,{remarkPlugins:[Bs],components:qp,children:t.content},`${t.id}-user`)}),t.media&&t.media.length>0&&h.jsx("div",{className:"chat-wrapper__media",children:t.media.map((_,L)=>h.jsx("img",{src:_,alt:`Uploaded content ${L+1}`,className:"chat-wrapper__media-image chat-wrapper__media-image--clickable",onClick:()=>M(_),style:{cursor:"zoom-in",transition:"transform 0.2s, box-shadow 0.2s"},onMouseEnter:F=>{F.currentTarget.style.transform="scale(1.02)",F.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},onMouseLeave:F=>{F.currentTarget.style.transform="scale(1)",F.currentTarget.style.boxShadow=""},title:"Click to view full size"},L))})]}),Y=()=>t.role==="assistant"&&t.isStreaming&&t.content===""&&t.id===c.current?P():t.role==="system"?h.jsx(Wp,{message:t}):t.role==="assistant"?U():W(),G=()=>h.jsxs(no,{isStreaming:t.isStreaming||!1,children:[h.jsx(pi,{title:e(t.content,t.isStreaming),status:n(t.content,t.isStreaming),duration:r(t.content)}),h.jsx(fi,{children:i(t.content)})]}),H=()=>{var _;return h.jsx($p,{isStreaming:t.isStreaming||!1,children:h.jsx(Vp,{title:s(t.content,t.isStreaming),status:a(t.content,t.isStreaming),toolData:t.toolData,toolName:(_=t.toolData)==null?void 0:_.toolName,clientTools:o})})};return h.jsxs(h.Fragment,{children:[h.jsx("div",{className:`chat-wrapper__message chat-wrapper__message--${t.role==="system"?"assistant":t.role==="reasoning"?"reasoning":t.role==="tooling"?"tooling":t.role}`,onMouseEnter:()=>t.role==="assistant"&&x(!0),onMouseLeave:()=>t.role==="assistant"&&x(!1),children:t.role==="reasoning"?G():t.role==="tooling"?H():h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"chat-wrapper__message-content",children:Y()}),t.role==="user"&&t.hasError&&!t.isRetrying&&b()]})}),h.jsx(ro,{imageUrl:S,isOpen:!!S,onClose:O,alt:"Message image"})]})});ao.displayName="MessageItem";const Kp=({isVisible:t})=>t?h.jsx("div",{className:"chat-wrapper__message chat-wrapper__message--assistant",children:h.jsx("div",{className:"chat-wrapper__thinking-bubble",children:h.jsx("div",{className:"chat-wrapper__thinking-content",children:h.jsxs("div",{className:"chat-wrapper__thinking-dots",children:[h.jsx("span",{}),h.jsx("span",{}),h.jsx("span",{})]})})})}):null,oo=k.forwardRef((t,e)=>{const{messages:n,isThinking:r,isHandlingTool:i}=En();return h.jsxs("div",{className:"chat-wrapper__messages",children:[n.map(s=>h.jsx(ao,{message:s},s.id)),h.jsx(Kp,{isVisible:r&&!i}),h.jsx("div",{ref:e})]})});oo.displayName="MessagesList";const ft=(...t)=>t.filter(Boolean).join(" "),Zp=()=>h.jsxs("svg",{width:"54",height:"55",viewBox:"0 0 54 55",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsxs("g",{filter:"url(#filter0_dd_121_23927)",children:[h.jsx("path",{d:"M3 26.3541C3 13.0993 13.7452 2.35413 27 2.35413C40.2548 2.35413 51 13.0993 51 26.3541C51 39.609 40.2548 50.3541 27 50.3541C13.7452 50.3541 3 39.609 3 26.3541Z",fill:"#3D0099",shapeRendering:"crispEdges"}),h.jsx("g",{clipPath:"url(#clip0_121_23927)",children:h.jsx("path",{d:"M16.3333 26.3541L18.2133 28.2341L25.6666 20.7941V37.0208H28.3333V20.7941L35.7733 28.2474L37.6666 26.3541L26.9999 15.6874L16.3333 26.3541Z",fill:"white"})})]}),h.jsxs("defs",{children:[h.jsxs("filter",{id:"filter0_dd_121_23927",x:"0",y:"0.354126",width:"54",height:"54",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[h.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),h.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),h.jsx("feOffset",{dy:"1"}),h.jsx("feGaussianBlur",{stdDeviation:"1"}),h.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),h.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"}),h.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_121_23927"}),h.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),h.jsx("feOffset",{dy:"1"}),h.jsx("feGaussianBlur",{stdDeviation:"1.5"}),h.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),h.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),h.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_121_23927",result:"effect2_dropShadow_121_23927"}),h.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_121_23927",result:"shape"})]}),h.jsx("clipPath",{id:"clip0_121_23927",children:h.jsx("rect",{width:"32",height:"32",fill:"white",transform:"translate(11 10.3541)"})})]})]}),Yp=()=>h.jsxs("svg",{width:"54",height:"55",viewBox:"0 0 54 55",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsxs("g",{filter:"url(#filter0_dd_stop_121_23927)",children:[h.jsx("path",{d:"M3 26.3541C3 13.0993 13.7452 2.35413 27 2.35413C40.2548 2.35413 51 13.0993 51 26.3541C51 39.609 40.2548 50.3541 27 50.3541C13.7452 50.3541 3 39.609 3 26.3541Z",fill:"#3D0099",shapeRendering:"crispEdges"}),h.jsx("g",{transform:"translate(11, 11.3541)",children:h.jsx("path",{d:"M21.3333 10.6667V21.3333H10.6667V10.6667H21.3333ZM24 8H8V24H24V8Z",fill:"white"})})]}),h.jsx("defs",{children:h.jsxs("filter",{id:"filter0_dd_stop_121_23927",x:"0",y:"0.354126",width:"54",height:"54",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB",children:[h.jsx("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),h.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),h.jsx("feOffset",{dy:"1"}),h.jsx("feGaussianBlur",{stdDeviation:"1"}),h.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),h.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.06 0"}),h.jsx("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow_stop_121_23927"}),h.jsx("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),h.jsx("feOffset",{dy:"1"}),h.jsx("feGaussianBlur",{stdDeviation:"1.5"}),h.jsx("feComposite",{in2:"hardAlpha",operator:"out"}),h.jsx("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"}),h.jsx("feBlend",{mode:"normal",in2:"effect1_dropShadow_stop_121_23927",result:"effect2_dropShadow_stop_121_23927"}),h.jsx("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect2_dropShadow_stop_121_23927",result:"shape"})]})})]}),lo=({className:t,...e})=>h.jsx("form",{className:ft("chat-wrapper__prompt-input",t),...e}),mi=k.forwardRef(({onChange:t,className:e,placeholder:n="What would you like to know?",minHeight:r=48,maxHeight:i=164,onKeyDown:s,...a},o)=>{const c=u=>{if(u.key==="Enter"){if(u.shiftKey)return;u.preventDefault();const l=u.currentTarget.form;if(l){const d=new Event("submit",{cancelable:!0,bubbles:!0});l.dispatchEvent(d)}}s==null||s(u)};return h.jsx("textarea",{ref:o,className:ft("chat-wrapper__prompt-textarea",e),name:"message",onChange:t,onKeyDown:c,placeholder:n,style:{minHeight:`${r}px`,maxHeight:`${i}px`},...a})});mi.displayName="PromptInputTextarea";const co=({className:t,...e})=>h.jsx("div",{className:ft("chat-wrapper__prompt-toolbar",t),...e}),uo=({className:t,...e})=>h.jsx("div",{className:ft("chat-wrapper__prompt-tools",t),...e}),ho=({variant:t="ghost",size:e="default",className:n,children:r,...i})=>{const s=e==="default"&&(typeof r=="string"||k.Children.count(r)===1)?"icon":e;return h.jsx("button",{className:ft("chat-wrapper__prompt-button",`chat-wrapper__prompt-button--${t}`,`chat-wrapper__prompt-button--${s}`,n),type:"button",...i,children:r})},po=({className:t,variant:e="default",size:n="icon",status:r=Se.IDLE,children:i,disabled:s,...a})=>{const o=$n(r);let c=o?h.jsx(Yp,{}):h.jsx(Zp,{});return h.jsx("button",{className:ft("chat-wrapper__prompt-submit",`chat-wrapper__prompt-submit--${e}`,`chat-wrapper__prompt-submit--${n}`,!s&&"chat-wrapper__prompt-submit--enabled",o&&"chat-wrapper__prompt-submit--stop",t),type:o?"button":"submit",disabled:s,...a,children:i??c})},Xp=({className:t,children:e,...n})=>h.jsx("select",{className:ft("chat-wrapper__prompt-select",t),...n,children:e}),Jp=({className:t,children:e,...n})=>h.jsx("button",{className:ft("chat-wrapper__prompt-select-trigger",t),type:"button",...n,children:e}),Qp=({className:t,...e})=>h.jsx("div",{className:ft("chat-wrapper__prompt-select-content",t),...e}),ef=({className:t,value:e,...n})=>h.jsx("div",{className:ft("chat-wrapper__prompt-select-item",t),"data-value":e,...n}),tf=({className:t,placeholder:e,...n})=>h.jsx("span",{className:ft("chat-wrapper__prompt-select-value",t),...n,children:e}),fo=({placeholderTexts:t,shouldAnimate:e,className:n=""})=>{const[r,i]=k.useState(0),[s,a]=k.useState(!1),[o,c]=k.useState(0);return k.useEffect(()=>{if(!e||t.length<=1)return;const u=setInterval(()=>{a(!0),setTimeout(()=>{i(l=>(l+1)%t.length),c(l=>l+1),a(!1)},150)},2e3);return()=>clearInterval(u)},[e,t.length]),k.useEffect(()=>{e||(i(0),a(!1),c(0))},[e]),h.jsx("div",{className:`animated-placeholder-container ${n}`,children:h.jsx("span",{className:`animated-placeholder-text ${s?"transitioning":""}`,children:t[r]},o)})},nf=k.forwardRef((t,e)=>{const{placeholderTexts:n,isStreaming:r,isLoadingConversation:i,chatStatus:s,fileUploadEnabled:a,fileUploadConfig:o,chipName:c,chipLogo:u,messages:l,onSubmit:d,onFileUpload:g,onStopGeneration:p}=En(),{t:x}=Mt(),S=r||i,N=l.length>0,[E,v]=k.useState(""),[M,O]=k.useState([]),[P,b]=k.useState([]),[z,U]=k.useState(null),[W,Y]=k.useState(null),[G,H]=k.useState(!1),_=k.useRef(null),L=k.useCallback(B=>{Y(B),H(!0)},[]),F=k.useCallback(B=>new Promise((C,ie)=>{const K=new FileReader;K.onload=()=>C(K.result),K.onerror=ie,K.readAsDataURL(B)}),[]),ee=n&&n.length>0?n:[x("chat.input.placeholder")],se=E.length===0&&!N&&ee.length>1;k.useImperativeHandle(e,()=>({focus:()=>{var B;(B=_.current)==null||B.focus()},setText:B=>{v(B),setTimeout(()=>{if(_.current){_.current.focus();const C=B.length;_.current.setSelectionRange(C,C)}},0)},textareaRef:_}),[]);const pe=k.useCallback(B=>{B.preventDefault();const ie=new FormData(B.currentTarget).get("message");if(ie!=null&&ie.trim()){const K=Kr(ie.trim(),!1);if(!K.trim())return;d(K,M),v(""),O([])}},[d,M]),ge=k.useCallback(B=>{const ie=B.target.value.replace(/<script[\s\S]*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"");v(ie),z&&ie.trim()&&U(null)},[z]),y=k.useCallback(async B=>{var K;const ie=Array.from(((K=B.clipboardData)==null?void 0:K.items)||[]).filter(oe=>oe.type.startsWith("image/"));if(ie.length>0){B.preventDefault(),U(null);try{const oe=await Promise.all(ie.map(ne=>{const te=ne.getAsFile();return te?new File([te],`clipboard-image-${Date.now()}.${te.type.split("/")[1]}`,{type:te.type}):null})).then(ne=>ne.filter(Boolean));if(oe.length>0){const ne=oe.filter(te=>{const xe=(o==null?void 0:o.maxFileSize)??15728640;return te.size>xe?(U(x("chat.fileUpload.sizeLimitExceeded",{maxSize:Math.round(xe/1048576)})),!1):((o==null?void 0:o.allowedTypes)??["image/jpeg","image/png","image/gif","image/webp"]).includes(te.type)?!0:(U(x("chat.fileUpload.typeNotAllowed")),!1)});if(ne.length>0){const te=(o==null?void 0:o.maxFiles)??5;if(M.length+P.length+ne.length>te){U(x("chat.fileUpload.maxFilesExceeded",{maxFiles:te}));return}const de=ne.map(async Te=>({file:Te,preview:await F(Te),isUploading:!0,progress:0})),_e=await Promise.all(de);b(Te=>[...Te,..._e]);try{const Te=await g(ne);b(Oe=>Oe.filter(it=>!ne.includes(it.file))),O(Oe=>[...Oe,...Te]),U(null)}catch{b(Oe=>Oe.filter(it=>!ne.includes(it.file))),U(x("chat.errors.connection"))}}}}catch(oe){U(oe instanceof Error?oe.message:x("chat.errors.unexpected")),b([])}}},[g,o,M,P,F,x]),Q=k.useCallback(async()=>{const B=document.createElement("input");B.type="file",B.accept="image/*",B.multiple=!0,B.onchange=async C=>{const ie=C.target.files;if(ie)try{U(null);const K=Array.from(ie).filter(oe=>{const ne=ul(oe.name);oe.name;const te=(o==null?void 0:o.maxFileSize)??15*1024*1024;return oe.size>te?(U(x("chat.fileUpload.sizeLimitExceeded",{maxSize:Math.round(te/(1024*1024))})),!1):((o==null?void 0:o.allowedTypes)??["image/jpeg","image/png","image/gif","image/webp"]).includes(oe.type)?!0:(U(x("chat.fileUpload.typeNotAllowed")),!1)});if(K.length>0){const oe=(o==null?void 0:o.maxFiles)??5;if(M.length+P.length+K.length>oe){U(x("chat.fileUpload.maxFilesExceeded",{maxFiles:oe}));return}const te=K.map(async de=>({file:de,preview:await F(de),isUploading:!0,progress:0})),xe=await Promise.all(te);b(de=>[...de,...xe]);try{const de=await g(K);b(_e=>_e.filter(Te=>!K.includes(Te.file))),O(_e=>[..._e,...de]),U(null)}catch{b(_e=>_e.filter(Te=>!K.includes(Te.file))),U(x("chat.errors.connection"))}}}catch(K){U(K instanceof Error?K.message:x("chat.errors.unexpected")),b([])}},B.click()},[g,o,M,P,F,x]);return h.jsxs(lo,{onSubmit:pe,className:`${S?"chat-wrapper__prompt-input--disabled":""} ${M.length>0||P.length>0||z?"chat-wrapper__prompt-input--with-media":""}`,children:[h.jsx(mi,{ref:_,name:"message",value:E,onChange:ge,onPaste:y,placeholder:"",disabled:S}),!E.trim()&&h.jsx(fo,{placeholderTexts:ee,shouldAnimate:se}),z&&h.jsxs("div",{className:"chat-wrapper__upload-error",children:[h.jsx("div",{className:"chat-wrapper__upload-error-icon",children:h.jsx("span",{className:"chat-wrapper__upload-error-icon-text",children:"!"})}),h.jsx("span",{className:"chat-wrapper__upload-error-message",children:z}),h.jsx("button",{className:"chat-wrapper__upload-error-dismiss",onClick:()=>U(null),title:"Dismiss",children:"Ã—"})]}),(M.length>0||P.length>0)&&h.jsxs("div",{className:"chat-wrapper__media-preview-container",children:[P.map((B,C)=>h.jsxs("div",{className:"chat-wrapper__media-item-wrapper",children:[h.jsxs("div",{className:"chat-wrapper__uploading-thumbnail",children:[h.jsx("img",{src:B.preview,alt:`Uploading ${C+1}`,className:"chat-wrapper__uploading-thumbnail-image"}),h.jsx("div",{className:"chat-wrapper__uploading-overlay",children:h.jsx("div",{className:"chat-wrapper__uploading-spinner"})})]}),h.jsx("button",{onClick:()=>{b(ie=>ie.filter((K,oe)=>oe!==C))},className:"chat-wrapper__media-remove-button",title:"Cancel upload",children:"Ã—"})]},`uploading-${C}`)),M.map((B,C)=>{const ie=B.startsWith("data:image/"),K=B.startsWith("http://")||B.startsWith("https://"),oe=ie||K;return h.jsxs("div",{className:"chat-wrapper__media-item-wrapper",children:[oe?h.jsxs("div",{className:"chat-wrapper__media-thumbnail",onClick:()=>L(B),title:"Click to view full image",children:[h.jsx("img",{src:B,alt:`Attachment ${C+1}`,className:"chat-wrapper__media-thumbnail-image"}),h.jsx("div",{className:"chat-wrapper__media-thumbnail-overlay"}),h.jsx("div",{className:"chat-wrapper__media-thumbnail-zoom-icon"})]}):h.jsxs("div",{className:"chat-wrapper__file-preview",children:[h.jsx("div",{className:"chat-wrapper__file-icon-container",children:h.jsxs("svg",{width:"24",height:"25",viewBox:"0 0 24 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("mask",{id:"mask0_190_623",style:{maskType:"alpha"},maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"25",children:h.jsx("rect",{y:"0.354126",width:"24",height:"24",fill:"#D9D9D9"})}),h.jsx("g",{mask:"url(#mask0_190_623)",children:h.jsx("path",{d:"M8.19225 13.0079H15.8077V11.5079H8.19225V13.0079ZM8.19225 15.8926H15.8077V14.3926H8.19225V15.8926ZM8.19225 18.7771H12.8077V17.2771H8.19225V18.7771ZM6.30775 21.8541C5.80258 21.8541 5.375 21.6791 5.025 21.3291C4.675 20.9791 4.5 20.5515 4.5 20.0464V4.66188C4.5 4.15671 4.675 3.72913 5.025 3.37913C5.375 3.02913 5.80258 2.85413 6.30775 2.85413H14.25L19.5 8.10413V20.0464C19.5 20.5515 19.325 20.9791 18.975 21.3291C18.625 21.6791 18.1974 21.8541 17.6923 21.8541H6.30775ZM13.5 8.85413V4.35413H6.30775C6.23075 4.35413 6.16025 4.38621 6.09625 4.45038C6.03208 4.51438 6 4.58488 6 4.66188V20.0464C6 20.1234 6.03208 20.1939 6.09625 20.2579C6.16025 20.322 6.23075 20.3541 6.30775 20.3541H17.6923C17.7692 20.3541 17.8398 20.322 17.9038 20.2579C17.9679 20.1939 18 20.1234 18 20.0464V8.85413H13.5Z",fill:"white"})})]})}),h.jsxs("div",{className:"chat-wrapper__file-info",children:[h.jsx("div",{className:"chat-wrapper__file-name",children:(()=>{const ne=B.match(/name=([^;]+)/);return ne?decodeURIComponent(ne[1]):"document.pdf"})()}),h.jsx("div",{className:"chat-wrapper__file-type",children:(()=>{const ne=B.match(/data:([^;]+)/);if(ne){const te=ne[1];switch(te){case"application/pdf":return"PDF";case"application/msword":case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"DOC";case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"XLS";case"application/vnd.ms-powerpoint":case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return"PPT";case"text/plain":return"TXT";case"text/csv":return"CSV";case"application/json":return"JSON";case"application/xml":case"text/xml":return"XML";case"application/zip":return"ZIP";case"application/x-rar-compressed":return"RAR";default:const xe=te.split("/")[1];return xe?xe.toUpperCase().substring(0,4):"FILE"}}return"FILE"})()})]})]}),h.jsx("button",{onClick:()=>{O(ne=>ne.filter((te,xe)=>xe!==C)),z&&U(null)},className:`chat-wrapper__media-remove-button ${oe?"":"chat-wrapper__media-remove-button--file"}`,title:"Remove attachment",children:"Ã—"})]},`uploaded-${C}`)})]}),h.jsxs(co,{children:[h.jsxs(uo,{children:[a&&h.jsx("div",{className:"chat-wrapper__file-upload-container",children:h.jsx(ho,{variant:"ghost",size:"icon",onClick:Q,title:P.length>0?`Uploading ${P.length} file(s)...`:M.length>0?`${M.length}/${(o==null?void 0:o.maxFiles)??5} image(s) attached`:`Attach images (max ${(o==null?void 0:o.maxFiles)??5} files, ${Math.round(((o==null?void 0:o.maxFileSize)??15*1024*1024)/(1024*1024))}MB each)`,disabled:S||P.length>0,children:h.jsxs("svg",{width:"36",height:"37",viewBox:"0 0 36 37",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("rect",{y:"0.354126",width:"36",height:"36",rx:"18",fill:"#F4F6F8"}),h.jsx("g",{clipPath:"url(#clip0_121_9706)",children:h.jsx("path",{d:"M21.3334 13.3541V22.9374C21.3334 24.7791 19.8417 26.2708 18 26.2708C16.1584 26.2708 14.6667 24.7791 14.6667 22.9374V12.5208C14.6667 11.3708 15.6 10.4374 16.75 10.4374C17.9 10.4374 18.8334 11.3708 18.8334 12.5208V21.2708C18.8334 21.7291 18.4584 22.1041 18 22.1041C17.5417 22.1041 17.1667 21.7291 17.1667 21.2708V13.3541H15.9167V21.2708C15.9167 22.4208 16.85 23.3541 18 23.3541C19.15 23.3541 20.0834 22.4208 20.0834 21.2708V12.5208C20.0834 10.6791 18.5917 9.18744 16.75 9.18744C14.9084 9.18744 13.4167 10.6791 13.4167 12.5208V22.9374C13.4167 25.4708 15.4667 27.5208 18 27.5208C20.5334 27.5208 22.5834 25.4708 22.5834 22.9374V13.3541H21.3334Z",fill:"#212B36"})}),h.jsx("defs",{children:h.jsx("clipPath",{id:"clip0_121_9706",children:h.jsx("rect",{width:"20",height:"20",fill:"white",transform:"translate(8 8.35413)"})})})]})})}),a&&c&&h.jsx("div",{className:"chat-wrapper__divider"}),c&&h.jsxs("div",{className:"chat-wrapper__restaurant-chip",children:[u&&h.jsx("img",{src:u,alt:"Chip logo",className:"chat-wrapper__restaurant-logo"}),h.jsx("span",{className:"chat-wrapper__restaurant-name",children:c})]})]}),h.jsx(po,{status:s,disabled:$n(s)?!1:!E.trim()||S||P.length>0,onClick:$n(s)&&p?()=>{p()}:void 0})]}),h.jsx(ro,{imageUrl:W,isOpen:G,onClose:()=>{H(!1),Y(null)},alt:"Image preview"})]})}),go=()=>{const{suggestedPrompts:t,chatInputRef:e,enableSuggestedPromptsAnimation:n=!0}=En(),r=k.useRef(!1),i=k.useRef(null),s=k.useRef(null);if(k.useEffect(()=>()=>{i.current&&cancelAnimationFrame(i.current),s.current&&clearTimeout(s.current)},[]),!t||t.length===0)return null;const a=k.useCallback(o=>{var l;if(r.current)return;if(!e.current){console.warn("Chat input ref not available");return}if(!n){e.current.setText(o.description),e.current.focus();return}i.current&&(cancelAnimationFrame(i.current),i.current=null),s.current&&(clearTimeout(s.current),s.current=null);const c=(l=e.current.textareaRef)==null?void 0:l.current;if(!c){console.warn("Textarea ref not available, using fallback"),e.current.setText(o.description);return}e.current.setText(""),c.focus(),r.current=!0;let u=!1;return o.description.length>0&&e.current.setText(o.description[0]),s.current=setTimeout(()=>{let d=1;const g=10,p=()=>{if(u||!e.current){r.current=!1,s.current=null;return}if(d<o.description.length){const x=o.description.substring(0,d+1);c.value=x;const S=new Event("input",{bubbles:!0});c.dispatchEvent(S),d++,s.current=setTimeout(p,g)}else r.current=!1,s.current=null,e.current&&e.current.setText(o.description)};p()},10),()=>{u=!0,s.current&&(clearTimeout(s.current),s.current=null),r.current=!1}},[e,n]);return h.jsxs("div",{className:"chat-wrapper__suggested-prompts",children:[h.jsx("h3",{className:"chat-wrapper__suggested-prompts-title",children:"Suggested Prompts"}),h.jsx("div",{className:"chat-wrapper__suggested-prompts-grid",children:t.map((o,c)=>h.jsx("button",{className:"chat-wrapper__suggested-prompt-card",onClick:()=>a(o),children:h.jsxs("div",{className:"chat-wrapper__suggested-prompt-content",children:[h.jsx("h4",{className:"chat-wrapper__suggested-prompt-title",children:o.title}),h.jsx("p",{className:"chat-wrapper__suggested-prompt-description",children:o.description})]})},c))})]})},mo=({size:t=20,fullHeight:e=!1})=>h.jsx("div",{className:`chat-wrapper__inline-loader ${e?"chat-wrapper__inline-loader--full-height":""}`,children:h.jsx("div",{className:"chat-wrapper__inline-loader-content",children:h.jsx(gi,{size:t,variant:"dots"})})}),rf=({headerName:t,headerDescription:e})=>h.jsxs("div",{className:"chat-wrapper__main-header",children:[h.jsx("h1",{className:"chat-wrapper__main-title",children:t}),e&&h.jsx("p",{className:"chat-wrapper__description",children:e})]}),Co=()=>h.jsxs("div",{className:"chat-wrapper__skeleton",children:[h.jsxs("div",{className:"chat-wrapper__skeleton-header",children:[h.jsx("div",{className:"chat-wrapper__skeleton-title"}),h.jsx("div",{className:"chat-wrapper__skeleton-description"})]}),h.jsxs("div",{className:"chat-wrapper__skeleton-content",children:[h.jsx("div",{className:"chat-wrapper__skeleton-input",children:h.jsx("div",{className:"chat-wrapper__skeleton-input-field"})}),h.jsxs("div",{className:"chat-wrapper__skeleton-prompts",children:[h.jsx("div",{className:"chat-wrapper__skeleton-prompts-title"}),h.jsxs("div",{className:"chat-wrapper__skeleton-prompts-grid",children:[h.jsx("div",{className:"chat-wrapper__skeleton-prompt-card"}),h.jsx("div",{className:"chat-wrapper__skeleton-prompt-card"}),h.jsx("div",{className:"chat-wrapper__skeleton-prompt-card"}),h.jsx("div",{className:"chat-wrapper__skeleton-prompt-card"})]})]})]})]}),xo=({errorType:t="unknown",errorMessage:e,retryCount:n=0,onRetry:r,footer:i})=>{const{t:s}=Mt(),a=()=>{if(e)return{title:s("chat.errors.connection"),message:e};switch(t){case"network":return{title:s("chat.errors.connection"),message:s("chat.errors.connection")};case"auth":return{title:s("chat.errors.authentication"),message:s("chat.errors.authentication")};case"server":return{title:s("chat.errors.unexpected"),message:s("chat.errors.unexpected")};default:return{title:s("chat.errors.unexpected"),message:s("chat.errors.unexpected")}}},{title:o,message:c}=a();return h.jsx("div",{className:"chat-wrapper__connection-error-overlay",children:h.jsxs("div",{className:"chat-wrapper__connection-error-card",children:[h.jsx("div",{className:"chat-wrapper__connection-error-icon",children:h.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("circle",{cx:"24",cy:"24",r:"20",fill:"#FEE2E2"}),h.jsx("path",{d:"M24 16V26M24 30V32",stroke:"#DC2626",strokeWidth:"3",strokeLinecap:"round"})]})}),h.jsx("h3",{className:"chat-wrapper__connection-error-title",children:o}),h.jsx("p",{className:"chat-wrapper__connection-error-message",children:c}),n>0&&h.jsxs("p",{className:"chat-wrapper__connection-error-retry-count",children:["Retry attempt: ",n]}),r&&h.jsxs("button",{className:"chat-wrapper__connection-error-button",onClick:r,children:[h.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("path",{d:"M14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C9.84871 2 11.5009 2.85147 12.6 4.2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),h.jsx("path",{d:"M12 2V4.5H9.5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),s("chat.errors.retry")]}),i&&h.jsx("div",{className:"chat-wrapper__connection-error-footer",children:i})]})})},sf=()=>{const{messages:t,isLoadingConversation:e,isStreaming:n,headerName:r,headerDescription:i,suggestedPrompts:s,footer:a,messagesEndRef:o,chatInputRef:c,isOffline:u,connectionState:l,isInitialConnection:d,conversationError:g,onRetryConnection:p}=En(),x=t.length===0&&!e&&l===Ae.CONNECTING,S=t.length===0&&!e&&l===Ae.DISCONNECTED&&!d;if(console.log("[ChatContent] Render state check:",{shouldShowSkeleton:x,shouldShowConnectionError:S,messagesLength:t.length,isLoadingConversation:e,connectionState:l,isInitialConnection:d,isOffline:u,conversationError:g}),x||S)return console.log("[ChatContent] Showing skeleton/error:",{reason:x?"SKELETON (connecting)":"CONNECTION_ERROR",shouldShowSkeleton:x,shouldShowConnectionError:S}),h.jsxs("div",{style:{position:"relative",height:"100%"},children:[h.jsx(Co,{}),S&&h.jsx(xo,{errorType:u?"network":"server",errorMessage:g||void 0,onRetry:p,footer:a})]});console.log("[ChatContent] Rendering normal chat interface");const N=St.state.shouldShowMainHeader(t.length,n,e),E=St.state.shouldShowSuggestedPrompts(t.length,n,e,s),v=St.state.getContentAreaClass(t.length,n,e);return h.jsxs(h.Fragment,{children:[N&&h.jsx("div",{style:u?{paddingTop:"48px"}:void 0,children:h.jsx(rf,{headerName:r,headerDescription:i})}),h.jsxs("div",{className:v,style:u&&t.length>0?{paddingTop:"72px"}:void 0,children:[e&&t.length===0?h.jsx("div",{className:"chat-wrapper__messages",children:h.jsx(mo,{fullHeight:!0})}):h.jsx(oo,{ref:o}),h.jsx("div",{className:"chat-wrapper__input-container",children:h.jsx(nf,{ref:c})}),E&&h.jsx(go,{}),E&&a&&h.jsx("div",{children:a})]})]})};function af({isVisible:t,isReconnecting:e=!1}){const{t:n}=Mt();return t?h.jsx("div",{className:"network-status-banner",children:h.jsx("div",{className:"network-status-banner__content",children:e?h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"network-status-banner__spinner"}),h.jsx("span",{children:n("chat.connection.reconnecting")})]}):h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"network-status-banner__icon",children:h.jsx("span",{className:"network-status-banner__icon-text",children:"!"})}),h.jsx("span",{className:"network-status-banner__message",children:n("chat.errors.connection")})]})})}):null}const yo=k.forwardRef(({auth:t,chatServerUrl:e,chatServerKey:n,metadata:r,config:i,tools:s,contextHelpers:a},o)=>{var sn,Nn;const{token:c,entityId:u,entityType:l}=t;St.validation.validateAuthProps({userMpAuthToken:c,chatServerUrl:e,chatServerKey:n});const d=k.useMemo(()=>St.url.convertWebSocketToHttp(e),[e]),g=k.useMemo(()=>{var A,me;return new Fc({apiUrl:d,userMpAuthToken:c,chatServerKey:n,maxFileSize:(A=i.fileUploadConfig)==null?void 0:A.maxFileSize,allowedTypes:(me=i.fileUploadConfig)==null?void 0:me.allowedTypes})},[d,c,n,i.fileUploadConfig]),p=k.useMemo(()=>s&&s.length>0?s.map(({execute:A,...me})=>me):[],[s]),x=Ac(),{isOnline:S,wasOffline:N}=jc(),E=k.useRef(!0),v=le(A=>A.isModalOpen),M=le(A=>A.isCollapsed),O=le(A=>A.currentMode),P=le(A=>A.openModal),b=le(A=>A.closeModal),z=le(A=>A.toggleCollapse),U=le(A=>A.toggleFullscreen),W=le(A=>A.setCurrentMode),Y=le(A=>A.chatStatus),G=le(A=>A.setChatStatus),H=le(A=>A.streamingStatus),_=le(A=>A.setStreamingStatus),L=le(A=>A.isLoadingConversation),F=le(A=>A.setIsLoadingConversation),ee=le(A=>A.conversationError),se=le(A=>A.setConversationError),pe=le(A=>A.setCurrentThreadId),ge=le(A=>A.providerResId),y=le(A=>A.setProviderResId),Q=le(A=>A.isStreaming),B=le(A=>A.setIsStreaming),C=le(A=>A.isThinking),ie=le(A=>A.setIsThinking),K=le(A=>A.streamingContent),oe=le(A=>A.setStreamingContent),ne=le(A=>A.isHandlingTool),te=le(A=>A.setIsHandlingTool);k.useEffect(()=>{i.mode&&W(i.mode)},[i.mode,W]),k.useEffect(()=>{if(typeof window>"u"||typeof document>"u")return;const A=me=>{me.key==="Escape"&&O==="modal"&&v&&b()};if(O==="modal"&&v)return document.addEventListener("keydown",A),()=>document.removeEventListener("keydown",A)},[O,v,b]);const{messages:xe,setMessages:de,currentAssistantMessageIdRef:_e,getReasoningStatus:Te,getReasoningDuration:Oe,getReasoningContentOnly:it,getReasoningTitle:st,getToolingTitle:Et,getToolingStatus:bt,handleSetMessage:gt,handleReasoningUpdate:_t,handleChatFinished:mt,handleChatError:jt,stopGeneration:Ft}=x,Ht=k.useRef(null),ht=k.useRef(null),dt=k.useRef(!1),R=k.useRef(null),I=k.useCallback(A=>{y(A.providerResId),pe(A.threadId)},[y,pe]),V=k.useCallback(A=>{var me,qe;switch(A.type){case lt.CHAT_COMPLETED:(me=A.data)!=null&&me.conversationId&&y(A.data.conversationId),mt(),G(Se.IDLE),_(tt.IDLE),setTimeout(()=>{var Ie;(Ie=ht.current)==null||Ie.focus()},0);break;case lt.CHAT_ERROR:(qe=A.data)!=null&&qe.error&&jt(A.data.error);break;case lt.CONNECTION_LOST:break;case lt.CONNECTION_RESTORED:break;case lt.RECONNECTING:break}},[mt,jt,y,pe]),{chatClient:J,connectionState:he,isInitialConnection:ve,connectChatClient:De}=zo({userMpAuthToken:c,chatServerUrl:e,chatServerKey:n,entityId:u,entityType:l,tools:s,contextHelpers:a,onSetMessage:gt,onSystemEvent:V,onReasoningUpdate:_t,onThreadCreated:I,onMessagesPersisted:i.onMessagesPersisted,onError:i.onError});k.useEffect(()=>{R.current=J},[J]),Dc({metadata:r,chatClient:J,currentProviderResId:ge,isLoadingConversation:L,messages:xe,entityId:u,entityType:l}),k.useEffect(()=>{N&&S&&E.current?De().catch(A=>{const me=Jt(A,"NetworkReconnection");E.current=me.isRetryable,me.isRetryable||console.warn(`[ChatWrapper] Network reconnection failed with non-retryable error: ${me.reason}`)}):N&&S&&!E.current&&console.warn("[ChatWrapper] Network restored but last error was non-retryable (CORS/auth), skipping reconnection")},[S,N,De]);const je=k.useCallback(()=>{Ft(),G(Se.IDLE),_(tt.IDLE),J&&ge&&J.stopRun(ge)},[Ft,G,_,J,ge]);k.useImperativeHandle(o,()=>({updateMetadata:A=>{J&&ge&&J.updateMetadata(ge,A).catch(me=>{})}}),[J,ge]);const Je=k.useMemo(()=>J?new Hc(J,{onError:i.onError}):null,[J,i.onError]),{resetConversationLoader:Fe}=Lc({entityId:u,entityType:l,httpApiUrl:d,userMpAuthToken:c,chatServerKey:n,messages:xe,setMessages:de,setIsLoadingConversation:F,setConversationError:se,setCurrentThreadId:pe,setProviderResId:y,metadata:r,isConnected:he===Ae.CONNECTED,onConversationInitialized:i.onConversationInitialized?()=>{var A;dt.current=!0,(A=i.onConversationInitialized)==null||A.call(i)}:void 0}),ye=k.useRef(null),Ge=k.useCallback(()=>{ye.current&&cancelAnimationFrame(ye.current),ye.current=requestAnimationFrame(()=>{var A;(A=Ht.current)==null||A.scrollIntoView({behavior:"smooth"}),ye.current=null})},[]);k.useEffect(()=>{Ge()},[xe,Ge]),k.useEffect(()=>{K&&Ge()},[K,Ge]),k.useEffect(()=>{i.onStreamingStatusChange&&i.onStreamingStatusChange(H)},[H,i]),k.useEffect(()=>()=>{ye.current&&cancelAnimationFrame(ye.current)},[]),k.useEffect(()=>()=>{de([]),B(!1),ie(!1),oe(""),te(!1),G(Se.IDLE),_(tt.IDLE),F(!1),se(null),pe(null),y(null)},[de,B,ie,oe,te,G,_,F,se,pe,y]);const He=k.useCallback(async(A,me)=>{if(!A.trim()||Q||!Je||!J)return;B(!0),ie(!0),G(Se.SUBMITTED),_(tt.STARTING);const qe=Je.createUserMessage(A,me);if(de(Ee=>[...Ee,qe]),i.onConversationInitialized&&!dt.current&&(dt.current=!0,i.onConversationInitialized()),!navigator.onLine){ie(!1),G(Se.ERROR),de(Ee=>Ee.map(Le=>Le.id===qe.id?{...Le,hasError:!0,isRetrying:!1,errorMessage:"No internet connection. Please check your network and try again."}:Le)),B(!1),G(Se.IDLE),_(tt.IDLE);return}try{const Ee=new Promise((Be,Ot)=>{setTimeout(()=>Ot(new Error("Message send timeout - connection may be lost")),5e3)});await Promise.race([J.onTriggerMessage({message:qe.content,media:me,providerResId:ge||void 0}),Ee]),G(Se.STREAMING);const Le=setTimeout(()=>{ie(!1),G(Se.ERROR),de(Be=>Be.map(Ot=>Ot.id===qe.id?{...Ot,hasError:!0,isRetrying:!1,errorMessage:"No response received. Connection may be lost."}:Ot)),B(!1),G(Se.IDLE),_(tt.IDLE)},12e4);window.responseTimeoutId=Le}catch(Ee){ie(!1),G(Se.ERROR),de(Le=>Le.map(Be=>Be.id===qe.id?{...Be,hasError:!0,isRetrying:!1,errorMessage:he!==Ae.CONNECTED?"Connection lost. Message not sent.":Ee instanceof Error?Ee.message:"Failed to send message. Please try again."}:Be)),B(!1),G(Se.IDLE),_(tt.IDLE)}},[Je,J,Q,he,de,B,ie,G,_,ge]),bn=k.useCallback(async A=>await g.uploadFiles(A),[g]),Vt=k.useMemo(()=>St.css.getContainerClasses(O,i.position,i.theme,M,i.constrainedHeight),[O,i.position,i.theme,M,i.constrainedHeight]),Wt=k.useCallback(()=>{O==="modal"?P():z()},[O,P,z]),_n=k.useCallback(A=>{ht.current&&ht.current.setText(A.description)},[]),At=k.useMemo(()=>({messages:xe,isStreaming:Q,isThinking:C,isHandlingTool:ne}),[xe,Q,C,ne]),vn=k.useMemo(()=>({isLoadingConversation:L,chatStatus:Y,conversationError:ee,isOffline:!S,connectionState:he,isInitialConnection:ve}),[L,Y,ee,S,he,ve]),Rn=k.useMemo(()=>{var A,me,qe,Ie;return{headerName:i.headerName,headerDescription:i.headerDescription,placeholderTexts:i.placeholderTexts,chipName:i.chipName,chipLogo:i.chipLogo,suggestedPrompts:i.suggestedPrompts,enableSuggestedPromptsAnimation:i.enableSuggestedPromptsAnimation,footer:i.footer,clientTools:p,fileUploadEnabled:(A=i.features)==null?void 0:A.fileUpload,fileUploadConfig:{maxFiles:((me=i.fileUploadConfig)==null?void 0:me.maxFiles)??5,maxFileSize:((qe=i.fileUploadConfig)==null?void 0:qe.maxFileSize)??15*1024*1024,allowedTypes:((Ie=i.fileUploadConfig)==null?void 0:Ie.allowedTypes)??["image/jpeg","image/png","image/gif","image/webp"]}}},[i.headerName,i.headerDescription,i.placeholderTexts,i.chipName,i.chipLogo,i.suggestedPrompts,i.enableSuggestedPromptsAnimation,(sn=i.features)==null?void 0:sn.fileUpload,i.fileUploadConfig,p]),Re=k.useMemo(()=>({getReasoningTitle:st,getReasoningStatus:Te,getReasoningDuration:Oe,getReasoningContentOnly:it,getToolingTitle:Et,getToolingStatus:bt}),[st,Te,Oe,it,Et,bt]),vt=k.useCallback(async A=>{const me=xe.find(Ie=>Ie.id===A);if(!me)return;if(B(!0),ie(!0),G(Se.SUBMITTED),_(tt.STARTING),de(Ie=>Ie.map(Ee=>Ee.id===A?{...Ee,hasError:!1,isRetrying:!0,errorMessage:void 0}:Ee)),!navigator.onLine){ie(!1),B(!1),G(Se.ERROR),de(Ie=>Ie.map(Ee=>Ee.id===A?{...Ee,isRetrying:!1,hasError:!0,errorMessage:"Still no internet connection. Please check your network and try again."}:Ee)),G(Se.IDLE),_(tt.IDLE);return}try{he!==Ae.CONNECTED&&await De(),await(J==null?void 0:J.onTriggerMessage({message:me.content,media:me.media,providerResId:ge||void 0})),G(Se.STREAMING);const Ie=setTimeout(()=>{ie(!1),G(Se.ERROR),de(Ee=>Ee.map(Le=>Le.id===A?{...Le,hasError:!0,isRetrying:!1,errorMessage:"No response received. Connection may be lost."}:Le)),B(!1),G(Se.IDLE),_(tt.IDLE)},12e4);window.responseTimeoutId=Ie}catch(Ie){ie(!1),B(!1),G(Se.ERROR),_(tt.IDLE),de(Ee=>Ee.map(Le=>Le.id===A?{...Le,isRetrying:!1,hasError:!0,errorMessage:Ie instanceof Error?Ie.message:"Retry failed. Please try again."}:Le)),G(Se.IDLE)}},[xe,de,Fe,De,He]),In=k.useCallback(async()=>{try{await De()}catch(A){console.error("Failed to reconnect:",A)}},[De]),nn=k.useMemo(()=>({onSubmit:He,onFileUpload:bn,onStopGeneration:je,onPromptSelect:_n,onRetryMessage:vt,onRetryConnection:In}),[He,bn,je,_n,vt,In]),rn=k.useMemo(()=>({...At,...vn,...Rn,...Re,...nn,currentAssistantMessageIdRef:_e,messagesEndRef:Ht,chatInputRef:ht}),[At,vn,Rn,Re,nn,_e,Ht,ht]);return k.useMemo(()=>St.state.shouldShowBubble(O,v,M),[O,v,M])?h.jsx(Zi,{children:h.jsx(Wc,{mode:O,headerName:i.headerName,bubbleText:i.bubbleText,showBubbleText:((Nn=i.features)==null?void 0:Nn.showBubbleText)!==!1,onClick:Wt})}):h.jsx(Zi,{children:h.jsx(Bc,{onError:A=>{i.onError&&i.onError(A)},children:h.jsxs("div",{className:Vt,style:i.customStyles,children:[h.jsx(af,{isVisible:!S,isReconnecting:he===Ae.RECONNECTING}),St.state.shouldShowHeader(i.headerVisible)&&h.jsx(Gc,{headerName:i.headerName,mode:O,isCollapsed:M,isModalOpen:v,onClose:b,onToggleFullscreen:U,onToggleCollapse:z}),!M&&h.jsx($c,{onError:A=>{i.onError&&i.onError(A)},children:h.jsx(Gp,{value:rn,children:h.jsx(sf,{})})})]})})})});yo.displayName="ChatWrapperInner";const So=k.forwardRef((t,e)=>{const{auth:n,chatServerUrl:r,chatServerKey:i,contextHelpers:s}=t,a=(s==null?void 0:s.locale)||"en";return h.jsx(ca,{locale:a,chatServerUrl:r,chatServerKey:i,mpAuthToken:n.token,children:h.jsx(yo,{ref:e,...t})})});So.displayName="ChatWrapperContainer";const of=k.memo(So);function lf({isConnected:t,isConnecting:e=!1,isReconnecting:n=!1,reconnectAttempt:r=0,maxReconnectAttempts:i=1/0,onRetry:s,autoHideDuration:a=3e3}){const[o,c]=k.useState("hidden"),[u,l]=k.useState(!1);if(k.useEffect(()=>{e?c("connecting"):!t&&!n?(l(!0),i!==1/0&&r>=i?c("error"):c("hidden")):n?c("reconnecting"):t&&u?(c("hidden"),l(!1)):t&&!u&&c("hidden")},[t,e,n,r,i,u,a]),o==="hidden")return null;const d=()=>{s&&s()},p=(()=>{switch(o){case"connecting":return{icon:"ðŸ”„",title:"Connecting...",message:"Establishing connection to the server"};case"reconnecting":return{icon:"ðŸ”„",title:"Reconnecting...",message:i===1/0?`Attempting to restore connection (${r})`:`Attempting to restore connection (${r}/${i})`};case"error":return{icon:"âŒ",title:"Connection Failed",message:"Unable to connect to the server. Please check your internet connection and try again."};default:return null}})();return p?o==="connecting"?h.jsx("div",{className:`connection-notification connection-notification--${o}`,children:h.jsxs("div",{className:"connection-notification__bubbles",children:[h.jsx("div",{className:"connection-notification__bubble"}),h.jsx("div",{className:"connection-notification__bubble"}),h.jsx("div",{className:"connection-notification__bubble"})]})}):o==="reconnecting"?h.jsx("div",{className:`connection-notification connection-notification--banner connection-notification--${o}`,children:h.jsxs("div",{className:"connection-notification__banner-content",children:[h.jsx("span",{className:"connection-notification__banner-spinner"}),h.jsxs("span",{className:"connection-notification__banner-text",children:["Reconnecting... (attempt ",r,")"]})]})}):h.jsx("div",{className:`connection-notification connection-notification--${o}`,children:h.jsxs("div",{className:"connection-notification__content",children:[h.jsx("div",{className:"connection-notification__icon",children:p.icon}),h.jsx("div",{className:"connection-notification__title",children:p.title}),h.jsx("div",{className:"connection-notification__message",children:p.message}),s&&h.jsx("div",{className:"connection-notification__actions",children:h.jsx("button",{className:"connection-notification__retry-btn primary",onClick:d,children:"Try Again"})})]})}):null}exports.AnimatedPlaceholder=fo;exports.CHAT_STATUS=Se;exports.ChatIcon=pa;exports.ChatSkeleton=Co;exports.ChatWrapper=of;exports.CloseIcon=fa;exports.CollapseIcon=ma;exports.ConnectionError=xo;exports.ConnectionNotification=lf;exports.CopyIcon=Ca;exports.EntityType=$s;exports.FullscreenIcon=ga;exports.InlineLoader=mo;exports.Loader=gi;exports.PROCESSING_STATUS=Ue;exports.PromptInput=lo;exports.PromptInputButton=ho;exports.PromptInputModelSelect=Xp;exports.PromptInputModelSelectContent=Qp;exports.PromptInputModelSelectItem=ef;exports.PromptInputModelSelectTrigger=Jp;exports.PromptInputModelSelectValue=tf;exports.PromptInputSubmit=po;exports.PromptInputTextarea=mi;exports.PromptInputToolbar=co;exports.PromptInputTools=uo;exports.Reasoning=no;exports.ReasoningContent=fi;exports.ReasoningTrigger=pi;exports.STREAMING_STATUS=tt;exports.SettingsIcon=Vc;exports.SuggestedPrompts=go;exports.TranslationProvider=ca;exports.fetchThreadMessages=Ws;exports.fetchTranslations=Yr;exports.isChatActive=$n;exports.isChatError=bo;exports.isChatIdle=Eo;exports.isProcessingActive=_o;exports.isProcessingComplete=vo;exports.isProcessingError=Ro;exports.updateThread=Gs;exports.updateThreadMetadata=qs;exports.useChatState=Il;exports.useConversationState=Nl;exports.useI18next=Rc;exports.useLayoutState=Rl;exports.useThreadState=Ml;exports.useTranslations=Mt;exports.useUIState=Oc;exports.useUIStore=le;
